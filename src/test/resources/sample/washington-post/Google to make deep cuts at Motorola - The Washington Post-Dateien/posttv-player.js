TWP=window.TWP||{};TWP.PostTV=TWP.PostTV||{};TWP.PostTV.scriptsLoaded=TWP.PostTV.scriptsLoaded||false;TWP.PostTV.stylesLoaded=TWP.PostTV.stylesLoaded||false;TWP.PostTV.BrowserInfo=TWP.PostTV.BrowserInfo||{init:function(a){this.userAgentStr=a;this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(this.userAgentStr)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";this.deviceType=this.lookUpDeviceType(this.dataDeviceType)||0;this.webview=this.searchString(this.dataWebview)||"unknown";this.setupThinkAdBlock()},searchString:function(d){for(var a=0;a<d.length;a++){var b=typeof d[a].string==="undefined"?this.userAgentStr:d[a].string;var c=d[a].prop;if(!this.version){this.versionSearchString=d[a].versionSearch||d[a].identity}if(b){if(b.indexOf(d[a].subString)!=-1){return d[a].identity}}else{if(c){return d[a].identity}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);if(a==-1){return}return b.substring(a+this.versionSearchString.length+1).match(/\d+(\.\d+)+/g)[0]},lookUpDeviceType:function(f){var e;for(var d=0,a=f.length;d<a;d++){e=typeof f[d].string==="undefined"?this.userAgentStr:f[d].string;if(e){if($.isArray(f[d].subString)){for(var b=0,c=f[d].subString.length;b<c;b++){if(e.indexOf(f[d].subString[b])!=-1){return typeof f[d].type==="number"?f[d].type:this.lookUpDeviceType(f[d].type)}}}else{if(e.indexOf(f[d].subString)!=-1){return typeof f[d].type==="number"?f[d].type:this.lookUpDeviceType(f[d].type)}else{if(typeof f[d].otherwise!="undefined"){return f[d].otherwise}}}}}},setupThinkAdBlock:function(){var a=this;$(function(){var b='<div id="ptvCanary" class="bottomAd" style="color: white; height: 2px"></div>';if($("#ptvCanary").length===0){$("body").append(b)}a.thinkAdBlock=!!($("#ptvCanary").filter(":hidden").length>0||$("#ptvCanary").filter(":visible").length===0)})},dataBrowser:[{subString:"Silk",identity:"Silk"},{subString:"Edge",identity:"Edge",versionSearch:"Edge"},{subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{subString:"Firefox",identity:"Firefox"},{subString:"Netscape",identity:"Netscape"},{subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{subString:"Trident",identity:"Explorer",versionSearch:"rv"},{subString:"Android",identity:"Android Stock Browser",versionSearch:"Android"},{subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{subString:"Silk",identity:"Android for Kindle"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{subString:"iPhone",identity:"iPhone"},{subString:"iPad",identity:"iPad"},{subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],dataDeviceType:[{subString:["iPhone","iPod"],type:1},{subString:["iPad","Silk"],type:2},{subString:["Android"],type:[{subString:["Firefox"],type:2},{subString:["Mobile"],type:1},{subString:null,otherwise:2}]},{subString:["Opera"],type:[{subString:["Mobi","Mini"],type:1}]},{subString:["AppleWebKit"],type:[{subString:["Mobile"],type:1}]},{subString:["Mobile"],type:1}],dataWebview:[{subString:"FBIOS",identity:"Facebook for iOS"},{subString:"FB4A",identity:"Facebook for Android"},{subString:"Twitter for iPhone",identity:"Twitter for iOS"},{subString:"TwitterAndroid",identity:"Twitter for Android"},{subString:" GSA/",identity:"Google Search App for iOS"},{subString:"CriOS",identity:"Chrome for iOS"},{subString:"FxiOS",identity:"Firefox for iOS"}]};if(!TWP.PostTV.BrowserInfo.browser){TWP.PostTV.BrowserInfo.init(navigator.userAgent)}TWP.PostTV.isMobile=typeof TWP.PostTV.isMobile=="boolean"?TWP.PostTV.isMobile:(function(){if(typeof TWP.PostTV.BrowserInfo.deviceType!=="undefined"){return TWP.PostTV.BrowserInfo.deviceType==1}else{if(/iPhone|Android/i.test(TWP.PostTV.BrowserInfo.OS)===true){TWP.PostTV.BrowserInfo.deviceType=1;return true}}})();TWP.PostTV.isTablet=(function(){if(typeof TWP.PostTV.BrowserInfo.deviceType!=="undefined"){return TWP.PostTV.BrowserInfo.deviceType==2}else{if(/iPad/i.test(TWP.PostTV.BrowserInfo.OS)===true){TWP.PostTV.BrowserInfo.deviceType=2;return true}}})();TWP.PostTV.isDeskweb=!(TWP.PostTV.isMobile||TWP.PostTV.isTablet);TWP.postTVCacheBuster="1450785126482";var contextPath=window.wp_pb&&wp_pb.contextPath?wp_pb.contextPath:TWP.PostTV.isDebugMode?"//www.washingtonpost.com/posttv-beta":"//www.washingtonpost.com/posttv";if(location.host.indexOf("local")>=0){contextPath="//"+location.host+(window.wp_pb&&wp_pb.contextPath?wp_pb.contextPath:"/pb")}var fullJsUrl=$('script[src*="posttv-player.js"], script[src*="posttv-player.min.js"]').attr("src");if(fullJsUrl){var fullJsUrlResources=fullJsUrl.indexOf("/static/js/posttv")>-1?fullJsUrl.indexOf("/static/js/posttv"):fullJsUrl.indexOf("/resources/js/posttv");if(fullJsUrlResources>-1){contextPath=fullJsUrl.substr(0,fullJsUrlResources)}}if(contextPath.indexOf("http")===0){contextPath=contextPath.substr(contextPath.indexOf("//"))}if(window.console){console.log("contextPath: ",contextPath)}var configUrl="//videos.posttv.com/JWPlayer/JWPlayerConfig.js";if(window.location.host.indexOf("local")>-1||(window.location.href.split("/")[3]&&window.location.href.split("/")[3].indexOf("beta")>-1)){configUrl=contextPath+"/resources/js/posttv/jwPlayer/JWPlayerConfig.js"}if(window.console){console.log("config url: ",configUrl)}var playerScript=(function(){var a={jwplayer:[configUrl],youtube:[contextPath+"/static/js/posttv/youtube/embed.js"]};if(!window.jwplayer){a.jwplayer.push(contextPath+"/resources/js/posttv/vendor/jw/jwplayer.js")}if(!window.jwPlayerWrapper){if(window.location.href.indexOf("_compact=false")>-1||window.location.host.indexOf("local")>-1){a.jwplayer.push(contextPath+"/resources/js/posttv/jwPlayer/jwPlayerWrapper.js")}else{a.jwplayer.push(contextPath+"/resources/js/posttv/jwPlayer/jwPlayerWrapper.min.js")}}return a})();playerScript.jwplayer.unshift(contextPath+"/resources/js/posttv/vendor/streamsense.min.js");playerScript.jwplayer.unshift("//js.washingtonpost.com/wp-stat/advertising/pseudo-static/vidExclusions/vid_exclusions.js");var queryStringObject=function(){if(!window.location.search){return{}}var b=window.location.search.slice(1).split("&");var d=b.length;var a={};for(var c=0;c<d;c++){query=b[c].split("=");if(query[0]){if(query.length<2){query.push("")}a[decodeURIComponent(query[0])]=decodeURIComponent(query[1])}}return a};var queryStringObj=queryStringObject();var $seriesPlayer=$("#player-container-posttv-series-template");var seriesPlayer=$seriesPlayer?$seriesPlayer.attr("data-player"):"";TWP.PostTV.playerVendor=queryStringObj.player==="jw"?"jw":seriesPlayer?seriesPlayer:null;var loadStyles=function(a){TWP.PostTV.stylesLoaded=true;var b=document.getElementsByTagName("head")[0];function d(e){var f=document.createElement("link");f.rel="stylesheet";f.type="text/css";f.href=e;f.media="all";b.appendChild(f)}var c=[contextPath+"/resources/css/posttv/posttv-player.css"];if($(".fa").css("font-family")!=="FontAwesome"){c.push(contextPath+"/resources/assets/fonts/fontawesome/4.0.3/css/font-awesome.min.css")}$.each(c,function(e,f){d(f)})};var loadScripts=function(){function a(e,f){var d=TWP.playerScript[e];d+="?_="+TWP.postTVCacheBuster;if(!d){f();return}var c=document.createElement("script");c.type="text/javascript";if(c.readyState){c.onreadystatechange=function(){if(c.readyState=="loaded"||c.readyState=="complete"){c.onreadystatechange=null;f()}}}else{c.onload=c.onerror=function(){f()}}c.src=d;document.getElementsByTagName("head")[0].appendChild(c);console.log("Added script: "+d)}var b=function(){var c=0;var d=function(){c++;if(c<TWP.playerScript.length){a(c,d)}else{if(window.jwplayer){jwplayer.key="G6yAUySsWPP3LIJ9rejn8gFzXJvKj3Y3hrn4Ew=="}console.log("Player files are loaded. Publish player_script_loaded event.");PubSub.publish("player_script_loaded",TWP.PostTV.playerVendor);TWP.PostTV.scriptsLoaded=true;TWP.PostTV.loadingScripts=false}};a(c,d)};b()};TWP.PostTV.initPostTvPlayer=function(c,b){var a=function(){function n(){var r=false;try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(s){r=true}}catch(t){if(navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!==undefined&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){r=true}}if(r){return"flash"}return"html5"}if(window.console){console.log("TWP.PostTV.initPostTvPlayer()",c,b)}var q=this;b=b||{};if(!(c&&c.nodeType)){console.log("Not a valid element");return{}}if(typeof $(c).data("video-uuid")!=="undefined"&&typeof $(c).data("uuid")==="undefined"){$(c).attr("data-uuid",$(c).data("video-uuid"))}q.options=b||{};q.options.type=/html5|flash/.test(queryStringObj.renderingMode)?queryStringObj.renderingMode:q.options.type||n();q.$node=$("#"+c.id);q.debug=(window.wp_pb&&wp_pb.contextPath&&wp_pb.contextPath!=="/posttv"&&wp_pb.contextPath!=="/pb"&&wp_pb.contextPath!=="/video")||(window.location.host.indexOf("local")>-1)||(window.queryStringObj&&queryStringObj.ptvdebug=="true")?true:false;var g=function(){if(!TWP.PostTV.scriptsLoaded&&!TWP.PostTV.loadingScripts){TWP.playerScript=TWP.PostTV.playerVendor==="youtube"?playerScript.youtube:playerScript.jwplayer;loadScripts();TWP.PostTV.loadingScripts=true}else{var r=setInterval(function(){if(TWP.PostTV.loadingScripts){return}else{PubSub.publish("player_script_loaded",TWP.PostTV.playerVendor);clearInterval(r)}},500)}};var k=function(r){q.options.json=r};var m=function(r){function s(t){if(t.contentConfig&&t.contentConfig.streams&&t.contentConfig.streams.length>0){return"jw"}else{if(t.contentConfig&&t.contentConfig.type&&t.contentConfig.type.toLowerCase()=="live"){q.isLive=true;if(t.liveEventConfig&&t.liveEventConfig.streams&&t.liveEventConfig.streams[0]&&t.liveEventConfig.streams[0].url){return"jw"}else{return"youtube"}}else{if(t.embedConfig&&t.embedConfig.embedType&&t.embedConfig.embedType.toLowerCase()=="youtube"){return"youtube"}else{console.log("using jw as last resort");return"jw"}}}}if(TWP.PostTV.playerVendor===null){TWP.PostTV.playerVendor=s(r)}};var j=function(r){function s(u){return u>9?""+u:"0"+u}function t(u){if(!u){return""}return parseInt(u/1000/60)+":"+s(parseInt(u/1000%60))}q.aspectRatio=typeof q.$node.attr("data-aspect-ratio")==="undefined"?false:q.$node.attr("data-aspect-ratio");q.showPlayBtn=q.$node.attr("data-show-play")=="1";if(q.showPlayBtn&&!TWP.PostTV.stylesLoaded){loadStyles()}if(!TWP.PostTV.isDeskweb){q.showPlayBtn=q.showPlayBtn||(q.$node.attr("data-auto-init")!="1"&&q.$node.attr("data-autoplay")=="1")}q.playBtnTxt=q.isLive?"Live Video":"Play Video";q.readableDuration=t(r.contentConfig.videoDuration)};var l=function(r){if(TWP.PostTV.playerVendor!=="jw"){return"16:9"}function t(){if(q.aspectRatio){return q.aspectRatio}var x,u,w;function v(A,z){return(z===0)?A:v(z,A%z)}var y=r.contentConfig.streams||r.liveEventConfig.streams;if(y.length===0&&!queryStringObj.source){console.debug("posttv-player: No playable sources found");return}else{if(y.length===0||queryStringObj.source){x=r.promoImage.image.width;u=r.promoImage.image.height}else{x=y[0].width;u=y[0].height}}w=v(x,u);return x/w+":"+u/w}var s=t();q.$node.attr("data-aspect-ratio",s)};var i=function(r){function s(){var y=q.$node.outerWidth(),w=q.$node.outerHeight(),v,x;if(!q.$node.is(":visible")){return false}if((y&&y<400)||(w&&w<300)){return true}if(q.$node.attr("data-aspect-ratio")){v=q.$node.attr("data-aspect-ratio").split(":");x=y*(parseInt(v[1])/parseInt(v[0]));if(window.console){console.log("estimated height: "+x)}if(x<300){return true}}return false}function t(){var v,w=$('<object type="application/x-shockwave-flash" height="0" width="0"></object>');$("body").append(w);try{if($(":-moz-handler-clicktoplay")[0]){v="clickToPlay"}else{if($(":-moz-handler-vulnerable-updatable")[0]){v="update"}else{if($(":-moz-handler-vulnerable-no-update")[0]){v="noUpdate"}}}}catch(x){if(window.console){console.log(x)}}w.remove();return v}if(q.options.type==="flash"&&TWP.PostTV.isDeskweb&&s()&&!q.isLive){q.options.type="html5";if(window.console){console.log("Defaulting to html5 player due to small size")}}if(q.options.type==="flash"&&TWP.PostTV.isDeskweb&&TWP.PostTV.BrowserInfo.browser==="Firefox"){var u=t();if(u){TWP.PostTV.mozFlashBlockedReason=u;TWP.PostTV.isFlashEnabled=false;q.options.type="html5";if(window.console){console.log("Firefox blocked flash due to "+u+", falling back to HTML5")}}}};var p=function(r){m(r);k(r);g();j(r);l(r);i(r)};var f=function(){var v=$("#"+TWP.videoDataId);if(q.options.json){p(q.options.json)}else{if(v.length>0){var s=$.parseJSON(v.html());p(s)}else{var r=location.host.indexOf("local")>=0||location.host.indexOf("posttv-beta")>=0?"posttv-beta":"video";var u=q.$node.attr("data-video-uuid")||q.$node.attr("data-object-id");var t=(typeof q.$node.attr("data-video-uuid")!="undefined"?"https://js.washingtonpost.com/"+r+"/c/videojson/"+u:"");$.ajax({type:"GET",url:t,contentType:"application/json",jsonpCallback:"cb_"+q.$node.attr("data-video-uuid").replace(/-/g,""),data:{resType:"jsonp"},dataType:"jsonp",cache:true,success:function(w){p(w[0])},error:function(w){if(typeof window.console==="object"){console.log("Failed to fetch video jsonp at: "+t+", e: "+w.message,w,JSON.stringify(w))}d("PostTV Player Data Error",["event999"],{errorCode:"ptv_cannotRetrieveVideoJson",errorText:"Cannot retrieve video json data at: "+t,videoId:q.$node.attr("data-video-uuid")})}})}}};var o=function(){if(q.showPlayBtn){q.drawPlayBtn()}};var e=function(r){if(TWP.PostTV.playerVendor=="youtube"&&q.isLive){r.videoId=r.json.liveEventConfig.youtubeEventId;r.autoplay=c.getAttribute("data-autoplay").length?c.getAttribute("data-autoplay")==="1":1;r.node=c;$(".pb-f-ooyala-player-external #youtube-video-container").show();$(".pb-f-ooyala-player-live #youtube-video-container").show();TWP.PostTV.initYoutubePlayer("youtube-player",r)}else{TWP.PostTV.initInlinePlayer(c,r)}PubSub.subscribe(TWP.PostTV.EVENTS.PLAYER_CREATED,o)};var h=function(){if(q.options.callbacks&&q.options.callbacks.onWillChangeEmbedCode){if(TWP.PostTV.playerVendor=="jw"){PubSub.subscribe(TWP.PostTV.EVENTS.WILL_CHANGE_EMBED_CODE,q.options.callbacks.onWillChangeEmbedCode)}else{$(document).on(TWP.PostTV.EVENTS.WILL_CHANGE_EMBED_CODE,q.options.callbacks.onWillChangeEmbedCode)}}};var d=function(y,w,x){var u="",v="",t="",r="",s;if(window.TWP&&TWP.PostTV&&TWP.PostTV.BrowserInfo){u=TWP.PostTV.BrowserInfo.browser.toLowerCase();v=TWP.PostTV.BrowserInfo.OS.toLowerCase();t=TWP.PostTV.BrowserInfo.version;r=TWP.PostTV.BrowserInfo.webview;s=TWP.PostTV.BrowserInfo.thinkAdBlock}if(window.jQuery){jQuery.ajax({url:"//videotracker.washingtonpost.com/index.html",dataType:"jsonp",cache:false,data:{page:document.title.replace('"','\\"'),channel:"wp - posttv",type:"video",browser:u,browserOS:v,browserVersion:t,webview:r,url:document.URL,HTTP_REFERER:document.referrer,evtName:y,evtType:w,evtTime:new Date().getTime(),errorCode:x.errorCode||"",errorText:x.errorText||"",videoId:x.videoId||"",sessionId:((document.cookie.match(/s_vi=([^;]+)/)?RegExp.$1:"")),playerType:"posttv-embed",thinkAdBlock:s,isUnloading:JSON.stringify(TWP.isUnloading)}})}};PubSub.subscribe("player_script_loaded",function(){h();e(q.options)});f();q.playUuid=function(s,r){r=$.extend({methodeUuid:s},r);if(TWP.PostTV.playerVendor=="jw"){TWP.PostTV.players[c.id].onPlayNextVideo(r)}else{TWP.PostTV.players[c.id].onPlayNextVideo(TWP.PostTV.EVENTS.PLAY_NEXT_VIDEO,r)}};q.movePlayer=function(u){if(!(u instanceof jQuery)){console.log("movePlayer: not a valid jquery obj");return}function r(w){q.state={};q.state.playing=w.player.isPlaying();q.state.playheadTime=w.playheadTime;q.state.hasPlayedAd=w.player.hasPlayedAd()}function s(w){if(!q.state.playing){var x=PubSub.subscribe(TWP.PostTV.EVENTS.PLAYING,function(z,y){w.seek(q.state.playheadTime);PubSub.unsubscribe(x)});if(q.$elBtn){q.$elBtn.show()}}else{w.seek(q.state.playheadTime)}}if(typeof TWP.PostTV.players[c.id]!=="undefined"){var t=TWP.PostTV.players[c.id];if(t.args&&t.args.type=="flash"){console.log("Player can only be moved in html5 mode");return}r(t);u.prepend(q.$node);var v=PubSub.subscribe(TWP.PostTV.EVENTS.PLAYER_CREATED,function(){if(q.state){s(t)}PubSub.unsubscribe(v)})}};q.drawPlayBtn=function(){if(q.$node.find(".ptv-button")&&q.$node.find(".ptv-button").length>0){return}function s(){var t=q.$node.width();if(t<=300){q.$node.addClass("sm-player")}else{q.$node.removeClass("sm-player")}}q.$elBtn=$("<div>",{"class":"ptv-button"});var r=$('<i class="fa fa-play"></i><span class="ptv-promo-play-prompt franklin-bold">'+q.playBtnTxt+'</span><span class="ptv-promo-play-duration franklin-light">'+q.readableDuration+"</span>");q.$elBtn.append(r);q.$elBtn.click(function(){var t=$(this);if(typeof TWP.PostTV.players[c.id]!=="undefined"){TWP.PostTV.players[c.id].play();$(this).hide();PubSub.subscribe(TWP.PostTV.EVENTS.PLAY_COMPLETED,function(v,u){if(u.playerContainerId===c.id){q.$elBtn.show()}})}});if(typeof TWP.PostTV.players[c.id]!=="undefined"){q.$node.prepend(q.$elBtn);PubSub.subscribe(TWP.PostTV.EVENTS.AD_STARTED,function(u,t){if(t.playerContainerId===c.id){q.$elBtn.hide()}});PubSub.subscribe(TWP.PostTV.EVENTS.PLAYING,function(u,t){if(t.playerContainerId===c.id){q.$elBtn.hide()}})}};if(contextPath.indexOf("posttv-beta")>-1){d("PostTV Player posttv-beta",["event994"],{errorCode:"ptv_loadingBeta",errorText:"posttv-player.js loaded on posttv-beta",videoId:$("#"+c.id).attr("data-video-uuid")})}return{playUuid:q.playUuid,drawPlayBtn:q.drawPlayBtn,movePlayer:q.movePlayer}};return new a()};