(function($,window){var core=window.wp_pb=window.wp_pb||{};var nav=core.nav=core.nav||{};var wpHeader={init:function(){if($("#page").hasClass("ie8"))return;else{if($("#pb-root .pb-f-page-header-v2").length){var $header=$(".pb-f-page-header-v2");$("#pb-root").before($header)}if(window.ActiveXObject||"ActiveXObject"in window){$("#main-sections-nav").addClass("ie");$("#wp-header").addClass("ie")}$("#sections-menu-off-canvas ul.side-nav li").each(function(){if($(this).hasClass("nav-screenreader-link"))return;
var item=$(this).find("\x3ea"),itemText=item.html().replace(/\s+/g,"").replace(/\&/g,"-").toLowerCase(),itemLink=item.attr("href");if($(this).hasClass("main-nav"))item.attr("href",itemLink+"?nid\x3dmenu_nav_"+itemText);else if($(this).hasClass("sub-nav-item")){var mainItem=$(this).parents(".main-nav").find("\x3ea").text().replace(/\s+/g,"").replace(/\&/g,"-").toLowerCase();item.attr("href",itemLink+"?nid\x3dmenu_nav_"+mainItem+"-"+itemText)}});$("#sections-menu-wide li").each(function(){var item=
$(this).find("a"),itemText=item.html().replace(/\s+/g,"").replace(/\&/g,"-").toLowerCase(),itemLink=item.attr("href");item.attr("href",itemLink+"?nid\x3dtop_nav_"+itemText)});(function(){var searchIconHovered;$("#search-btn").click(function(e){if($(this).hasClass("closed")){$(this).removeClass("closed").addClass("opened");$("#search-field").removeClass("closed").addClass("opened");$("#search-field").focus()}else if($(this).hasClass("opened"))$("#search-form").submit()});$("#search-btn").bind("mouseover",
function(){if($(this).hasClass("opened"))searchIconHovered=true}).bind("mouseout",function(){if($(this).hasClass("opened"))searchIconHovered=false});$("#search-field").blur(function(e){if($(this).hasClass("opened")&&!searchIconHovered){$(this).removeClass("opened").addClass("closed");$("#search-btn").removeClass("opened").addClass("closed")}});$("#search-form, #nav-search-mobile").submit(function(event){if($(this).find("input[type\x3dtext]").val()){try{s.sendDataToOmniture("Search Submit","event2",
{"eVar38":$(this).find("input[type\x3dtext]").val(),"eVar1":s.pageName})}catch(e){}return true}else return false})})();(function(){var timer;$("#logged-in-status .nav-sign-in").hover(function(e){$("#nav-subscribe").addClass("signIn-hover")},function(e){$("#nav-subscribe").removeClass("signIn-hover")});$("#sections-menu-off-canvas li a").hover(function(e){$(this).addClass("hover-name");$(this).parent().addClass("unhover-list")},function(e){$(this).removeClass("hover-name");$(this).parent().removeClass("unhover-list")});
$("#nav-user").click(function(){$("#user-menu").toggleClass("nav-user-show")});$("#settings-nav-btn").click(function(){if($("#logged-in-status").hasClass("logged-in"))$("#user-menu").toggleClass("nav-user-show");else $(".sign-up-buttons").toggleClass("nav-user-show")});function delayHover(element){timer=setTimeout(function(){$("#main-sections-nav").addClass("subNavigation");$(element).addClass("hover")},75)}$(".main-nav").hover(function(){delayHover($(this))},function(){$(this).removeClass("hover");
$("#main-sections-nav").removeClass("subNavigation");clearTimeout(timer)});if($(window).width()<=480)$(".main-nav").click(function(){location.href=$(this).find(".main-nav-item").attr("href")})})()}},setupNav:function(){$.fn.appendLinkItems=function(links,surroundingTag){var element=this;surroundingTag=surroundingTag||"\x3cli\x3e";$.each(links,function(i,link){var a=$("\x3ca\x3e");if(link.title)a.text(link.title);if(link.html)a.html(link.html);if(link.href)a.attr("href",link.href);if(link.attr)a.attr(link.attr);
element.append($(surroundingTag).append(a).addClass(link.selected?"selected":""))});return this};nav.setIdentityMenu=function(menu){var element=$("#user-menu ul");element.children("li").remove();element.appendLinkItems(menu)};nav.closeDropdowns=function(){$("#wp-header .dropdown-trigger.active").each(function(){$(this).removeClass("active");$("#"+$(this).data("menu")).hide()});$(".leaderboard").removeClass("hideAd")};nav.showNav=function(){if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report==
"function"){wp_pb.report("nav","start_open",true);setTimeout(function(){$("#wp-header").removeClass("bar-hidden");wp_pb.report("nav","finish_open",true)},250)}};nav.hideNav=function(){if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report=="function"){wp_pb.report("nav","start_close",true);setTimeout(function(){wp_pb.report("nav","finish_close",true);$("#wp-header").addClass("bar-hidden")},250)}};$(".section-menu-btn").click(function(event){event.stopPropagation();event.preventDefault();var _clickElement=
$(this),_menuElement=$("#main-sections-nav");if(_menuElement.hasClass("active")){$("body").removeClass("left-menu left-menu-pb");_clickElement.removeClass("active");_menuElement.removeClass("active");if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report=="function"){wp_pb.report("nav","menu_start_close",true);setTimeout(function(){wp_pb.report("nav","menu_finish_close",true)},500)}}else{_menuElement.css("height",$(window).height()-45);$("body").addClass("left-menu left-menu-pb");_clickElement.addClass("active");
_menuElement.addClass("active");if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report=="function"){wp_pb.report("nav","menu_start_open",true);setTimeout(function(){wp_pb.report("nav","menu_finish_open",true)},500)}}calcSubnavPosition()})},setScrollEvents:function(){var isHomepage=$("#logo-in-nav").hasClass("homePage"),scrollPos=$(this).scrollTop(),isMobileDevice=isMobile(),notificationBar=$(".pb-f-page-notification-bar"),notificationOffset=0;if(notificationBar.length)notificationOffset=notificationBar.outerHeight();
if(isHomepage){$("#logo-in-nav").removeClass("nav-display-show").addClass("nav-display-hide");$(window).scroll(function(){var navchange=false,widthbreak=768,window_width=$(window).width(),y_scroll_pos=window.pageYOffset,scroll_pos_test=80;if(window_width>=widthbreak)if(y_scroll_pos>scroll_pos_test&&navchange==false){navchange=true;$("#sections-menu-wide").removeClass("nav-display-show").addClass("nav-display-hide");$("#logo-in-nav").addClass("nav-display-show").removeClass("nav-display-hide")}else if(y_scroll_pos<=
0){navchange=false;if(!$("#section-menu-btn").hasClass("active")){$("#logo-in-nav").removeClass("nav-display-show").addClass("nav-display-hide");$("#sections-menu-wide").addClass("nav-display-show").removeClass("nav-display-hide")}}if($("#main-sections-nav").hasClass("active"))calcSubnavPosition()})}else if(!isHomepage||isMobileDevice){var timeOutTime=50,scrollHeight=150;if(isMobileDevice){scrollHeight=30;timeOutTime=25}$(window).scroll(function(){if(!$("#section-menu-btn").hasClass("active")){var currentPos=
$(this).scrollTop();if(currentPos+80<scrollPos||currentPos===0){var copyPos=currentPos;setTimeout(function(){var lastPos=$(this).scrollTop();if(copyPos-lastPos>scrollHeight||currentPos===0){nav.showNav();scrollPos=currentPos}},timeOutTime)}else if(currentPos-80>scrollPos&&currentPos>50+notificationOffset){nav.hideNav();scrollPos=currentPos}$("#user-menu").removeClass("nav-user-show");$(".sign-up-buttons").removeClass("nav-user-show")}if($("#main-sections-nav").hasClass("active"))calcSubnavPosition()})}$(window).resize(function(){nav.closeDropdowns();
if($("body").hasClass("left-menu"))$("#main-sections-nav").css("height",$(window).height()-45)});$(document).ready(function(){wp_pb.register("nav","force-show",function(){nav.showNav()})})},setIdentity:function(){var idp;nav.getIdentityProvider=function(){return idp};nav.setIdentityProvider=function(provider){var ef=function(){};idp={};idp.name=provider.name||"";idp.getUserId=provider.getUserId||ef;idp.getUserMenu=provider.getUserMenu||ef;idp.getSignInLink=provider.getSignInLink||ef;idp.getRegistrationLink=
provider.getRegistrationLink||ef;idp.isUserLoggedIn=provider.isUserLoggedIn||ef;idp.isUserSubscriber=provider.isUserSubscriber||ef;idp.render=provider.render||function(){if(idp.isUserLoggedIn()){$("#nav-user .username").text(idp.getUserId());nav.setIdentityMenu(idp.getUserMenu());$("#nav-user, #user-menu").removeClass("hidden");if(idp.isUserSubscriber()==="0"){$("#user-menu ul li:first-child").after($("#nav-subscribe").clone());$("#user-menu  #nav-subscribe").removeClass("hidden")}$("#user-menu ul li:first-child").after($("#nav-reading-list").clone().removeClass("hidden"));
$("#logged-in-status").addClass("logged-in")}else{$("#sign-in-link").attr("href",idp.getSignInLink()+"\x26nid\x3dtop_pb_signin");$(".nav-sign-in").removeClass("hidden");$("#nav-subscribe").removeClass("hidden");$("#nav-subscribe-mobile").removeClass("hidden")}};nav.renderIdentity()};nav.renderIdentity=function(callback){callback=callback||function(){};if(idp)idp.render();callback(idp)};var showIdentity=$("#nav-user").data("show-identity");var current=window.location.href.split("?")[0];var twpIdentity=
{name:"TWP",getUserId:function(){var username=TWP.Util.User.getUserName();var userid=TWP.Util.User.getUserId();if(typeof username=="string"&&username.length>0)return username;else return userid},getUserMenu:function(){return[{"title":"Profile","href":TWP.signin.profileurl+current+"\x26refresh\x3dtrue"},{"title":"Log out","href":TWP.signin.logouturl_page}]},getSignInLink:function(){return TWP.signin.loginurl_page+current},getRegistrationLink:function(){return TWP.signin.registrationurl_page+current},
isUserSubscriber:function(){sub=document.cookie.match(/rplsb=([0-9]+)/)?RegExp.$1:"";return sub},isUserLoggedIn:function(){return TWP.Util.User?TWP.Util.User.getAuthentication():false}};if(showIdentity){var init=(new Date).getTime();(function checkTWP(){if(!nav.getIdentityProvider())if(TWP&&TWP.signin&&TWP.Util){nav.setIdentityProvider(twpIdentity);nav.renderIdentity()}else{var now=(new Date).getTime();window.setTimeout(function(){checkTWP()},200)}})()}}};function isMobile(){if(navigator.userAgent.match(/Android/i)||
navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Kindle/i)||navigator.userAgent.match(/Windows Phone/i))return true;else return false}function calcSubnavPosition(){$("#sections-menu-off-canvas \x3e ul \x3e li").each(function(){if(!$("#main-sections-nav").hasClass("active"))return;if($(this).hasClass("has-sub")){var movetop=$(this).find("ul").height()/2-10,offsetY=$(this).offset().top-
$(window).scrollTop();if(offsetY<94)movetop=0;else if(offsetY-movetop<95)movetop=offsetY-95;$(this).find("ul").css("top","-"+movetop+"px")}})}wpHeader.init();wpHeader.setupNav();wpHeader.setScrollEvents();wpHeader.setIdentity()})(jQuery,window);
(function(){var socialTools={myRoot:".top-sharebar-wrapper",init:function(myRoot){stickyShareBar.init();var self=this;myRoot=myRoot||this.myRoot;$myRoot=$(myRoot);$myRoot.each(function(index,myRootElement){if(wp_pb.StaticMethods.staticPostShare)wp_pb.StaticMethods.staticPostShare.init($(myRootElement),$(myRootElement).data("postshare"));var $root=$(myRootElement),$individualTool=$(".tool:not(.more, .read-later-bookmark, .read-later-list)",$root),$socialToolsWrapper=$(".social-tools-wrapper",$root),
$socialToolsMoreBtn=$(".tool.more",$socialToolsWrapper),$socialToolsAdditional=$(".social-tools-additional",$root),width=window.innerWidth>0?window.innerWidth:screen.width,isMobile=mobile_browser===1&&width<480?true:false;$socialToolsMoreBtn.off("click").on("click",this,function(ev){$socialToolsMoreBtn.hide();$socialToolsAdditional.show("fast",function(ev){$root.addClass("expanded");$(".social-tools",$socialToolsAdditional).animate({"margin-left":0},4250)}).css("display","inline")});$individualTool.bind({click:function(event){var shareType=
$(this).attr("class");shareType=typeof shareType!="undefined"?shareType.split(" ")[0].trim():"";self.trackTraffic("share."+shareType,shareType+"_bar")}});if(wp_pb&&wp_pb.BrowserInfo&&wp_pb.BrowserInfo.tablet)$root.addClass("tablet");$root.removeClass("unprocessed")});this.enableReadLater($myRoot)},trackTraffic:function(name,eVar27){if(typeof window.sendDataToOmniture==="function"){var omnitureVars={"eVar1":typeof window.s=="object"&&s&&s.eVar1,"eVar2":typeof window.s=="object"&&s&&s.eVar2,"eVar8":typeof window.s==
"object"&&s&&s.eVar8,"eVar17":typeof window.s=="object"&&s&&s.eVar17,"eVar27":eVar27};try{sendDataToOmniture(name,"event6",omnitureVars)}catch(e){}}},enableReadLater:function($root){var $notificationBar=$(".social-notification-bar",$root),$bookMark=$(".read-later-bookmark",$root);if($bookMark.length){$root.readingList=new wp_pb.StaticMethods.staticReadingList;var wapo_login_id=document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:"",doActions=function(isExist){var func=isExist?$root.readingList.remove:
$root.readingList.save,perfom=func.call(undefined,window.location.href);perfom.then(function(){if(isExist){$bookMark.find(".fa").removeClass("fa-bookmark").addClass("fa-bookmark-o");$bookMark.data("isExist",false)}else{$bookMark.find(".fa").removeClass("fa-bookmark-o").addClass("fa-bookmark");$bookMark.data("isExist",true);addBarAds();$notificationBar.toggleClass("show");setTimeout(function(){$notificationBar.toggleClass("show")},4E3)}});return perfom},addBarAds=function(){var $ad=$notificationBar.find("#slug_read_later_notification_desktop");
if(!$ad.length){$notificationBar.find("#read_later_notification_desktop").attr("id","slug_read_later_notification_desktop");if(typeof window.placeAd2=="function")placeAd2({what:"read_later_notification_desktop"})}},setCookie=function(cname,cvalue,exmins){var d=new Date,expires="";if(exmins){d.setTime(d.getTime()+exmins*60*1E3);expires="expires\x3d"+d.toUTCString()}document.cookie=cname+"\x3d"+cvalue+"; "+expires};if(wapo_login_id)$root.readingList.checkExist(window.location.href).then(function(response){if(response.value)$bookMark.find(".fa").removeClass("fa-bookmark-o").addClass("fa-bookmark");
$bookMark.data("isExist",response.value);var isFromSignIn=document.cookie.match(/read-later-after-login-save=([^;]+)/)?RegExp.$1:"";if(isFromSignIn){if(!response.value)doActions(response.value);setCookie("read-later-after-login-save","",-20)}});$bookMark.off("click").on("click",function(ev){var isExist=$bookMark.data("isExist");doActions(isExist)});$(".login-btn",$root).off("click").on("click",function(){setCookie("read-later-after-login-save",true,20);var trafficeName="read_later-login";self.trackTraffic(trafficeName,
trafficeName);window.location.href=TWP.signin.loginurl_page+encodeURIComponent(window.location.href);return false});$(".create-account-btn",$root).off("click").on("click",function(){setCookie("read-later-after-login-save",true,20);var trafficeName="read_later-create-account";self.trackTraffic(trafficeName,trafficeName);window.location.href=TWP.signin.registrationurl_page+"?destination\x3d"+encodeURIComponent(window.location.href);return false});$(".read-later-list",$root).off("click").on("click",
function(){window.location.href=wp_pb.contextPath+"/readinglist/?tid\x3dtop-share-bar";return false})}}};var stickyShareBar={setElmTop:function($sharebarElm,y){var style=y?"translate3d(0px, "+y+"px, 0px)":"initial";$sharebarElm.css({"transform":style})},navMenuToggle:function($sharebarElm){wp_pb.register("nav","finish_open",function(){this.setElmTop($sharebarElm,0)},this);wp_pb.register("nav","finish_close",function(){this.setElmTop($sharebarElm,-50)},this);wp_pb.register("magnet","start_open",function(){},
this)},fixedPosition:function($sharebarElm,sharebarTop){var currentTop=$(window).scrollTop();if(currentTop>sharebarTop){if(!$sharebarElm.hasClass("top-sharebar-fixed"))$sharebarElm.addClass("top-sharebar-fixed")}else $sharebarElm.removeClass("top-sharebar-fixed");if($(".shareBar-follow-modal").css("display")=="block")if($("#wp-header").height()>0)$(".shareBar-follow-modal").addClass("fixedModalNav").removeClass("fixedModal");else $(".shareBar-follow-modal").addClass("fixedModal").removeClass("fixedModalNav")},
moveOutOfRoot:function($sharebarElm){var $pbRoot=$("#pb-root");if($pbRoot.css("max-width")!=="none"){var $sharebarRoot=$sharebarElm.parent();var $leaderboard=$(".pb-f-ad-leaderboard");$pbRoot.before($sharebarRoot);$pbRoot.before($leaderboard)}},detectMobileForSMS:function(){if(mobile_browser){var shareString="";if(windows_browser)shareString="sms://?body\x3d";else if(android_browser||android233_browser)shareString="sms:?body\x3d";if(shareString.length>0)$(".pb-f-sharebars-top-share-bar .sms-share-device.unprocessed").each(function(){$(this).attr("onclick",
$(this).attr("onclick").replace(/sms:\/\/&body=/g,shareString));$(this).removeClass("unprocessed")});else $(".pb-f-sharebars-top-share-bar .sms-share-device.unprocessed").removeClass("unprocessed")}},init:function(){var $sharebarElm=$(".sticky-top-sharebar"),self=this;if(!$sharebarElm.length)return;this.moveOutOfRoot($sharebarElm);var sharebarTop=$sharebarElm.offset().top;var $header=$("#wp-header");if($header.css("position")==="fixed"&&$(window).scrollTop()>sharebarTop)this.fixedPosition($sharebarElm,
sharebarTop);$(window).off("scroll.sharebar").on("scroll.sharebar",function(){self.fixedPosition($sharebarElm,sharebarTop)});$(document).ready(function(){self.navMenuToggle($sharebarElm)});this.detectMobileForSMS()}};var userId=document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:"";var userSecureId=document.cookie.match(/wapo_secure_login_id=([^;]+)/)?RegExp.$1:"";var userAgent=navigator.userAgent;var follow={init:function(){var userSignedIn=userId!==""?true:false,userApiUrl="",jsonData={},getUserData=
true,followed=[];$("#shareBar-follow").removeClass("hide");if(userSignedIn){userApiUrl="https://follow.washingtonpost.com/Follow/api/user";jsonData={washPostId:userId,wapoLoginID:userId,wapoSecureID:userSecureId,userAgent:userAgent}}else if(localStorage.getItem("wp_follow_modal_email")){userApiUrl="https://follow.washingtonpost.com/Follow/api/anonymous-user";jsonData={emailId:localStorage.getItem("wp_follow_modal_email")}}else getUserData=false;if(getUserData)$.ajax({type:"POST",url:userApiUrl,contentType:"application/json",
dataType:"json",data:JSON.stringify(jsonData),success:function(data){if(data.emailId)localStorage.setItem("wp_follow_modal_email",data.emailId);if(data.tags)for(var i=0,len=data.tags.length;i<len;i++)if(data.tags[i].type==="category")followed.push(data.tags[i].slug);if(followed.indexOf($("#subtitle-follow").data("categorySlug"))>=0){$("#shareBar-follow").addClass("following");$("#shareBar-follow .followLbl").text("Following")}}});$("#shareBar-follow").on("click",function(){var $this=$(this);var endpoint=
$this.hasClass("following")?"unfollow":"follow",categorySlug=$this.data("categorySlug"),categoryTitle=$this.data("categoryTitle"),position={};position.top=55;position.left=650;function applyCallBack(data){if(endpoint==="follow")$this.addClass("following").find(".followLbl").text("Following");else $this.removeClass("following").find(".followLbl").text("Follow");if(endpoint==="follow")s.sendDataToOmniture("Follow","event103",{eVar1:s.eVar1,eVar2:s.eVar2,eVar26:"fl_sharebar_topic_"+categorySlug.replace(/-/g,
"")});else s.sendDataToOmniture("Unfollow","event104",{eVar1:s.eVar1,eVar2:s.eVar2,eVar26:"fl_sharebar_topic_"+categorySlug.replace(/-/g,"")})}var data={categorySlug:categorySlug,categoryTitle:categoryTitle,signedIn:userSignedIn,endpoint:endpoint,callBack:applyCallBack};if(endpoint==="follow"){data.position=position;if(localStorage.getItem("wp_follow_modal_seen")!=="true"||!localStorage.getItem("wp_follow_modal_email")){var tagData={"tag":{"slug":categorySlug,"type":"category"}};$.ajax({type:"POST",
url:"https://follow.washingtonpost.com/Follow/api/tag",contentType:"application/json",dataType:"json",data:JSON.stringify(tagData),success:function(result){data.categoryDesc=result.tag.description;follow.displayPip(data)},error:function(reason){follow.displayPip(data)}})}else{data.email=localStorage.getItem("wp_follow_modal_email");follow.followApi(data)}}else follow.unfollowApi(data);return false});if(typeof Hammer==="function"&&wp_pb.BrowserInfo.mobile_browser)try{var hammertime=new Hammer($("#shareBar-follow")[0],
{prevent_mouseevents:true});hammertime.on("tap",handleTap)}catch(err){}function handleTap(ev){ev.gesture.preventDefault();ev.gesture.stopPropagation();$(ev.gesture.target).click();$(ev.gesture.target).blur()}},displayPip:function(data){var modal=$(".shareBar-follow-modal");if(data.signedIn===false){modal.find(".not-signed-In.before").removeClass("hide");modal.find(".not-signed-In.after").addClass("hide");modal.find(".signed-In").addClass("hide");if(localStorage.getItem("wp_follow_modal_email"))modal.find("#follow-modal-input").val(localStorage.getItem("wp_follow_modal_email"))}else{modal.find(".not-signed-In").addClass("hide");
modal.find(".signed-In").removeClass("hide");data.position.top+=20}modal.find(".category-desc").text(data.categoryDesc?data.categoryDesc:"");modal.css("top",data.position.top);modal.css("left",data.position.left);if($("#wp-header").css("position")==="fixed")if($("#wp-header").height()>0)modal.addClass("fixedModalNav");else modal.addClass("fixedModal");modal.jqm({overlayClass:"sharebar-follow-modal",overlay:0,onHide:function(hash){modal.find(".sign-up").off("click");modal.find(".follow-modal-close").off("click");
modal.find(".got-it").off("click");hash.w.hide()&&hash.o&&hash.o.remove();return true}});modal.find(".sign-up").click(function(){var email=modal.find("#follow-modal-input").val();var re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/igm;if(email===""||!re.test(email))$(".invalid-email").show();else{$(".invalid-email").hide();data.email=email;localStorage.setItem("wp_follow_modal_email",email);follow.followApi(data,function(){modal.find(".not-signed-In.before").addClass("hide");modal.find(".not-signed-In.after").removeClass("hide")})}});
modal.find(".follow-modal-close").click(function(){modal.jqmHide()});modal.find(".got-it").click(function(){modal.jqmHide()});if(data.signedIn)follow.followApi(data,function(){if(localStorage.getItem("wp_follow_modal_seen")!=="true"){modal.jqmShow();localStorage.setItem("wp_follow_modal_seen","true")}});else if(localStorage.getItem("wp_follow_modal_seen")!=="true"||!localStorage.getItem("wp_follow_modal_email")){modal.jqmShow();s.sendDataToOmniture("Follow","event101",{eVar1:s.eVar1,eVar2:s.eVar2,
eVar26:"fl_sharebar_topic_"+data.categorySlug.replace(/-/g,"")});localStorage.setItem("wp_follow_modal_seen","true")}else{data.email=localStorage.getItem("wp_follow_modal_email");follow.followApi(data)}},followApi:function(data,callBack){var serviceBase="https://follow.washingtonpost.com",jsonData={washPostId:userId,tags:[]};if(data.email&&data.signedIn===false){serviceBase+="/Follow/api/anonymous-follow";jsonData.emailId=data.email;jsonData.tags=[{slug:data.categorySlug,type:"category"}]}else{serviceBase+=
"/Follow/api/follow";jsonData.tags=[{slug:data.categorySlug,title:data.categoryTitle,level:1,type:"category"}]}$.ajax({type:"POST",url:serviceBase,contentType:"application/json",dataType:"json",data:JSON.stringify(jsonData),success:function(result){if(result.status===true){data.callBack(data);if(callBack)callBack()}}})},unfollowApi:function(data){var serviceBase="https://follow.washingtonpost.com";var tags=[{slug:data.categorySlug,title:data.categoryTitle,level:1,type:"category"}];var jsonData={washPostId:userId,
wapoLoginID:userId,wapoSecureID:userSecureId,userAgent:userAgent,tags:tags};if(data.signedIn)serviceBase+="/Follow/api/unfollow";else{serviceBase+="/Follow/api/anonymous-unfollow";jsonData.emailId=localStorage.getItem("wp_follow_modal_email")}$.ajax({type:"POST",url:serviceBase,contentType:"application/json",dataType:"json",data:JSON.stringify(jsonData),success:function(responce){if(responce.status===true&&data.callBack)data.callBack(responce)}})},localStorageAvailable:function(){var test="test";
try{localStorage.setItem(test,test);localStorage.removeItem(test);return true}catch(e){return false}}};window.TWP=TWP||{};TWP.SocialTools=TWP.SocialTools||socialTools;TWP.SocialTools.init();var tablet=isMobile.tablet();window.VisitorSegment&&VisitorSegment("tablet",function(){return tablet&&$(window).width()>768})})();
(function($,TWP,undefined){var AD_LOAD_TIMER=2E3;var AD_MIN_VISIBLE=4E3;var AD_HEIGHT_LIMITED=150;var ANIM_SPEED=250;var console=new TWP.Tools.logger("leaderboard");var applyStickiness=function(){if(wp_pb.BrowserInfo&&wp_pb.BrowserInfo.tablet)return;$(function(){var $html=$("html"),$feature=getFeature().find(".leaderboard"),$window=$(window);if(!$feature.length)return;var original_top=$feature.offset().top;function removeSticky(){setTimeout(function(){$feature.slideUp(ANIM_SPEED,function(){$html.removeClass("lb-persist-top-true");
$feature.slideDown(ANIM_SPEED)})},AD_MIN_VISIBLE)}function applySticky(){if($window.scrollTop()>original_top)$html.addClass("lb-persist-top-true");else $html.removeClass("lb-persist-top-true")}function bindEvents(){$window.on("scroll.lb-sticky",function(e){e.stopPropagation();applySticky()});wp_pb.register("nav","finish_open",function(){$feature.removeClass("pb-navheader-hidden")});wp_pb.register("nav","finish_close",function(){$feature.addClass("pb-navheader-hidden")})}function afterAdInserted(){var afterLoaded=
function(){var $featureContainer=getFeature();if($feature.height()>$featureContainer.outerHeight())$featureContainer.height($feature.height()+30);$feature.addClass("leaderboard-ad-loaded");$window.off("scroll.lb-sticky");if($html.hasClass("lb-persist-top-true"))removeSticky()};if(window.googletag&&googletag.pubadsReady){var targetSlot="slug_leaderboard";googletag.pubads().addEventListener("slotRenderEnded",function(event){if(event.slot.l.m===targetSlot)setTimeout(function(){afterLoaded()},AD_LOAD_TIMER)})}}
$feature.on("DOMNodeInserted",function(e){var $el=$(e.target),id=$el.attr("id");if($el.is("iframe")&&id&&!/(hidden)/g.test(id)){$feature.off("DOMNodeInserted");afterAdInserted()}});applySticky();bindEvents()})};if(!!TWP.Features.Ad.Leaderboard.sticky)applyStickiness();if(!!TWP.Features.Ad.Leaderboard.belowSharebar)applySharebarPosition();$(window.document).on("abtest-ready",function(e,ABT){var test=ABT.get("ads-leaderboard");getFeature().attr("moat-test-id",[getFeature().attr("moat-id")||"unknown/unknown",
test.name||"control"].join("-"));if(test.is("below_sharebar"))applySharebarPosition();if(test.is("sticky"))applyStickiness()});function applySharebarPosition(){var $leaderboard=getFeature();var $shareBar=getSharebar();$leaderboard.addClass("after-sharebar-leaderboard");return $leaderboard.insertAfter($shareBar)}function getFeature(){return $(".pb-f-ad-leaderboard")}function getSharebar(){return $(".pb-f-sharebars-top-share-bar")}})(jQuery,TWP);
(function($){var userId=document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:"";var userSecureId=document.cookie.match(/wapo_secure_login_id=([^;]+)/)?RegExp.$1:"";var userAgent=navigator.userAgent;var follow={init:function(){var userSignedIn=userId!==""?true:false,userApiUrl="",jsonData={},getUserData=true,followed=[];$("#subtitle-follow").removeClass("hide");if(userSignedIn){userApiUrl="https://follow.washingtonpost.com/Follow/api/user";jsonData={washPostId:userId,wapoLoginID:userId,wapoSecureID:userSecureId,
userAgent:userAgent}}else if(follow.localStorageAvailable()&&localStorage.getItem("wp_follow_modal_email")){userApiUrl="https://follow.washingtonpost.com/Follow/api/anonymous-user";jsonData={emailId:localStorage.getItem("wp_follow_modal_email")}}else getUserData=false;if(getUserData)$.ajax({type:"POST",url:userApiUrl,contentType:"application/json",dataType:"json",data:JSON.stringify(jsonData),success:function(data){if(follow.localStorageAvailable()&&data.emailId)localStorage.setItem("wp_follow_modal_email",
data.emailId);if(data.tags)for(var i=0,len=data.tags.length;i<len;i++)if(data.tags[i].type==="category")followed.push(data.tags[i].slug);if(followed.indexOf($("#subtitle-follow").data("categorySlug"))>=0){$("#subtitle-follow").addClass("following");$("#subtitle-follow .followLbl").text("Following")}}});$("#subtitle-follow").on("click",function(){var $this=$(this);var endpoint=$this.hasClass("following")?"unfollow":"follow",categorySlug=$this.data("categorySlug"),categoryTitle=$this.data("categoryTitle"),
position={};position.top=35;position.left=485;function applyCallBack(data){if(endpoint==="follow")$this.addClass("following").find(".followLbl").text("Following");else $this.removeClass("following").find(".followLbl").text("Follow");if(endpoint==="follow")s.sendDataToOmniture("Follow","event103",{eVar1:s.eVar1,eVar2:s.eVar2,eVar26:"fl_top_topic_"+categorySlug.replace(/-/g,"")});else s.sendDataToOmniture("Unfollow","event104",{eVar1:s.eVar1,eVar2:s.eVar2,eVar26:"fl_top_topic_"+categorySlug.replace(/-/g,
"")})}var data={categorySlug:categorySlug,categoryTitle:categoryTitle,signedIn:userSignedIn,endpoint:endpoint,callBack:applyCallBack};if(endpoint==="follow"){data.position=position;if(follow.localStorageAvailable()&&(localStorage.getItem("wp_follow_modal_seen")!=="true"||!localStorage.getItem("wp_follow_modal_email"))){var tagData={"tag":{"slug":categorySlug,"type":"category"}};$.ajax({type:"POST",url:"https://follow.washingtonpost.com/Follow/api/tag",contentType:"application/json",dataType:"json",
data:JSON.stringify(tagData),success:function(result){data.categoryDesc=result.tag.description;follow.displayPip(data)},error:function(reason){follow.displayPip(data)}})}else{data.email=follow.localStorageAvailable()?localStorage.getItem("wp_follow_modal_email"):"";follow.followApi(data)}}else follow.unfollowApi(data);return false});if(typeof Hammer==="function"&&wp_pb.BrowserInfo.mobile_browser)try{var hammertime=new Hammer($("#subtitle-follow")[0],{prevent_mouseevents:true});hammertime.on("tap",
handleTap)}catch(err){}function handleTap(ev){ev.gesture.preventDefault();ev.gesture.stopPropagation();$(ev.gesture.target).click();$(ev.gesture.target).blur()}},displayPip:function(data){var modal=$(".subTitle-follow-modal");if(data.signedIn===false){modal.find(".not-signed-In.before").removeClass("hide");modal.find(".not-signed-In.after").addClass("hide");modal.find(".signed-In").addClass("hide");if(follow.localStorageAvailable()&&localStorage.getItem("wp_follow_modal_email"))modal.find("#follow-modal-input").val(localStorage.getItem("wp_follow_modal_email"))}else{modal.find(".not-signed-In").addClass("hide");
modal.find(".signed-In").removeClass("hide");data.position.top+=20}modal.find(".category-desc").text(data.categoryDesc?data.categoryDesc:"");modal.css("top",data.position.top);modal.css("left",data.position.left);modal.jqm({overlayClass:"article-topper-follow-modal",overlay:0,onHide:function(hash){modal.find(".sign-up").off("click");modal.find(".follow-modal-close").off("click");modal.find(".got-it").off("click");hash.w.hide()&&hash.o&&hash.o.remove();return true}});modal.find(".sign-up").click(function(){var email=
modal.find("#follow-modal-input").val();var re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/igm;if(email==""||!re.test(email))$(".invalid-email").show();else{$(".invalid-email").hide();data.email=email;if(follow.localStorageAvailable())localStorage.setItem("wp_follow_modal_email",email);follow.followApi(data,function(){modal.find(".not-signed-In.before").addClass("hide");modal.find(".not-signed-In.after").removeClass("hide")})}});modal.find(".follow-modal-close").click(function(){modal.jqmHide()});modal.find(".got-it").click(function(){modal.jqmHide()});
if(data.signedIn)follow.followApi(data,function(){if(follow.localStorageAvailable()&&localStorage.getItem("wp_follow_modal_seen")!=="true"){modal.jqmShow();localStorage.setItem("wp_follow_modal_seen","true")}else modal.jqmShow()});else if(follow.localStorageAvailable()&&(localStorage.getItem("wp_follow_modal_seen")!=="true"||!localStorage.getItem("wp_follow_modal_email"))){modal.jqmShow();s.sendDataToOmniture("Follow","event101",{eVar1:s.eVar1,eVar2:s.eVar2,eVar26:"fl_top_topic_"+data.categorySlug.replace(/-/g,
"")});localStorage.setItem("wp_follow_modal_seen","true")}else{if(follow.localStorageAvailable())data.email=localStorage.getItem("wp_follow_modal_email");follow.followApi(data)}},followApi:function(data,callBack){var serviceBase="https://follow.washingtonpost.com",jsonData={washPostId:userId,tags:[]};if(data.email&&data.signedIn==false){serviceBase+="/Follow/api/anonymous-follow";jsonData.emailId=data.email;jsonData.tags=[{slug:data.categorySlug,type:"category"}]}else{serviceBase+="/Follow/api/follow";
jsonData.tags=[{slug:data.categorySlug,title:data.categoryTitle,level:1,type:"category"}]}$.ajax({type:"POST",url:serviceBase,contentType:"application/json",dataType:"json",data:JSON.stringify(jsonData),success:function(result){if(result.status==true){data.callBack(data);if(callBack)callBack()}}})},unfollowApi:function(data){var serviceBase="https://follow.washingtonpost.com";var tags=[{slug:data.categorySlug,title:data.categoryTitle,level:1,type:"category"}];var jsonData={washPostId:userId,wapoLoginID:userId,
wapoSecureID:userSecureId,userAgent:userAgent,tags:tags};if(data.signedIn)serviceBase+="/Follow/api/unfollow";else{serviceBase+="/Follow/api/anonymous-unfollow";jsonData.emailId=localStorage.getItem("wp_follow_modal_email")}$.ajax({type:"POST",url:serviceBase,contentType:"application/json",dataType:"json",data:JSON.stringify(jsonData),success:function(responce){if(responce.status==true&&data.callBack)data.callBack(responce)}})},localStorageAvailable:function(){var test="test";try{localStorage.setItem(test,
test);localStorage.removeItem(test);return true}catch(e){return false}}};var tablet=isMobile.tablet();window.VisitorSegment&&VisitorSegment("tablet",function(){return tablet&&$(window).width()>768});window._essentials_onrender=function(Essentials){var $target=$("#essentials-topper");var name=Essentials.name;var data=Essentials.data;var pdata=Essentials.getPersistentData();var status=pdata[Essentials.contentPath];var count=!!name&&!!data?data.results.length:undefined;var tcount;if(!!Essentials.name&&
$(".cf-essentials-module").length!=0){$target.show();$(function(){if(count){switch(count){case 1:tcount="One";break;case 2:tcount="Two";break;case 3:tcount="Three";break;case 4:tcount="Four";break;case 5:tcount="Five";break;default:tcount="";break}$(('\x3ch2\x3e\x3cspan class\x3d"status vg-check status-icon status-%s"\x3e\x3c/span\x3e '+'\x3cspan class\x3d"status-count"\x3e'+tcount+" Essentials\x3c/span\x3e "+'\x3cspan class\x3d"status-kicker"\x3e%k\x3c/span\x3e'+"\x3c/h2\x3e").replace("%s","undefined"==
typeof status?"scroll":"read").replace("%k",data.kicker.text)).appendTo($target);$target.on("click.essentials-topper",function(e){wp_pb.report("essentials-topper","click",{$target:$target});wp_pb.report("essentials","scrollto",{$from:$target})})}})}}})(jQuery);
(function($){var textResizer={currIncrementMax:9,currIncrementUnit:2,currIncrementIndex:0,init:function(myRoot,resizeableElementList,clickElement){myRoot=myRoot||"#article-body article, .related-story, .liveblog-intro, #liveblog-story-list .description, #full-recipe .article-content";resizeableElementList=resizeableElementList||"p, li";clickElement=clickElement||".tool.textresizer";this.root=$(myRoot);this.resizeableElements=$(resizeableElementList,this.root);if($(".related-story").prev("h3").length>
0){this.resizeableElements.push($(".related-story").prev("h3"));this.resizeableElements.push($(".related-story h4 a"))}$(clickElement).on("click",this,this.resize)},resize:function(event){var currObj=event.data;if(currObj.currIncrementIndex==currObj.currIncrementMax){currObj.currIncrementIndex=0;currObj.currIncrementUnit=currObj.currIncrementUnit==2?-2:2}currObj.currIncrementIndex=currObj.currIncrementIndex+1;currObj.resizeableElements.each(function(){elm=$(this);currSize=parseFloat(elm.css("font-size"),
5);var result=currSize+currObj.currIncrementUnit;elm.css("font-size",result);wp_pb.report("textresizer","resized",result)})}};var trackTraffic=function(name){if(typeof window.sendDataToOmniture==="function"){var omnitureVars={"eVar1":typeof window.s=="object"&&s&&s.eVar1,"eVar2":typeof window.s=="object"&&s&&s.eVar2,"eVar8":typeof window.s=="object"&&s&&s.eVar8,"eVar17":typeof window.s=="object"&&s&&s.eVar17,"eVar27":name};try{sendDataToOmniture(name+".click","event6",omnitureVars)}catch(e){}}};$(".tool.textresizer, .tool.print").bind("click",
function(){var name=$(this).attr("class").split(" ")[0].trim();trackTraffic(name)});window.TWP=TWP||{};TWP.TextResizer=TWP.TextResizer||textResizer;TWP.TextResizer.init()})(jQuery);
(function($){var $article=$("#article-body"),$d=$(document),$w=$(window),$b=$("body");window.cr_on=false;$("iframe[data-src]",$article).each(function(i){var $this=$(this);$this.attr("src",$this.attr("data-src"))});$("#about-the-authors").click(function(e){var $this=$(this);var $container=$this.closest(".multi-author-bio");if(!!$container){if($container.hasClass("open"))$container.removeClass("open").addClass("closed");else $container.removeClass("closed").addClass("open");wp_pb.report("global","domChanged")}});
var $tables=$("div.extra table",$article);$tables.each(function(){var $table=$(this),$bars=$(".barchart",$table),longestBar=0;$bars.each(function(i){var $bar=$(this),w=$bar.attr("width");if(!isNaN(w)){w=w*1;longestBar=w>longestBar?w:longestBar}});$bars.each(function(i){var $bar=$(this),w=$bar.attr("width");if(!isNaN(w)){w=w*1;var scale=$article.width()>480?.85:.75;relativeWidth=scale*(Math.ceil(100*(w/longestBar)*100)/100);$bar.css("width",relativeWidth+"%")}})});var hasResizableIframe=false;$("iframe[width][height]",
$article).each(function(i){var $iframe=$(this),w=$iframe.attr("width"),h=$iframe.attr("height");if(!isNaN(w)&&!isNaN(h)){$iframe.attr("data-aspect-ratio",w/h);if($iframe.attr("width")!=$article.width()){var hFudgeFactor=$iframe.attr("src").match(/instagram.com/)?40:0;$iframe.attr("width",Math.round($article.width()));$iframe.attr("height",Math.round($article.width()/$iframe.attr("data-aspect-ratio"))+hFudgeFactor)}if(!hasResizableIframe){hasResizableIframe=true;$w.resize(function(ev){$("iframe[data-aspect-ratio]",
$article).each(function(i){var $ifr=$(this);hFF=$ifr.attr("src").match(/instagram.com/)?40:0;$ifr.attr("width",Math.round($article.width()));$ifr.attr("height",Math.round($article.width()/$ifr.attr("data-aspect-ratio"))+hFF)})})}}});$(window.document).on("abtest-ready",function(e,ABT){var test=ABT.get("posttv_embeds-blurb");var inlineVideo=$article.find(".inline-video");var inlineVideoCaption=inlineVideo.find(".inline-video-caption");if(test.is("hidden")){inlineVideoCaption.addClass("no-blurb");inlineVideo.find(".pb-caption").each(function(){var $caption=
$(this);var captionText=$caption.text();if(captionText.match(/(\(.*\))\s?$/))$caption.text(RegExp.$1);else $caption.text("")})}inlineVideoCaption.show()})})(jQuery);
(function($){var defaultNewsLetter={frequency:"Daily",headline:"Get the Today's Headlines Newsletter",id:"post_newsletter1",name:"Today's Headlines",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-heads",variable:"vars[intent_heads]"},defaultNewsLetters=[{frequency:"Daily",headline:"Get the Today's Headlines Newsletter",id:"post_newsletter1",name:"Today's Headlines",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-heads",variable:"vars[intent_heads]"},
{frequency:"Daily",headline:"Get the Read In Newsletter",id:"post_newsletter112",name:"Read In",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-readin",variable:"vars[intent_readin]"},{frequency:"Weekly",headline:"Get the Lean \x26 Fit Newsletter",id:"post_newsletter8",name:"Lean \x26 Fit",tagline:"Free weekly updates delivered just for you.",template:"signup-confirm-lean",variable:"vars[intent_lean]"},{frequency:"Twice-weekly",headline:"Get the Checkpoint Newsletter",
id:"post_newsletter130",name:"Checkpoint",tagline:"Free twice-weekly updates delivered just for you.",template:"signup-confirm-check",variable:"vars[intent_check]"}],washPostId,subscribeEmail,showInStreamNewsletter=function(){$("#signup-box-instream").show()},hideInStreamNewsletter=function(){$("#signup-box-instream").hide()},showInStreamSignUpForm=function(){$("#subscribe-form-inStream").show();$("#loggedInBtn").hide()},showInStreamSignUpButton=function(){$("#subscribe-form-inStream").hide();$("#loggedInBtn").show()},
showErrorMsgInStream=function(message){if(message)$(".error-msg-inStream").text(message).show()},hideErrorMsgInStream=function(){$(".error-msg-inStream").hide()},setInStreamNewsLetter=function(data){$("#headline-instream").append(data.headline);$("#tagline-instream").text(data.blurb)},setInStreamRecommendations=function(data){$("#suggestions-inStream .recommended").each(function(index){$(this).find("p").text(data[index].headline);$(this).find("input[type\x3d'checkbox']").attr("value",data[index].id);
$(this).find("input[type\x3d'checkbox']").attr("name",data[index].name)})},toggleInStreamRecommendations=function(show){if(show){$("#subscribe-form-inStream, #loggedInBtn, #tagline-instream").hide();$("#suggestions-inStream, .checked-icon, #confirmation-instream, #all-newsletters-inStream").show()}else $("#suggestions-inStream, .might-like").hide()},showConfirmationInStream=function(){$("#subscribe-form-inStream, #loggedInBtn, #tagline-instream").hide();$(".checked-icon, #confirmation-instream, #all-newsletters-inStream").show()},
getUserId=function(){return document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:""},getWapoId=function(){return document.cookie.match(/wapo_secure_login_id=([^;]+)/)?RegExp.$1:""},getPageData=function(){var section=$("#section-instream").text(),subSection=$("#subsection-instream").text(),blog=$("#blogname-instream").text(),data={};washPostId=getUserId();if(washPostId!=="")data.washPostId=washPostId;if(blog)data.blog=blog;if(subSection)data.subSection=subSection;if(section)data.section=section;
return data},getInStreamNewsletter=function(){var data=getPageData();return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"https://recommendation-newsletter.wpdigital.net/Newsletter/api/newsletter",data:JSON.stringify(data)})},getInStreamRecommendations=function(newsletters){var data=getPageData();data.newsletters=newsletters;return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"https://recommendation-newsletter.wpdigital.net/Newsletter/api/newsletters",
data:JSON.stringify(data)})},subscribeInStream=function(email){var data,url;if(washPostId!==""){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe";data={"wapoLoginID":washPostId,"wapoSecureID":getWapoId(),"userAgent":navigator.userAgent,"newsletterName":window.Newsletter.id,"metadata":[{"name":"nl_start_method","value":"EI"},{"name":"nl_start_location","value":"IS"}]}}else if(email){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-email";data={"email":email,
"newsletterName":window.Newsletter.id,"metadata":[{"name":"nl_start_method","value":"EI"},{"name":"nl_start_location","value":"IS"}]}}if($("#signup-box-instream").hasClass("bottomArticle"))data.metadata=[{"name":"nl_start_method","value":"EI"},{"name":"nl_start_location","value":"ISB"}];$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data),success:function(data){if(data.status=="SUCCESS"){sendCustomTrackProps("event60,event91",trackProps(window.Newsletter.name,
1,"simple"),"Newsletter In Stream Sign-up");setUpInStreamRecommendations([window.Newsletter.id])}else showErrorMsgInStream("Error while subscribing, please try later.")},error:function(request,status,error){showErrorMsgInStream("Error while subscribing, please try later.")}})},subscribeBundleInStream=function(){var data,url,newsletters=[],newsletterNames=[];$("#suggestions-inStream input:checked").each(function(index){newsletters.push($(this).val());newsletterNames.push({name:$(this).attr("name"),
position:$(this).attr("data-pos")})});if(newsletters.length>0&&newsletterNames.length>0){if(washPostId!==""){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-list";data={"wapoLoginID":washPostId,"wapoSecureID":getWapoId(),"userAgent":navigator.userAgent,"newsletters":newsletters,"metadata":[{"name":"nl_start_method","value":"EA"},{"name":"nl_start_location","value":"IS"}]}}else if(subscribeEmail){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-list-email";
data={"email":subscribeEmail,"newsletters":newsletters,"metadata":[{"name":"nl_start_method","value":"EA"},{"name":"nl_start_location","value":"IS"}]}}if($("#signup-box-instream").hasClass("bottomArticle"))data.metadata=[{"name":"nl_start_method","value":"EA"},{"name":"nl_start_location","value":"ISB"}];$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data),success:function(data){if(data.status=="SUCCESS"){for(var i=0;i<newsletterNames.length;i++)sendCustomTrackProps("event60,event91",
trackProps(newsletterNames[i].name,newsletterNames[i].position,"enhanced"),"Newsletter Right Rail Sign-up Bundle");setUpInStreamRecommendations(newsletters,true);toggleInStreamRecommendations(false)}else showErrorMsgInStream("Error while subscribing, please try later.")},error:function(request,status,error){showErrorMsgInStream("Error while subscribing, please try later.")}})}},setUpInStreamRecommendations=function(newsletterId,confirmBundleSubscribe){var recommendations=getInStreamRecommendations([window.Newsletter.id]);
recommendations.done(function(data){if(!$.isEmptyObject(data.newsletters)&&data.newsletters.length>=3&&!confirmBundleSubscribe){window.Newsletters=data.newsletters;setInStreamRecommendations(data.newsletters);toggleInStreamRecommendations(true);for(var i=0;i<data.newsletters.length-1;i++)sendCustomTrackProps("event59",trackProps(data.newsletters[i+1].name,i+1,"enhanced"),"Newsletter Right Rail Show Recommendations")}else toggleInStreamRecommendations(false);showConfirmationInStream()});recommendations.fail(function(){if(!confirmBundleSubscribe){window.Newsletters=
defaultNewsLetters;setInStreamRecommendations(defaultNewsLetters);toggleInStreamRecommendations(true)}})},setUpInStreamNewsletter=function(newsletter){window.Newsletter=newsletter;setInStreamNewsLetter(newsletter);showInStreamNewsletter();if(getUserId()!=="")showInStreamSignUpButton();else showInStreamSignUpForm()},applyInStream=function(variant,version){var mainNewsletter=getInStreamNewsletter();mainNewsletter.done(function(data){if(!$.isEmptyObject(data.newsletter)){setUpInStreamNewsletter(data.newsletter);
setTimeout(function(){sendCustomTrackProps("event59",trackProps(window.Newsletter.name,1,"simple"),"Newsletter In Stream successfull API Call")},5E3)}else hideInStreamNewsletter()});mainNewsletter.fail(function(){setUpInStreamNewsletter(defaultNewsLetter);sendCustomTrackProps("event50",trackProps(window.Newsletter.name,1),"Newsletter In Stream API failure case")});$(".subscribe-btn-inStream").click(function(){subscribeEmail=$("#email-inStream").val(),re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/igm;
if(subscribeEmail==""||!re.test(subscribeEmail))showErrorMsgInStream("Please enter a valid email address");else{hideErrorMsgInStream();subscribeInStream(subscribeEmail)}return false});$("#loggedInBtn").click(function(){subscribeInStream()});$("#subscribe-bundle-inStream").click(function(){subscribeBundleInStream()});$("#cancel-bundle-inStream").click(function(){sendCustomTrackProps("event58",trackProps(),"No Thanks, Newsletter Right Rail Sign-up Bundle ");toggleInStreamRecommendations(false)})};$(window.document).on("abtest-ready",
function(e,ABT){if(window.TWP.Data.Tracking.props.content_type=="front")applyInStream();else if(window.TWP.Data.Tracking.props.content_type=="blog"||window.TWP.Data.Tracking.props.content_type=="article"){var testArticle=ABT.get("newsletters-articleUnits");if(testArticle.is("bottom"))applyInStream(testArticle)}});var forceShow=$("#signup-box-instream").data("force");if(!!forceShow)applyInStream("instream");function trackProps(newsletterName,index,enhancedKey){var subsection=window.wp_subsection||
"";var contentType=window.wp_content_type||"";var props={"eVar2":subsection,"prop2":subsection,"prop3":contentType,"eVar17":contentType};if(newsletterName&&index)props.eVar26="nl_instream_"+enhancedKey+"_"+newsletterName.toLowerCase().split(" ").join("-")+"_"+index;return props}function sendCustomTrackProps(eventKey,props,name){if(!!window.s)window.s.sendDataToOmniture(name||"PB Feature - Page-Newsletter",eventKey,props,{wait:true})}})(jQuery);
(function($){var $socialToolsBottom=$(".social-tools-bottom"),$individualTools=$socialToolsBottom.children(),config={"omnitureEvent":"event6"};$(".social-tools-wrapper-bottom").each(function(index,myRootElement){if(wp_pb.StaticMethods.staticPostShare)wp_pb.StaticMethods.staticPostShare.init($(myRootElement),$(myRootElement).data("postshare"))});$individualTools.on("click",function(e){if(typeof window.sendDataToOmniture==="function"){var shareType=$(this).data("sharetype"),eventName=config.omnitureEvent,
omnitureVars={"eVar1":typeof window.s=="object"&&s&&s.eVar1,"eVar2":typeof window.s=="object"&&s&&s.eVar2,"eVar8":typeof window.s=="object"&&s&&s.eVar8,"eVar17":typeof window.s=="object"&&s&&s.eVar17,"eVar27":""};omnitureVars.eVar27=shareType+"_bottom";try{sendDataToOmniture("share."+shareType,eventName,omnitureVars)}catch(e){console.log(e)}}})})(jQuery);
$(function() {
    wp_pb = window.wp_pb || {};
    wp_pb.CommentLoader = wp_pb.CommentLoader || function(){
        var width = (window.innerWidth > 0) ? window.innerWidth : screen.width,
            isMobile = ((wp_pb && wp_pb.BrowserInfo && wp_pb.BrowserInfo.mobile_browser === 1) && width < 480 ) ? true : false,
            loadDeferred = ($('.echo_container.defer').length > 0) ? true : false,
    		triggerLoad = ($('.echo_container.triggerLoad').length > 0) ? true : false,
            loadDeferredMobile = ($('.echo_container.deferMobile').length > 0) ? true : false,
            noMobile = ($('.echo_container.no-mobile').length > 0 && isMobile) ? true : false,
            $window = $(window),
            $echoPlaceholder = $('.echo_container_placeholder'),
            loadThreshhold = .70,
            env = wp_pb.environment || "production",
            apiBaseURL = (env == 'production')?'https://comments-api.ext.nile.works':'https://comments-api-staging.ext.nile.works',
            forceShowComments = $(document).getUrlParam("sc"), //get any relevant QS parameters
            commentOverlay = {
                    overlayElements: {
                        overlay: '#comment_overlay',
                        articleWrapper: '.article-wrapper',
                        articleTopper: '.article-topper',
                        articleParent: '.story-stream',
                    },
                    onClose: function(data) {
                        data.overlay = data.overlay || $(commentOverlay.overlayElements.overlay);
                        data.overlay.addClass('overlay-closed');

                        /*** STORYLINE COMMENTS CODE; DEPRECATED ***/
                        /*  $(window.document).off('scroll.TWP.Comments');
                            if (!data.action || data.action != 'story_closed') {
                                $('#story-stream-tools').css('display','block');
                            }
                        */
                    },
                    onOpen: function(data) {
                        //hack to make the comments overlay work with the site menu open. LP will revisit.
                        if($('body').is('.left-menu')) {
                            $('#site-menu-btn').click();
                            setTimeout(function() {
                                data.overlay.addClass('overlay-fixed').removeClass('overlay-absolute');
                                data.overlayWrapper.removeClass('overlay-closed');
                            }, 600);
                        } else {
                            data.overlay.addClass('overlay-fixed').removeClass('overlay-absolute');
                            data.overlayWrapper.removeClass('overlay-closed');
                        }

                    },
                    onScroll: function(event){

                    },
                    closeSelector: "a.close"};


        var loadComments = function() {
            if (!noMobile) {
                if (typeof wp_e2 == 'undefined' || typeof wp_e2.initStatus == 'undefined') {
                    //echo code below.  Comment out for in-house
                    //var domain = (env == "production") ? "js.washingtonpost.com" : "qaprev.digitalink.com";
                    //TWPHead && TWPHead.load("//" + domain + "/1d/hjs/twp-comments.js" + "?token=b20140708165000");
                    //end echo code
                    //in-house code below.  Comment out for Echo production
                    var domain = (env == "production") ? "//js.washingtonpost.com/pb" : "/pb";
                    var outputtype = (env == "production") ? "&outputType=javascript" : "&outputType=javascript";
                    var resourceToken = wp_pb.resourceToken || '201504300950';
                    TWPHead && TWPHead.load( domain + "/1d/hjs/twp-comments.js" + "?token=" + resourceToken + outputtype);
                    //end in-house code
                }
            }
        };


        var showComments = function(data) {

            loadComments();
            $window.off('scroll.showComments');

            var $overlay = $(commentOverlay.overlayElements.overlay);  //check for overlay element

            if ($overlay.length == 0) {  //standard functionality
                $('.comment-summary.summary-expanded, .comment-summary.summary-expanded-mobile, .comment-summary.summary-expanded-desktop')
                    .slideUp('fast', function() {
                        $('.echo_container.comments-collapsed').removeClass('comments-collapsed')
                            .addClass('comments-expanded')
                            .slideDown('fast', function() {
                                wp_pb.report('global', 'domChanged');
                            });
                        $(this).addClass('summary-collapsed').removeClass('summary-expanded summary-expanded-mobile summary-expanded-desktop');
                        if (typeof window.sendDataToOmniture === 'function') {
                            try {
                                sendDataToOmniture('echo.gotoComments', 'event5', {
                                    "eVar26": "go to comments"
                                });
                            } catch (err) {}
                        }
                    });
                $echoPlaceholder.parent()[0].scrollIntoView();

            } else {
                //comments displayed in side/overlay
                //comments moved to appropriate place in DOM, positioned, and refreshed.

                if (typeof data == 'undefined') {
                    //do nothing
                    return;
                }

                $overlayWrapper = data.elm.parents(commentOverlay.overlayElements.articleWrapper);

                if(!$overlay.is('.overlay-closed')) {
                    //if the comments are open, close them
                    wp_pb.report('comments', 'commentsMultiClosed', {'overlay': $overlay, 'overlayWrapper': $overlayWrapper})
                } else {
                    //otherwise, open the comments
                    $overlay.find(commentOverlay.closeSelector).on('click',function(event){
                        event.stopPropagation();
                        wp_pb.report('comments','commentsMultiClosed', {'overlay':$overlay,'overlayWrapper':$overlayWrapper})
                    });

                    //move to appropriate place in DOM
                    $overlayWrapper.after($overlay);
                    var top = (data && data.location && data.location.offset().top) || $(document).scrollTop();

                    //refresh
                    if (typeof data.guid !== 'undefined') {
                        var allow_comments = ($overlayWrapper.find('.pb-comment-wrapper').attr('data-allow-comments')==='true')?true:false;
                        wp_e2.refreshComments({"id":"#" + $overlay.find('.echo_container.comments').attr('id'), "url":data.guid, "allow_comments":allow_comments});
                    }

                    wp_pb.report('comments', 'commentsMultiOpened',{'parent':$overlayWrapper.parent($(commentOverlay.overlayElements.articleParent)),'overlay':$overlay,'overlayWrapper':$overlayWrapper});
                }
            }

        };

        var loadCommentCount = function (elms){
            //echo code.  comment out for in-house
            //var apiBaseURL = '//api.echoenabled.com';//production (Echo)
            //end echo

            var echoCountApi =  apiBaseURL + '/v2/mux' +
                                '?appkey='  + ((TWP.Data.echo_appkey != 'undefined')?TWP.Data.echo_appkey:'prod.washpost.com') +
                                '&requests=';
            var query = "(childrenof:'{guid}'" +
             encodeURI("source:washpost.com (((state:Untouched AND user.state:ModeratorApproved) OR (state:CommunityFlagged,ModeratorApproved,ModeratorDeleted AND -user.state:ModeratorBanned,ModeratorDeleted) )))"
                + ' children: 2 (((state:Untouched AND user.state:ModeratorApproved) OR (state:CommunityFlagged,ModeratorApproved AND -user.state:ModeratorBanned,ModeratorDeleted) ) )');

            /*
    [{  "id":"count1",
        "method":"count",
        "q":"((childrenof: //www.washingtonpost.com/world/middle_east/palestinians-form-new-unity-government-including-hamas/2014/06/02/c681d5c6-ea46-11e3-9f5c-9075d5508f0a_story.html source:washpost.com (((state:Untouched user.state:ModeratorApproved) OR (state:CommunityFlagged,ModeratorApproved,ModeratorDeleted -user.state:ModeratorBanned,ModeratorDeleted) OR (-state:SystemFlagged,ModeratorFlagged user.id:'http://washingtonpost.com/vr5H9gYg8K7QKi4eY3QuCsBEPSO0NNloQjBe0ZqhSs1oGeVxxhJF5A==/')) AND ( -markers:ignore ) ) )) itemsPerPage: 15 sortOrder:reverseChronological safeHTML:aggressive children: 2 childrenSortOrder:chronological childrenItemsPerPage:3 (((state:Untouched user.state:ModeratorApproved) OR (state:CommunityFlagged,ModeratorApproved -user.state:ModeratorBanned,ModeratorDeleted) OR (-state:SystemFlagged,ModeratorFlagged user.id:'http://washingtonpost.com/vr5H9gYg8K7QKi4eY3QuCsBEPSO0NNloQjBe0ZqhSs1oGeVxxhJF5A==/')) AND ( -markers:ignore ) )"}]
            */
            var muxArray = new Array();

            var dataUrl;

            $(elms).each(function(index,el) {
                var thisData =  $(el).attr('guid') || $(el).attr('data');
                if (typeof thisData != 'undefined') {
                    query = query.replace("{guid}",thisData);
                    muxArray.push( {"id":thisData,"method":"count","q":query});
                 }
            });
            jQuery.ajax({
                url: echoCountApi + JSON.stringify(muxArray),
                dataType: 'jsonp',
                cache: true})
                .done(function(data,status ){
                    if (status != "error") {
                        $.each(data,function(index,el){
                            var count = (el.result != "error")?el.count:((el.errorCode && el.errorCode == "more_than")?'5000+':'');
                            $(".echo-counter[guid='"+index +"']").html(count);
                        })
                    }
                });

        };

        var resetFixed = function(data) {
            var $shareBarHeight = $('.sticky-top-sharebar'), $streamHeader = $('.echo-apps-conversations-streamHeader');
            if (data == 'opened' && $('.bar-hidden').length === 0 ) {
                $streamHeader.addClass('nav-open');
            } else {
                $streamHeader.removeClass('nav-open');
            }
        };

        var init = function() {
            //register callbacks
            wp_pb.register('comments', 'showComments', showComments, this);

            wp_pb.register('comments', 'commentsReady', function() {
                if (forceShowComments === '1') {
                    showComments();
                }
            });

            wp_pb.register('nav', 'finish_open', function() {
                resetFixed('opened');
            });

            wp_pb.register('nav', 'finish_close', function(){
                resetFixed('closed');
            });

            wp_pb.register('nav', 'menu_start_open', function(){
                var $overlay = $(commentOverlay.overlayElements.overlay);  //check for overlay element
                if ($overlay.length > 0) {  //standard functionality
                    $overlay.parent().hide();
                }
            });

            wp_pb.register('nav', 'menu_finish_close', function(){
                var $overlay = $(commentOverlay.overlayElements.overlay);  //check for overlay element
                if ($overlay.length > 0) {  //standard functionality
                    $overlay.parent().show();
                }
            });


            wp_pb.register('comments', 'commentsMultiOpened',commentOverlay.onOpen);
            wp_pb.register('comments', 'commentsMultiClosed',commentOverlay.onClose);

            //add events
            $('.comment-summary').click(function() {
                //showComments();
                //populating the data object so that the overlay comments panel has enough info to open
                var data = {
                    elm: $(this),
                    guid: $(this).find('.echo_container').attr('guid')
                };
                wp_pb.report('comments', 'showComments', data);
            });


            if (noMobile) {
                $('.pb-f-page-comments').hide();
            }

            if (isMobile) {
                $('.comment-summary.jump').hide();
            }


            //load comments as appropriate
            if (isMobile && loadDeferredMobile || !isMobile && triggerLoad ) {
                //only load count on standard count element.  Comments loaded on click of comment-summary
                loadCommentCount('.echo-counter');
            } else if (!isMobile && loadDeferred) {
                //load comment count on standard count element first
                loadCommentCount('.echo-counter');
                //set up scroll events.  Comments will load on scroll or click of comment count, comment-summary
                $window.on('scroll.showComments', function() {
                    if ($window.scrollTop() / $echoPlaceholder.offset().top >= loadThreshhold) {
                        //showComments();
                        loadComments();
                    }
                    if ($window.scrollTop() >= $echoPlaceholder.offset().top ) {
                        showComments();
                    }
                });
            } else {
                loadComments();
            }
            
            if (triggerLoad) {
				var triggerLoadLogger = new TWP.Tools.logger("LOAD-BLOCKER-COMMENTS");
				
				// ensure fields are set
				TWP.loadImmediatelyBlockers = TWP.loadImmediatelyBlockers || {};
				TWP.loadImmediatelyBlockers.comments = TWP.loadImmediatelyBlockers.comments || [];
				
				// check if fields are empty
				var checkCommentsBlockers = function() {
					triggerLoadLogger.log("checkCommentsBlockers: " + TWP && TWP.loadImmediatelyBlockers && TWP.loadImmediatelyBlockers.comments && TWP.loadImmediatelyBlockers.comments.length != 0);
					return TWP && TWP.loadImmediatelyBlockers && TWP.loadImmediatelyBlockers.comments && TWP.loadImmediatelyBlockers.comments.length != 0;
				}
				
				// load display ads required code
				var loadCommentsLoader = function(forceAdd) {
					if ( (!checkCommentsBlockers() || !!forceAdd) && !!!TWP.loadImmediatelyBlockers.loadedComments) {
						triggerLoadLogger.log("loadCommentsLoader");
						try {
							loadComments();
//							TODO: only works for Gallery pages !
							TWP.loadImmediatelyBlockers.loadedComments = true;
						} catch (err) {}
					}
				}
				
				// add event handling from TWP.loadImmediatelyBlockers
				if (checkCommentsBlockers()) {
					$.each(TWP.loadImmediatelyBlockers.comments, function(i, val){
						$(window.document).on(val, function(){
							triggerLoadLogger.log("comments inEvent: "+val);
							loadCommentsLoader();
						});
						setTimeout(function(){
							triggerLoadLogger.log("comments inTimeout");
							$(window.document).off(val);
							loadCommentsLoader(true);
						}, 5000);
					});
				} else {
					triggerLoadLogger.log("comments inElse");
					loadCommentsLoader(true);
				}
			}
        }
        return{init:init,showComments:showComments,loadCommentCount:loadCommentCount};
    } ();
    wp_pb.CommentLoader.init();
});
(function(){jQuery.support.cors=true;function myAjax(url,params,success,failure){$.ajax(url,params).done(success).fail(function(jqXHR,textStatus,error){params.dataType="jsonp";if(error.toString().match(/Access is denied/))$.ajax(url,params).done(success).fail(failure);else if(failure)failure(jqXHR,textStatus,error)})}var version=21;var $=jQuery;var T=TWP.Perso.Tools;var $body=$("body");var $window=$(window);var $document=$(document);var $sponsored=null;var $container=null;var $pbcontainer=null;var isHomepage=
false;var $homepageElem=null;var $homepageCards=null;var log=new TWP.Tools.logger("HYBRID");var errorUrl="https://recommendation-hybrid.wpdigital.net/hybrid/hybrid-filter/error.json";var serviceUrl="https://recommendation-hybrid.wpdigital.net/hybrid/hybrid-filter/hybrid.json";var trackingUrl="https://recommendation-hybrid.wpdigital.net/hybrid/hybrid-filter/tracker.json";var renderedUrl="https://recommendation-hybrid.wpdigital.net/hybrid/hybrid-filter/rendered.json";var visiblityUrl="https://recommendation-hybrid.wpdigital.net/hybrid/hybrid-filter/visible.json";
var darwin=null;var experience={abtest:"none",abvariant:"default"};var videoUser=null;var videoUUIDs=[];var output="";var validOnes=[];var status=null;var visible=false;var requestResult=null;var trackRenderedAllCalled=false;$document.on("abtest-ready",function(ev,ABT){log.debug("Darwin : Ready");if(!status)darwin=ABT});function isVideoUser(){if(videoUser==null){var videoUser=false;var videos=T.store.getJSONItem("twpVideoHistory");if(videos)for(var uuid in videos)if(videos.hasOwnProperty(uuid)){videoUUIDs.push(uuid);
var timestamp=videos[uuid].timestamp;if(timestamp>Date.now()-3600*1E3)videoUser=true}if(T.store.getJSONItem("usersegments","segmentsFlag.9013442807"))videoUser=true}return videoUser}function chooseExperience(){var variation;log.debug("Choosing experience");if(/force-uk=1/.test(document.location.toString())){experience.abtest="uk";experience.abvariant="uk";return}if(/force-video=1/.test(document.location.toString())){experience.abtest="video";experience.abvariant="video";return}if(darwin)if(T.store.getJSONItem("usersegments",
"segmentsFlag.3605630552")){variation=darwin.get("recommendation-uk");experience.abtest="uk";if(variation.is("uk"))experience.abvariant="uk"}else{if(isVideoUser()){experience.abtest="video";experience.abvariant="video"}}else experience.abvariant="nodarwin"}function isValid(recommendation){return recommendation&&recommendation.url&&recommendation.responsetype&&recommendation.headline&&recommendation.summary&&recommendation.photo&&recommendation.photo.path}function render(recommendations){if(!recommendations||
recommendations.length==0)return _failure("No recommendations");for(var i=0;i<recommendations.length;i++)if(isValid(recommendations[i]))validOnes.push(recommendations[i]);if(validOnes.length==0)return _failure("No valid recommendations");if(visible)trackRenderedAll();log.debug("Render",function(){if(isHomepage)_renderHomepage(validOnes);else _renderArticle(validOnes)});trackLoadedSuccess()}function _renderHomepage(recommendations){var card=null;$homepageElem.find(".label").text("Post Recommends");
var img=renderImgURL(recommendations[0],480,320);$homepageElem.find("img").attr("src",img).attr("data-hi-res-src",img).attr("data-low-res-src",img);$homepageElem.find("section-story-photo-1 a").attr("href",renderURL(recommendations[0])).attr("title",recommendations[0].headline);for(var i=0;i<recommendations.length;i++){card=$($homepageCards[i]);if(card){card.find("a").html(recommendations[i].headline).attr("href",renderURL(recommendations[i])).attr("title",recommendations[i].headline);card.find(".blurb").html(recommendations[i].summary)}}}
function _renderArticle(recommendations){var idx=0;var reco=null;var html="";var classes="";for(var i=0;i<recommendations.length;i++){log.debug("Render item ("+i+")");html=html+renderItem(recommendations[i],idx,recommendations.length);idx=idx+1}html='\x3cdiv class\x3d"postrecommends contentfeed'+classes+'"\x3e'+'\x3cdiv class\x3d"content-strip"\x3e'+'\x3cdiv class\x3d"label-wrapper"\x3e'+'\x3cspan class\x3d"label label-kicker"\x3eThe Post Recommends\x3c/span\x3e'+"\x3c/div\x3e"+'\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e'+
html+'\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e'+"\x3c/div\x3e"+"\x3c/div\x3e";if(html!=output){output=html;$sponsored=$("#slug_postrecommends");$sponsored.remove();$container.html(output);$container.find(".content-strip \x3e .label-wrapper").before($sponsored);$pbcontainer.show();$pbcontainer.after('\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e');status="rendered"}}function renderURL(recommendation){return recommendation.url+"?tid\x3d"+recommendation.responsetype}function renderImgURL(recommendation,w,
h){var url=recommendation.photo.path;return"https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d"+encodeURIComponent(url)+"\x26w\x3d"+w+"\x26h\x3d"+h}function renderClasses(recommendation,index,total){var classes="";if(recommendation.responsetype.match(/video/))classes=classes+"video ";if(index==0)classes=classes+"first ";if(index==total-1)classes=classes+"last";return classes}function renderItem(recommendation,index,total){var node=$($("#postrecommends-article-template").html());node.addClass(renderClasses(recommendation,
index,total));var headline=node.find(".headline a");headline.html(recommendation.headline);headline.attr("href",renderURL(recommendation));var linkImg=node.find(".photo-wrapper a");linkImg.attr("href",renderURL(recommendation));var blurb=node.find(".blurb");blurb.html(recommendation.summary);var img='\x3cimg src\x3d"'+renderImgURL(recommendation,480,320)+'"'+' data-hi-res-src\x3d"'+renderImgURL(recommendation,480,320)+'"'+' data-low-res-src\x3d"'+renderImgURL(recommendation,112,75)+'"'+' data-threshold\x3d"112" class\x3d"courtesy-of-the-resizer"\x3e';
node.find(".photo-wrapper img").replaceWith(img);if(recommendation.responsetype.match(/video/)){var time="";if(recommendation.videoDuration&&recommendation.videoDuration>1E3){var seconds=Math.floor(recommendation.videoDuration/1E3);var minutes=Math.floor(seconds/60);seconds=seconds%60;if(seconds<10)seconds="0"+seconds.toString();time=minutes+":"+seconds}var caption='\x3cdiv class\x3d"standalone-overlay posttv-playlist-text-play-btn"\x3e'+'\x3ca class\x3d"video-play" href\x3d"'+renderURL(recommendation)+
'"\x3e'+'\x3cspan class\x3d"fa fa-play icon-left"\x3e\x3c/span\x3e\x3cspan\x3ePlay Video\x3c/span\x3e'+'\x3cspan class\x3d"duration"\x3e'+time+"\x3c/span\x3e"+"\x3c/a\x3e"+"\x3c/div\x3e";blurb.after(caption)}return node[0].outerHTML}function trackClicks(){$container.on("click","a",null,function(ev){var link=this;log.debug("Click",function(){var href=link.href;var tid=href.replace(/.*\?tid=/,"");log.debug("URL : "+href);trackClicked(href,tid);setTimeout(function(){log.debug("Redirecting");document.location=
href},200)});return false})}function getBasicParams(){var params={version:version};params["url"]=document.location.toString().replace(/\?.*/,"");params["s_vi"]=T.SVI.get();params["user2281234048"]=T.store.getJSONItem("usersegments","segmentsFlag.2281234048");params["user2582021445"]=T.store.getJSONItem("usersegments","segmentsFlag.2582021445");params["user3605630552"]=T.store.getJSONItem("usersegments","segmentsFlag.3605630552");params["user9013442807"]=T.store.getJSONItem("usersegments","segmentsFlag.9013442807");
params["abtest"]=experience.abtest;params["abvariant"]=experience.abvariant;return params}function init(){status="initializing";log.debug("Setting up click handlers");trackClicks();chooseExperience();log.debug("Setting parameters");var params=getBasicParams();if(experience.abtest=="video"&&experience.abvariant=="video")params["videoUUID"]=videoUUIDs.join("|");if(isHomepage){params["placement"]="homepage";params["count"]=$homepageCards.length}log.debug("Requesting recommendations");requestResult="launching";
var ajaxSuccess=function(data){requestResult="OK";try{log.debug("Received",function(){render(data["results"])})}catch(e){return _failure(e)}};var ajaxFailure=function(jqXHR,textStatus,error){try{requestResult=textStatus+" ("+jqXHR.status+")"}catch(e){requestResult=textStatus}return _failure("Failed request : "+requestResult)};myAjax(serviceUrl,{data:params,dataType:"json",type:"POST"},ajaxSuccess,ajaxFailure);status="requested";requestResult="launched";trackRequested()}function trackLoadedSuccess(){}
function trackLoadedFailure(){}function trackRequested(){}function trackVisible(){if(status)myAjax(visiblityUrl,{data:{visible:status},dataType:"json",type:"POST"});if(status=="rendered")trackRenderedAll();try{var pbPos=Math.floor($pbcontainer.offset().top);var scroll=Math.floor($body.scrollTop());var height=window.innerHeight;if(status!="rendered"){log.debug("Position : "+pbPos+"/"+scroll+"/"+height);trackError("Visible but not yet rendered : "+requestResult)}}catch(e){trackError(e)}}function trackClicked(url,
tid){T.Omniture.send("post_recommends","",{prop69:tid},log);var params=getBasicParams();params["log"]=log.text();params["rectype"]=tid;params["clickurl"]=url.replace(/\?.*/,"").replace(/https?:/,"");log.debug("Calling tracker.json");myAjax(trackingUrl,{data:params,dataType:"json",type:"POST"})}function trackRenderedAll(){if(!trackRenderedAllCalled){trackRenderedAllCalled=true;var data={};data["abtest"]=experience.abtest;data["abvariant"]=experience.abvariant;var param=[];for(var i=0;i<validOnes.length;i++){data["url"+
(i+1)]=validOnes[i].url;data["algo"+(i+1)]=validOnes[i].responsetype;param.push(validOnes[i].responsetype)}T.Omniture.send("post_recommends","",{prop72:param.join(",")},log);myAjax(renderedUrl,{data:data,dataType:"json",type:"POST"})}}function trackError(e){var params={error:e.toString(),log:log.text(),version:version,location:document.location.toString()};if(e.stack)params.stack=e.stack.toString();myAjax(errorUrl,{data:params,dataType:"json",type:"POST"})}function _preload(){try{log.debug("Requesting",
init)}catch(e){trackError(e)}}function _visible(){log.debug("Visible",function(){visible=true;try{trackVisible()}catch(e){trackError(e)}})}function _failure(error){log.debug("Failure",function(){$pbcontainer.hide();trackError(error);trackLoadedFailure();status="failed"})}$(function(){log.debug("DOM Ready",function(){try{log.debug("Finding containers");$container=$("#post-recommends");$pbcontainer=$container.parent();if($("html").hasClass("homepage")){isHomepage=true;$homepageElem=$(".pb-f-homepage-card:last");
$homepageCards=$homepageElem.find("ul.story-list \x3e li");$pbcontainer.remove();$pbcontainer=$homepageElem}log.debug("Setting up scroll listener");T.Events.smartPreload($pbcontainer,{preload:_preload,visible:_visible,screens:2})}catch(e){trackError(e)}})})})();
(function(){$(window.document).on("abtest-ready",function(e,ABT){var test=ABT.get("ads-outbrain");if(test.is("enabled")){var $feature=$(".pb-f-page-outbrain");$feature.show();var $container=$("#outbrain-container");$container.addClass("OUTBRAIN");var obSc=document.createElement("script");obSc.src="//widgets.outbrain.com/outbrain.js";obSc.async="async";obSc.type="text/javascript";$container.append(obSc)}})})(jQuery);
(function($){$(window.document).on("abtest-ready",function(e,ABT){var variation=ABT.get("recommendation-mostread");if(variation.is("chartbeat")){$("ul.def-feed").hide();$("ul.alt-feed").show()}})})(jQuery);
(function($){try{function cleanUp(){jQuery.fn.shuffle=function(){var j;for(var i=0;i<this.length;i++){j=Math.floor(Math.random()*this.length);$(this[i]).before($(this[j]))}return this};$("#the-most-rr li").shuffle();for(var i=0;i<$("#the-most-rr li").length;i++)if($($("#the-most-rr li")[i]).text().indexOf("The Globe and Mail")>-1)$($("#the-most-rr li")[0]).before($($("#the-most-rr li")[i]));var count=0;var adjustLines=function(){var count=0;$("#the-most-rr .line").each(function(){if(count>2)return false;
$(this).parent().parent().parent().parent().show();count++})};adjustLines()}cleanUp()}catch(e){}})(jQuery);
(function($){var marketWatch={rootClass:".pb-f-page-market-watch",init:function(){TWP=window.TWP||{};TWP.MarketMoversModule=function(el){var root=el;var checkIfValidSymbol=function(e){var searchValue=root.find(".companySearch").val();if(wsodcommon.isWhitespace(searchValue)||searchValue=="Enter company name or symbol");else window.location.href="http://washpost.bloomberg.com/marketnews/stockdetail/?symbol\x3d"+searchValue};root.find("a.companySearchBtn").click(checkIfValidSymbol)};wsodModulesCommon_class=
function(){$(".companySearch").keyup($.setContext(this.companySearch,this));$(".companySearch").focus(function(){$(this).val("");$(this).parent().find(".companySearchPopup").empty()});$(".companySearch").blur(function(){if($(this).val()=="")$(this).val($(this).attr("defaultText")||"")})};wsodModulesCommon_class.prototype.ajaxCount=0;wsodModulesCommon_class.prototype.companySearch=function(evt,el){var keyCode="";var elParent=$(el).parent(".search")[0];if(evt)keyCode=evt.keyCode;this.$selected=this.$selected||
$("table",elParent);switch(keyCode){case 13:var $a=this.$selected.find("strong:first");if(!$a.html()||$a.parent(".companySearchPopup").css("display")=="none"){$a=$(".companySearch",elParent);$(el).val($a.val().toUpperCase())}else $(el).val($a.html().toUpperCase());$(el).parents(".pb-module-area").removeClass("onTop");$(".companySearchPopup",elParent).slideUp("fast");$(".companySearchBtn",elParent).click();break;case 27:$(el).parents(".pb-module-area").removeClass("onTop");$(".companySearchPopup",
elParent).slideUp("fast");break;case 40:var $next=this.$selected.next("tr");if(!$next.length)$next=$(".companySearchPopup").find("tr:first");this.$selected.removeClass("highlight");$next.addClass("highlight");this.$selected=$next;break;case 38:var $next=this.$selected.prev("tr");if(!$next.length)$next=$(".companySearchPopup").find("tr:last");this.$selected.removeClass("highlight");$next.addClass("highlight");this.$selected=$next;break;default:var searchValue=$(el).val();var self=this;if(searchValue.length>
0){try{window.stop()}catch(e){try{document.execCommand("Stop")}catch(e){}}wsodcommon.showAjaxLoader($(".companySearchPopup"));this.request=$.ajax({url:wsod_getPath()+"AutoSuggest/SymbolLookupResults",data:{SearchValue:searchValue},success:function(data){var elParent=$(el).parent(".search")[0];wsodcommon.hideAjaxLoader($(".companySearchPopup",elParent));$(el).parents(".pb-module-area").addClass("onTop");$(".companySearchPopup",elParent).html(data).slideDown("slow");wsodcommon.$selected=$(".companySearchPopup",
elParent).find(".searchResultCompany:first");$(".companySearchPopup",elParent).css("left",$(el).position().left);$(".companySearchPopup",elParent).css("top",$(el).position().top+$(el).outerHeight(true)-10);$(".companySearchPopup tr").mouseover(function(){$(this).addClass("highlight");$(this).css("cursor","pointer")});$(".companySearchPopup tr").mouseout(function(){$(this).removeClass("highlight")});$(".companySearchPopup tr").click(function(){wsodcommon.setCompanySymbol(el,$(this).attr("symbol"));
$(".companySearchBtn",elParent).click()})},error:function(){wsodcommon.hideAjaxLoader($(".companySearchPopup",elParent))},dataType:"jsonp"})}else{$(el).parents(".pb-module-area").removeClass("onTop");$(".companySearchPopup",elParent).slideUp("fast")}break}};wsodModulesCommon_class.prototype.setCompanySymbol=function(el,symbol){var elParent=$(el).parent(".search");$(el).val(symbol.toUpperCase());$(el).parents(".pb-module-area").removeClass("onTop");$(".companySearchPopup",elParent).slideUp("fast")};
wsodModulesCommon_class.prototype.showAjaxLoader=function(el){$(el).css("opacity",".25");$(el).css("filter","alpha(opacity\x3d25)");var top=$(el).attr("offsetTop")+$(el).height()/2-40;var left=$(el).attr("offsetLeft")+$(el).width()/2-20;$("#ajax-loader").css("top",top+"px");$("#ajax-loader").css("left",left+"px");$("#ajax-loader").show()};wsodModulesCommon_class.prototype.hideAjaxLoader=function(el){$("#ajax-loader").hide();$(el).css("filter","alpha(opacity\x3d100)");$(el).css("opacity","1.0")};wsodModulesCommon_class.prototype.isEmpty=
function(s){return s==null||s.length==0};wsodModulesCommon_class.prototype.isWhitespace=function(s){var whitespace=" \t\n\r";var i;if(this.isEmpty(s))return true;for(i=0;i<s.length;i++){var c=s.charAt(i);if(whitespace.indexOf(c)==-1)return false}return true};function wsod_getPath(){return"https://washpost.bloomberg.com/"}function wsod_getWatchlistDomain(){return"https://washpost.bloomberg.com/"}function wsod_getWatchlistMarketURL(){return"https://washpost.bloomberg.com/market-news/stockdetail/"}function wsod_getWatchlistBaseURL(){return"https://washpost.bloomberg.com/watchlist/"}
$.setContext=function(){var args=$.makeArray(arguments),fn=args.shift(),context=args.shift();return function(){fn.apply(context,$.makeArray(arguments).concat([this].concat(args)))}};wsodcommon=new wsodModulesCommon_class;$(document.body).click(function(event){var click=$(event.target);if(!click.is(".companySearch")&&!click.is(".companySearchPopup, .companySearchPopup td, .companySearchPopup a")){$(".companySearchPopup").parents(".pb-module-area").removeClass("onTop");$(".companySearchPopup").slideUp("fast")}});
new TWP.MarketMoversModule($(marketWatch.rootClass+" #bb-market-pulse"))},autoUpdate:function(){setInterval(function(){$.get("/pb/api/render/feature/page-market-watch",function(data){$(marketWatch.rootClass).replaceWith(data.html);marketWatch.init()})},12E4)}};marketWatch.init();marketWatch.autoUpdate()})(jQuery);

(function($){var defaultNewsLetter={frequency:"Daily",headline:"Get the Today's Headlines Newsletter",id:"post_newsletter1",name:"Today's Headlines",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-heads",variable:"vars[intent_heads]"},defaultNewsLetters=[{frequency:"Daily",headline:"Get the Today's Headlines Newsletter",id:"post_newsletter1",name:"Today's Headlines",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-heads",variable:"vars[intent_heads]"},
{frequency:"Daily",headline:"Get the Read In Newsletter",id:"post_newsletter112",name:"Read In",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-readin",variable:"vars[intent_readin]"},{frequency:"Weekly",headline:"Get the Lean \x26 Fit Newsletter",id:"post_newsletter8",name:"Lean \x26 Fit",tagline:"Free weekly updates delivered just for you.",template:"signup-confirm-lean",variable:"vars[intent_lean]"},{frequency:"Twice-weekly",headline:"Get the Checkpoint Newsletter",
id:"post_newsletter130",name:"Checkpoint",tagline:"Free twice-weekly updates delivered just for you.",template:"signup-confirm-check",variable:"vars[intent_check]"}],subscribeEmail,washPostId,showNewsletter=function(){$("#signup-box-rr").show()},hideNewsletter=function(){$("#signup-box-rr").hide()},showSignUpForm=function(){$("#newsletter-signUp-form").show();$("#newsletter-signUp-button").hide()},showSignUpButton=function(){$("#newsletter-signUp-form").hide();$("#newsletter-signUp-button").show()},
showErrorMessage=function(message){if(message)$(".newsLetter-error-msg").text(message).show()},hideErrorMessage=function(){$(".newsLetter-error-msg").hide()},setNewsLetterValue=function(data){$("#newsletter-headline").append(data.headline);$("#newsletter-tagline").text(data.blurb)},setRecommendationsValues=function(data){$(".suggestion-list .recommended").each(function(index){$(this).find("p").text(data[index].headline);$(this).find("input[type\x3d'checkbox']").attr("value",data[index].id);$(this).find("input[type\x3d'checkbox']").attr("name",
data[index].name)})},toggleRecommendations=function(show){if(show){$("#newsletter-signUp-form, #newsletter-signUp-button, #newsletter-tagline").hide();$("#newsletter-suggestions-rr, #headline-checked, #subscribed-confirmation, #all-newsletters-lbl").show()}else $("#newsletter-suggestions-rr").hide()},showSignUpConfirmation=function(){$("#newsletter-signUp-form, #newsletter-signUp-button, #newsletter-tagline").hide();$("#headline-checked, #subscribed-confirmation, #all-newsletters-lbl").show()},getUserId=
function(){return document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:""},getWapoId=function(){return document.cookie.match(/wapo_secure_login_id=([^;]+)/)?RegExp.$1:""},getPageData=function(){var section=$("#newsletter-section").text(),subSection=$("#newsletter-subsection").text(),blog=$("#newsletter-blogname").text(),data={};washPostId=getUserId();if(washPostId!=="")data.washPostId=washPostId;if(blog)data.blog=blog;if(subSection)data.subSection=subSection;if(section)data.section=section;return data},
getMainNewsletter=function(){var data=getPageData();return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"https://recommendation-newsletter.wpdigital.net/Newsletter/api/newsletter",data:JSON.stringify(data)})},getRecommendations=function(newsletters){var data=getPageData();data.newsletters=newsletters;return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"https://recommendation-newsletter.wpdigital.net/Newsletter/api/newsletters",data:JSON.stringify(data)})},
subscribe=function(email){var data,url;if(washPostId!==""){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe";data={"wapoLoginID":washPostId,"wapoSecureID":getWapoId(),"userAgent":navigator.userAgent,"newsletterName":window.Newsletter.id,"metadata":[{"name":"nl_start_method","value":"EI"},{"name":"nl_start_location","value":"RR"}]}}else if(email){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-email";data={"email":email,"newsletterName":window.Newsletter.id,
"metadata":[{"name":"nl_start_method","value":"EI"},{"name":"nl_start_location","value":"RR"}]}}$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data),success:function(data){if(data.status=="SUCCESS"){sendCustomTrackProps("event46,event91",trackProps(window.Newsletter.name,1,"simple"),"Newsletter Right Rail Sign-up");setUpRecommendations(window.Newsletter.id)}},error:function(request,status,error){console.log(error,"Error while subscribing")}})},subscribeBundle=
function(){var data,url,newsletters=[],newsletterNames=[];$("#newsletter-suggestions-rr input:checked").each(function(index){newsletters.push($(this).val());newsletterNames.push({name:$(this).attr("name"),position:$(this).attr("data-pos")})});if(newsletters.length>0&&newsletterNames.length>0){if(washPostId!==""){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-list";data={"wapoLoginID":washPostId,"wapoSecureID":getWapoId(),"userAgent":navigator.userAgent,"newsletters":newsletters,
"metadata":[{"name":"nl_start_method","value":"EA"},{"name":"nl_start_location","value":"RR"}]}}else if(subscribeEmail){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-list-email";data={"email":subscribeEmail,"newsletters":newsletters,"metadata":[{"name":"nl_start_method","value":"EA"},{"name":"nl_start_location","value":"RR"}]}}$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data),success:function(data){if(data.status=="SUCCESS"){for(var i=
0;i<newsletterNames.length;i++)sendCustomTrackProps("event46,event91",trackProps(newsletterNames[i].name,newsletterNames[i].position,"enhanced"),"Newsletter Right Rail Sign-up Bundle");setUpRecommendations(newsletters,true);toggleRecommendations(false)}},error:function(request,status,error){console.log(error,"Error while subscribing bundle")}})}},setUpRecommendations=function(newsletterId,confirmBundleSubscribe){var recommendations=getRecommendations([window.Newsletter.id]);recommendations.done(function(data){if(!$.isEmptyObject(data.newsletters)&&
data.newsletters.length>=3&&!confirmBundleSubscribe){window.Newsletters=data.newsletters;setRecommendationsValues(data.newsletters);toggleRecommendations(true);for(var i=0;i<data.newsletters.length-1;i++)sendCustomTrackProps("event59",trackProps(data.newsletters[i+1].name,i+1,"enhanced"),"Newsletter Right Rail Show Recommendations")}else toggleRecommendations(false);showSignUpConfirmation()});recommendations.fail(function(){if(!confirmBundleSubscribe){window.Newsletters=defaultNewsLetters;setRecommendationsValues(defaultNewsLetters);
toggleRecommendations(true)}})},setUpMainNewsletter=function(newsletter){window.Newsletter=newsletter;setNewsLetterValue(newsletter);showNewsletter();if(getUserId()!=="")showSignUpButton();else showSignUpForm()},applyRrNewsletters=function(variant,version){var mainNewsletter=getMainNewsletter();mainNewsletter.done(function(data){if(!$.isEmptyObject(data.newsletter)){setUpMainNewsletter(data.newsletter);sendCustomTrackProps("event59",trackProps(data.newsletter.name,1,"simple"),"Newsletter Right Rail successfull API Call")}else hideNewsletter()});
mainNewsletter.fail(function(){setUpMainNewsletter(defaultNewsLetter);sendCustomTrackProps("event50",trackProps(defaultNewsLetter.name,1),"Newsletter Right Rail API failure case")});$(".subscribe-newsLetter").click(function(){var re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/igm;subscribeEmail=$("#newsLetter-input").val();if(this.id!=="newsletter-signUp-button"&&(subscribeEmail==""||!re.test(subscribeEmail)))showErrorMessage("Please enter a valid email address");else{hideErrorMessage();subscribe(subscribeEmail)}return false});
$("#subscribe-bundle").click(function(){subscribeBundle()});$("#cancel-bundle").click(function(){sendCustomTrackProps("event58",trackProps(),"No Thanks, Newsletter Right Rail Sign-up Bundle");toggleRecommendations(false)})};$(window.document).on("abtest-ready",function(e,ABT){if(window.TWP.Data.Tracking.props.content_type=="front")applyRrNewsletters();else if(window.TWP.Data.Tracking.props.content_type=="blog"||window.TWP.Data.Tracking.props.content_type=="article"){var testArticle=ABT.get("newsletters-articleUnits");
if(!testArticle.is("banner")&&!testArticle.is("bottom"))applyRrNewsletters(testArticle)}else applyRrNewsletters()});function trackProps(newsletterName,index,enhancedKey){var subsection=window.wp_subsection||"";var contentType=window.wp_content_type||"";var props={"eVar2":subsection,"prop2":subsection,"prop3":contentType,"eVar17":contentType};if(newsletterName&&index)props.eVar26="nl_rightrail_"+enhancedKey+"_"+newsletterName.toLowerCase().split(" ").join("-")+"_"+index;return props}function sendCustomTrackProps(eventKey,
props,name){if(!!window.s)window.s.sendDataToOmniture(name||"PB Feature - Page-Newsletter",eventKey,props,{wait:true})}})(jQuery);
(function($){try{function cleanUp(){$("li","#editors-picks-rr").each(function(i){var $this=$(this);var $headline=$(".headline",$this);var $number=$(".number",$this);var lineHeight=parseInt($headline.css("lineHeight"));if($headline.height()<=2*lineHeight)$headline.css({"padding-top":"7px","padding-bottom":"8px"});else if($headline.height()>3*lineHeight)while($headline.height()>3*lineHeight){$headline.text($headline.text().replace(/\.\.\.$/,""));$headline.text($headline.text().slice(0,-1));$headline.text($headline.text()+
"...")}})}cleanUp()}catch(e){}})(jQuery);
(function($){var yourThreeDoms=$(".posttv-your-three-container");var initYourThree=function(yourThreeDom){var $root=$(yourThreeDom),$loadPlaylistButton=$root.find(".posttv-your-three-show-button"),$stacks=$root.find(".posttv-your-three-stacks"),uniquePlayerToken=$stacks.attr("data-player-token"),currentStackIndex=0,currentListItemIndex=0,adCounter=0;var getStack=function(stackIndex){return $root.find("#posttv-your-three-stack-"+stackIndex)};var getStackVideoWrapper=function(stackIndex){return $(".posttv-your-three-stack-video-wrapper",
$root.find("#posttv-your-three-stack-"+stackIndex))};var getListItem=function(stackIndex,listItemIndex){return $("#posttv-your-three-list-item-"+listItemIndex,getStack(stackIndex))};var getHeadline=function(stackIndex){return $(".posttv-your-three-video-headline",getStack(stackIndex))};var getPromoImage=function(stackIndex){stackIndex=typeof stackIndex==="undefined"?currentStackIndex:stackIndex;return getStack(stackIndex).find(".posttv-your-three-video-promo")};var selectVideo=function(startPlaying,
stackNo,listItemIndex,scrollToPlayer){wp_pb.report(uniquePlayerToken,"stop_video");var $previousStack=getStack(currentStackIndex);var $previousPromoImage=getPromoImage(currentStackIndex);if(currentStackIndex!=stackNo){var $topOfPreviousStack=getListItem(currentStackIndex,0);$previousPromoImage.css("position","relative");$previousPromoImage.show();$topOfPreviousStack.hide();getStackVideoWrapper(currentStackIndex).insertBefore($topOfPreviousStack);getHeadline(currentStackIndex).html($topOfPreviousStack.attr("data-video-title"));
$(".posttv-your-three-stack-video",$previousStack).prependTo(getStackVideoWrapper(stackNo));getPromoImage(stackNo).css("position","absolute")}if(currentListItemIndex!=0)getListItem(currentStackIndex,currentListItemIndex).show();if(listItemIndex!=0)getListItem(stackNo,0).show();currentStackIndex=stackNo;currentListItemIndex=listItemIndex;var $currentStack=getStack(currentStackIndex),$currentListItem=getListItem(currentStackIndex,currentListItemIndex),$currentHeadline=getHeadline(currentStackIndex);
$currentListItem.hide();if(currentListItemIndex==2){$currentHeadline.removeClass("border-bottom-hairline-top-table");$currentHeadline.css("padding","5%")}else{$currentHeadline.addClass("border-bottom-hairline-top-table");$currentHeadline.css("padding","5% 5% 0 5%")}getStackVideoWrapper(currentStackIndex).insertBefore($currentListItem);$(".posttv-your-three-video-headline",$currentStack).html($currentListItem.attr("data-video-title"));wp_pb.report(uniquePlayerToken,"new_video_selected",{image:$currentListItem.attr("data-video-image"),
uuid:$currentListItem.attr("data-video-uuid"),startPlaying:startPlaying,shouldPlayAd:adCounter===0,scrollToPlayer:scrollToPlayer});adCounter=(adCounter+1)%3};var loadPlaylistBtnClicked=function(){for(var a=0;a<numberOfStacks;a++)getStack(a).show();$loadPlaylistButton.hide()};var initYourThreeStack=function(stackDom,stackIndexArg){var $stack=$(stackDom),stackIndex=stackIndexArg,numberOfVideos=$stack.find(".posttv-your-three-list-item").length;var playNextVideo=function(){if(currentStackIndex===stackIndex){var endOfPlaylist=
(currentListItemIndex+1)/numberOfVideos==1;var newListItemIndex=(currentListItemIndex+1)%numberOfVideos;selectVideo(!endOfPlaylist,stackIndex,newListItemIndex,false)}};var newVideoSelected=function(event){var $videoEl=$($(event.target).closest(".posttv-your-three-list-item"));var selectedListItemIndex=parseInt($videoEl.attr("id").split("posttv-your-three-list-item-")[1]);selectVideo(true,stackIndex,selectedListItemIndex,true)};var hidePromoImage=function(){if(currentStackIndex===stackIndex)getPromoImage(currentStackIndex).hide()};
getPromoImage(stackIndex).click(function(){selectVideo(true,stackIndex,0,true)});$(".posttv-your-three-list-item",$stack).click(newVideoSelected);$(function(){wp_pb.register(uniquePlayerToken,"video_completed",playNextVideo,this);wp_pb.register(uniquePlayerToken,"video_started",hidePromoImage,this)})};var init=function(){$loadPlaylistButton.click(loadPlaylistBtnClicked);var yourThreeStacks=$root.find(".posttv-your-three-stack",".posttv-your-three-stacks");for(var i=0;i<yourThreeStacks.length;i++)initYourThreeStack(yourThreeStacks[i],
i);getStack(currentStackIndex).show()};init()};for(var i=0;i<yourThreeDoms.length;i++)initYourThree(yourThreeDoms[i],i)})(jQuery);
(function($,TWP){var AD_LOAD_TIMEOUT=4E3;var applyStickiness=function(){var $window=$(window),$ad=$(".pb-f-ad-flex-3"),$nextStory=$(".pb-f-article-next-story"),$leaderboardAd=$(".pb-f-ad-leaderboard-2"),$rightRail=jQuery(".right-rail");$ad.on("DOMNodeInserted",function(e){var $el=$(e.target),id=$el.attr("id");if($el.is("iframe")&&id&&!/(hidden)/g.test(id)){$ad.off("DOMNodeInserted");afterAdInserted($el)}});var bindScrollDown=function(){var original_top=$ad.offset().top,scrollTop,ad_left=$rightRail.offset().left;
var getStopPoint=function(){var featureTop=$nextStory.is(":visible")?$nextStory.offset().top:$leaderboardAd.offset().top;return featureTop-$ad.height()-50};var applySticky=function(scrollTop){var stopPoint=getStopPoint();if(scrollTop>stopPoint){if($ad.hasClass("sticky")){$ad.removeClass("sticky");$ad.css({"top":stopPoint,"position":"absolute"})}}else if(!$ad.hasClass("sticky")){$ad.css({"top":100,"left":ad_left,"width":330,"position":"initial"});$ad.addClass("sticky")}};var removeSticky=function(){if($ad.hasClass("sticky")){$ad.attr("style",
"");$ad.removeClass("sticky")}};$window.off("scroll.flexAd3-sticky").on("scroll.flexAd3-sticky",function(){scrollTop=$window.scrollTop();if(scrollTop>original_top)applySticky(scrollTop);else removeSticky()});$window.off("resize.flexAd3-sticky").on("resize.flexAd3-sticky",function(){ad_left=$rightRail.offset().left;$ad.css({"left":ad_left})})};var afterAdInserted=function($el){var iframeError=setTimeout(function(){$el.off("load");bindScrollDown()},AD_LOAD_TIMEOUT);$el.on("load",function(){clearTimeout(iframeError);
$el.off("load");bindScrollDown()})}};if(TWP.Features.Ad.flexAd3&&TWP.Features.Ad.flexAd3.sticky)applyStickiness()})(jQuery,TWP);
(function($){TWP=window.TWP||{};TWP.PostTV=TWP.PostTV||{};TWP.PostTV.StickyPlayer=TWP.PostTV.StickyPlayer||{};var $root=$($(".pb-f-posttv-sticky-player")),$subRoot=$root.find(".posttv-sticky-player-video"),$vidWrapper=$root.find(".posttv-sticky-player-wrapper"),$textEl=$root.find(".posttv-sticky-player-text"),$caption=$root.find(".posttv-sticky-player-caption");TWP.PostTV.StickyPlayer.showPlayer=function(){$subRoot.removeClass("hidden")};TWP.PostTV.StickyPlayer.hidePlayer=function(){$subRoot.addClass("hidden")};
TWP.PostTV.StickyPlayer.showText=function(){$textEl.removeClass("hidden")};TWP.PostTV.StickyPlayer.hideText=function(){$textEl.addClass("hidden")};TWP.PostTV.StickyPlayer.updateBlurb=function(newBlurb){$caption.html(newBlurb)};var adjustSize=function(){var stickyWidth=$(window).width()*.3+12;if(stickyWidth>492)stickyWidth=492;else if(stickyWidth<156)stickyWidth=156;$root.css({"width":stickyWidth});$vidWrapper.css({"width":stickyWidth-12});$vidWrapper.css({"height":$vidWrapper.width()*9/16})};$(window).off("resize.stickyPlayerResize").on("resize.stickyPlayerResize",
function(){adjustSize()});adjustSize();function isElementInViewport(el,fract){if(typeof jQuery==="function"&&el instanceof jQuery)el=el[0];var fraction=fract||.8;var rect=el.getBoundingClientRect();var topOffsetAdjustment=0,$navBarEl=$("#nav-bar"),$breakingNewsEl=$(".pb-f-page-breaking-news-bar"),$shareBarEl=$(".top-sharebar-wrapper",".pb-f-sharebars-top-share-bar");if($navBarEl.length>0)topOffsetAdjustment+=$navBarEl.height();if($breakingNewsEl.length>0)topOffsetAdjustment+=$breakingNewsEl.height();
if($shareBarEl.length>0)topOffsetAdjustment+=$shareBarEl.height();return rect.top+el.offsetHeight*fraction>=topOffsetAdjustment&&rect.left>=0&&rect.bottom-el.offsetHeight*fraction<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)||rect.top<0&&rect.bottom>(window.innerHeight||document.documentElement.clientHeight)}var $players=$(".posttv-video-embed");var throttleInterval=5;var waitInterval=400;var lastTime=(new Date).getTime();
var isOut=false;var playerOutId;var waitTimeout;var $target=$("#posttv-sticky-player-wrapper");var $stickyClose=$(".posttv-sticky-player-exit");var outTracker=false;var closeTracker=false;var WAIT=false;function getExceptions(){var url="//projects.posttv.com/siteconfig/settings.json";$.getJSON(url,function(data){var excludeUrls=data["sticky-player-exclude-urls"];var isException=false;excludeUrls.forEach(function(url){if(window.location.href.indexOf(url)>-1)isException=true});if(!isException)initEventHandlers()})}
function safetyCheck(cb){clearTimeout(waitTimeout);waitTimeout=setTimeout(function(){WAIT=true;cb&&cb()},waitInterval)}function moveOut(id,$el,playerEmbed){if(!outTracker){playerEmbed.reportEvent("event8888","Sticky Player initialized");outTracker=true}playerOutId=id;isOut=true;$root.removeClass("hidden");clearTimeout(waitTimeout);if($target.get(0).style.display!="none")playerEmbed.animateTo($el,{fixed:true,zIndex:536870903,cb:function(){if(isOut)TWP.PostTV.StickyPlayer.showPlayer()}})}function moveBack($el,
playerEmbed){TWP.PostTV.StickyPlayer.hidePlayer();safetyCheck(function(){playerEmbed.animateTo($el,{cb:function(){WAIT=false}})});$root.addClass("hidden");isOut=false}function checkPlayers(){var $el=$($players.get(0));if($el.data("aspect-ratio")<.56||$el.data("aspect-ratio")>.57)return true;var id=$el.attr("id");var hasBeenVisible=$el.data("has-been-visible");var player=window.TWP&&TWP.PostTV&&TWP.PostTV.players?TWP.PostTV.players[id]:null;var playerEmbed=window.TWP&&TWP.PostTV&&TWP.PostTV.embeds?
TWP.PostTV.embeds[id]:null;var $wrap=$el.parent().hasClass("wpv-wrap")?$el.parent():$el.parent().parent().hasClass("wpv-wrap")?$el.parent().parent():null;if($wrap&&player&&player.player&&hasBeenVisible&&!closeTracker)if(isElementInViewport($wrap)&&isOut&&playerOutId===id)moveBack($wrap,playerEmbed);else if(!isElementInViewport($wrap)&&!isOut&&player.player.getState()==="playing")moveOut(id,$target,playerEmbed)}function initEventHandlers(){$(window).scroll(function(){var time=(new Date).getTime();
if(time-lastTime>throttleInterval&&isMobile&&!isMobile.any()&&!WAIT){lastTime=time;checkPlayers()}});$(window).resize(function(){if(isOut&&playerOutId)TWP.PostTV.embeds[playerOutId].animateTo($target,{fixed:true,speed:10,zIndex:536870903})});$stickyClose.click(function(){var playerEmbed=playerOutId?TWP.PostTV.embeds[playerOutId]:null;var player=TWP.PostTV.players[playerOutId];if(!closeTracker){playerEmbed.reportEvent("event8889","Sticky Player closed");closeTracker=true}if(playerEmbed){player.pause();
moveBack($("#"+playerOutId).parent(),playerEmbed)}})}var waitForPubSub=setInterval(function(){if(typeof PubSub!=="undefined"){clearInterval(waitForPubSub);PubSub.subscribe("playerCreated",function(msg,data){var $el=$("#"+data.playerContainerId);$el.addClass("wpv-sticky");var $wrap=$el.parent().hasClass("wpv-wrap")?$el.parent():null;var playerEmbed=TWP&&TWP.PostTV&&TWP.PostTV.embeds?TWP.PostTV.embeds[$el.attr("id")]:null;if(!$wrap&&playerEmbed)playerEmbed.wrap()})}},200);getExceptions();$(function(){$root.addClass("hidden")})})(jQuery);
(function($){var $content=$("#next-story-bg");var imageUrl=nextStoryImage();if(imageUrl&&!!$content.size()&&$content.width()>480)$content.css("background-image","url("+imageUrl+")");function nextStoryImage(){return TWP.Features&&TWP.Features.Article&&TWP.Features.Article.NextStory&&TWP.Features.Article.NextStory.tnUrl}})(jQuery);
(function($){})(jQuery);
(function(){function rutabaga(){var version="v1";var $=jQuery;var T=TWP.Perso.Tools;var $body=$("body");var $window=$(window);var $document=$(document);var log=new TWP.Tools.logger("RUTABAGA");log.debug("Initializing");var events={"DARWIN_BEFORE":"DARWIN_BEFORE","DARWIN_INIT":"DARWIN_INIT","DARWIN_READY":"DARWIN_READY","DOM_READY":"DOM_READY","CLICK":"CLICK","ACTIVITY_TICKER":"AT","CLICKS_TICKER":"CT","MOUSE_TICKER":"MT","SCROLL_TICKER":"ST"};var endpoint="https://rutabaga.perso.nile.works/events";
var sendEvent=T.Analytics.sender({url:endpoint,logger:log,maxTime:10});function recordEvent(name,data){data=data||{};data.event=name;data.version=version;sendEvent(data)}T.Analytics.ticker(recordEvent,events,log);$(function(){recordEvent(events.DOM_READY)});$document.on("abtest-before",function(){recordEvent(events.DARWIN_BEFORE)});$document.on("abtest-init",function(){recordEvent(events.DARWIN_INIT)});$document.on("abtest-ready",function(ev,ABT){recordEvent(events.DARWIN_READY)})}})();
(function($,window){var svi="";var sviFull=document.cookie.match(/s_vi=([^;]+)/)?RegExp.$1:"";try{if(sviFull&&sviFull!==""){svi=sviFull.replace(/.*\|/,"").replace(/\[.*/,"").split("-");svi=svi[0]+"-"+svi[1]}}catch(e){svi=""}var ttlForusersegments=1;function getHoursSinceLastTime(lastTime){var datetime=(new Date(lastTime)).getTime();var now=(new Date).getTime();if(isNaN(datetime))return ttlForusersegments+1;if(datetime<now)var milisec_diff=now-datetime;else var milisec_diff=datetime-now;var date_diff=
Math.floor(milisec_diff/1E3/60/60);return date_diff}function isParamValid(variable){return variable!=null&&variable!="null"}function isUserSegmentsInvalidOrStale(){usersegments=localStorage.getItem("usersegments");if(!isParamValid(usersegments))return true;else{var json=JSON.parse(usersegments);var usersegmentsstoragetime=json["updated"];if(getHoursSinceLastTime(usersegmentsstoragetime)>=ttlForusersegments)return true}return false}function saveKeyValue(key,value){if(window.localStorage)localStorage.setItem(key,
value);document.cookie=key+"\x3d"+value+";expires\x3d"+(new Date(Date.now()+365*24*3600*1E3)).toUTCString()+";path\x3d/"}function setCookies(data){if(!data||!data.segmentsFlag)return;for(key in data.segmentsFlag)if(data.segmentsFlag.hasOwnProperty(key))document.cookie="us."+key+"\x3d"+data.segmentsFlag[key]+";expires\x3d"+(new Date(Date.now()+365*24*3600*1E3)).toUTCString()+";path\x3d/"}function setAdopsData(data){if(data&&data["segmentsFlag"]){var value=data["segmentsFlag"]["7978704408"];if(value==
"8936"){saveKeyValue("8936",1);saveKeyValue("9868",0);saveKeyValue("6136",0)}else if(value=="9868"){saveKeyValue("8936",0);saveKeyValue("9868",1);saveKeyValue("6136",0)}else if(value=="6136"){saveKeyValue("8936",0);saveKeyValue("9868",0);saveKeyValue("6136",1)}else{saveKeyValue("8936",0);saveKeyValue("9868",0);saveKeyValue("6136",0)}var value=data["segmentsFlag"]["5497328667"];if(value=="7204"){saveKeyValue("7204",1);saveKeyValue("0862",0);saveKeyValue("2467",0);saveKeyValue("0668",0)}else if(value==
"0862"){saveKeyValue("7204",0);saveKeyValue("0862",1);saveKeyValue("2467",0);saveKeyValue("0668",0)}else if(value=="2467"){saveKeyValue("7204",0);saveKeyValue("0862",0);saveKeyValue("2467",1);saveKeyValue("0668",0)}else{saveKeyValue("7204",0);saveKeyValue("0862",0);saveKeyValue("2467",0);saveKeyValue("0668",1)}}}if(window.localStorage&&window.JSON)if(isUserSegmentsInvalidOrStale())$.ajax("https://usersegment.wpdigital.net/usersegments",{type:"POST",dataType:"json",processData:false,contentType:"application/json",
data:'{"userid": "'+svi+'"}'}).done(function(data){if(isParamValid(data)){setCookies(data);setAdopsData(data);data["updated"]=new Date;localStorage.setItem("usersegments",JSON.stringify(data))}});var hasStorage=function(){var storageTest=new Date;try{localStorage.setItem(storageTest,storageTest);localStorage.removeItem(storageTest);return true}catch(e){return false}}();function removeCookie(name){if(document.cookie)document.cookie=name+"\x3d;expires\x3dThu, 01 Jan 1970 00:00:01 GMT;"}function normalizeURL(url,
params){var str=(url||"").trim();str=str.replace(/^(https?:)?\/\//,"");str=str.replace(/\?.*/,"");if(params)str=str.replace(/\/$/,"");return str}function extractParam(param){var rgx=new RegExp(".*[?\x26]"+param+"\x3d([^\x26]+).*");if(rgx.test(document.location.toString()))return document.location.toString().replace(rgx,"$1");else return""}var clavisAuxiliaries=window.wp_meta_data&&wp_meta_data.clavis&&wp_meta_data.clavis.auxiliaries,canonicalUrl=$('link[rel\x3d"canonical"]').attr("href"),userId=!!document.cookie.match(/s_vi=([^;]+)/)?
RegExp.$1:"unavailable";if(!canonicalUrl)canonicalUrl=[window.location.host,window.location.pathname].join("");var contentType="";try{contentType=TWP.Data.Tracking.props.content_type}catch(e){}var dataPayload={"articleid":normalizeURL(canonicalUrl,true),"referrer":normalizeURL(document.referrer),"contentType":contentType,"tid":extractParam("tid"),"userid":userId,"uuid":!!document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:"","auxiliaries":!!clavisAuxiliaries?clavisAuxiliaries:[],"wp_meta_data":window.wp_meta_data||
null,"isMobile":window.isMobile&&window.isMobile.any()};var targetingServerUrl=TWP&&TWP.Features&&TWP.Features.Page&&TWP.Features.Page.Targeting&&TWP.Features.Page.Targeting.endpointServer;$.ajax({url:!!targetingServerUrl?targetingServerUrl:"//targeting.wpdigital.net/TargetingWebAPP/targeting",type:"POST",contentType:"application/json",dataType:"JSON",data:JSON.stringify(dataPayload)}).done(function(response){if(!!response){var auxMap=response.aux_map&&response.aux_map.join(",");if(!auxMap)$.ajax({url:"https://recommendation-hybrid.wpdigital.net/hybrid/hybrid-filter/custom",
type:"POST",data:{type:"noaux",error:JSON.stringify(response)}});else if(hasStorage)window.localStorage.setItem("targeting_aux_map",auxMap);else if(!!$&&!!$.cookie)$.cookie("targeting_aux_map",auxMap);else document.cookie="targeting_aux_map\x3d"+auxMap}else hasStorage?localStorage.setItem("targeting_aux_map",""):removeCookie("targeting_aux_map")}).fail(function(errorResponse){$.ajax({url:"https://recommendation-hybrid.wpdigital.net/hybrid/hybrid-filter/custom",type:"POST",data:{type:"fail",error:JSON.stringify(errorResponse)}})})})(jQuery,
window);
(function($){var wp_pb=window.wp_pb||{},env=wp_pb.environment||"production",apiBaseURL=env=="production"?"https://subscribe.washingtonpost.com/drawbridgeservice/queue-drawbridge":"https://subscribe.digitalink.com/drawbridgeservice/queue-drawbridge",washPostId,subscribeEmail,db_cookie_name="drawbridge_o",db_cookie_expiration=42,db_cookie_domain=env=="production"?".washingtonpost.com":".digitalink.com",showDrawbridgeOverlay=function(elm){},closeDrawbridgeOverlay=function(elm){},showErrorMsgInStream=
function(elm,message){if(message)elm.text(message).show()},hideErrorMsgInStream=function(elm){elm.hide()},getUserId=function(){return document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:""},getWapoId=function(){return document.cookie.match(/wapo_secure_login_id=([^;]+)/)?RegExp.$1:""},resetFixed=function(data){if(data=="opened"&&$(".bar-hidden").length==0){$(".jqmOverlay, #drawbridge-signup-overlay").addClass("nav-open").removeClass("nav-closed");var headerHeight=$("#nav-bar").height();$(".jqmOverlay, #drawbridge-signup-overlay").css("margin-top",
headerHeight)}else{$(".jqmOverlay, #drawbridge-signup-overlay").removeClass("nav-open").addClass("nav-closed");$(".jqmOverlay, #drawbridge-signup-overlay").css("margin-top","")}},subscribeInStream=function(email,testName,variantName,successCookieValue){var data={};data.email=email;data.testName=testName;data.variantName=variantName;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:apiBaseURL,data:JSON.stringify(data),success:function(data){if(data.status=="SUCCESS"){sendCustomTrackProps("event87",
trackProps(),"Drawbridge Signup email sent");document.cookie="drawbridge_o\x3d"+successCookieValue+";expires\x3d"+(new Date(Date.now()+60*60*24*db_cookie_expiration*1E3)).toUTCString()+";path\x3d/"+";domain\x3d"+db_cookie_domain;$("#db-signup-email").hide();$("#subscribe-group").removeClass("processing");$("#db-signup-thanks").show()}else if(data.status=="FAILURE"&&data.messages.indexOf("Invalid Email")>-1){$("#subscribe-group").removeClass("processing");showErrorMsgInStream($(".error-msg-email"),
"Please enter a valid email address")}else{$("#subscribe-group").removeClass("processing");showErrorMsgInStream($(".error-msg-email"),"Error while subscribing, please try later")}},error:function(request,status,error){$("#subscribe-group").removeClass("processing");showErrorMsgInStream($(".error-msg-email"),"Error while subscribing, please try later")}}).fail(function(){$("#subscribe-group").removeClass("processing");showErrorMsgInStream($(".error-msg-email"),"Error while subscribing, please try later")})},
applyTest=function(testName,variantName,openCookieValue,successCookieValue,includeClose,includeEmail){if($("#drawbridge-signup-overlay").length===0)return true;openCookieValue=typeof openCookieValue=="undefined"?"":openCookieValue;successCookieValue=typeof successCookieValue=="undefined"?"":successCookieValue;includeClose=typeof includeClose=="undefined"?false:includeClose;includeEmail=typeof includeEmail=="undefined"?true:includeEmail;setTimeout(function(){sendCustomTrackProps("event86",trackProps(),
"Drawbridge Overlay Opened")},5E3);typeof wp_pb.register=="function"&&wp_pb.register("nav","finish_open",function(){resetFixed("opened")});typeof wp_pb.register=="function"&&wp_pb.register("nav","finish_close",function(){resetFixed("closed")});if(/wapo_secure_login_id/.test(document.cookie))$("#subscribe-link").hide();$("#db-signup-email .subscribe-btn").click(function(){hideErrorMsgInStream($(".error-msg-email"));hideErrorMsgInStream($(".error-msg-checkbox"));subscribeEmail=$("#email-field").val(),
re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/im;if(subscribeEmail==""||!re.test(subscribeEmail)){showErrorMsgInStream($(".error-msg-email"),"Please enter a valid email address");return false}if($("#agree-checkbox input.checkbox").attr("checked")!="checked"){showErrorMsgInStream($(".error-msg-checkbox"),"Please read and accept terms");return false}$("#subscribe-group").addClass("processing");subscribeInStream(subscribeEmail,testName,variantName,successCookieValue)});$modal=$("#drawbridge-signup-overlay");
if(wp_pb.DrawbridgeTest&&wp_pb.DrawbridgeTest[variantName]){$(".titleMessage",$modal).html(wp_pb.DrawbridgeTest[variantName]["titleMessage"]);$(".placeholderImage",$modal).html(wp_pb.DrawbridgeTest[variantName]["placeholderImage"]);$(".subscriptionMessage",$modal).html(wp_pb.DrawbridgeTest[variantName]["subscriptionMessage"]);$(".thankyouMessage",$modal).html(wp_pb.DrawbridgeTest[variantName]["thankyouMessage"])}$modal.jqm({overlay:85,modal:true,toTop:true,trigger:false,closeClass:"overlay-closer",
onShow:function(h){var marginl=$(window).width()>768?($(window).width()-768)/2:0;h.o.prependTo("body");h.w.css("margin-left",marginl).show();if(!/drawbridge_o/.test(document.cookie))document.cookie=db_cookie_name+"\x3d"+openCookieValue+";expires\x3d"+(new Date(Date.now()+60*60*24*db_cookie_expiration*1E3)).toUTCString()+";path\x3d/"+";domain\x3d"+db_cookie_domain;resetFixed("opened");if(includeClose)$(".btn-close").show();if(!includeEmail)$("#subscribe-group, #agree-checkbox, #subscribe-link").hide();
setTimeout(function(){if(!elementIsVisible($(".jqmOverlay"))||!elementIsVisible($("#drawbridge-signup-overlay")))sendCustomTrackProps("event84",{eVar26:"drawbridge-element-blocked"},"drawbridge-element-blocked")},2E3)},onHide:function(h){sendCustomTrackProps("event80",{eVar26:"drawbridge_close"},"drawbridge-modal-close");h.w.fadeOut("2000",function(){h.o.remove()})}});$modal.jqmShow()},trackProps=function(newsletterName,index,enhancedKey){var subsection=window.wp_subsection||"";var contentType=window.wp_content_type||
"";var props={"eVar1":wp_page_name,"eVar2":wp_channel,"eVar8":wp_author,"eVar25":wp_blogname};return props},sendCustomTrackProps=function(eventKey,props,name){if(!!window.s)window.s.sendDataToOmniture(name||"Drawbridge Test 1",eventKey,props,{wait:true})};function elementIsVisible(elem){elem=elem instanceof jQuery?elem:$(elem);return elem.is(":visible")}db_cookie_name_ab_test="drawbridge_test";if(!/rplsb=1/.test(document.cookie))$(window.document).on("abtest-ready",function(e,ABT){var test=ABT.get("subscription-modal");
if(test.is("active"))if(!/drawbridge_o/.test(document.cookie)||/drawbridge_o=1/.test(document.cookie))applyTest(test)});if(!/wapo_secure_login_id=/.test(document.cookie))window._moatState&&window._moatState.then(function(){document.cookie=db_cookie_name+"\x3d"+""+";expires\x3d"+";path\x3d/"+";domain\x3d"+db_cookie_domain},function(){if(window.TWP&&TWP.ABTest&&TWP.ABTest.state()==="initialized")drawbridgeABTHandler(null,TWP.ABTest);else $(window.document).on("abtest-ready",drawbridgeABTHandler);function drawbridgeABTHandler(e,
ABT){var test=ABT.get("drawbridge-adb",true);document.cookie=db_cookie_name_ab_test+"\x3d"+"drawbridge-adb"+"|"+test.name+";expires\x3d"+(new Date(Date.now()+60*60*24*db_cookie_expiration*1E3)).toUTCString()+";path\x3d/"+";domain\x3d"+db_cookie_domain;if(!/drawbridge_o/.test(document.cookie)||!/drawbridge_o=2/.test(document.cookie)){if(test.is("subscription"))applyTest("drawbridge-adb","subscription","3","2");else if(test.is("nosubscription"))applyTest("drawbridge-adb","nosubscription","4","2");else if(test.is("paywall")){document.cookie=
db_cookie_name+"\x3d"+"5"+";expires\x3d"+(new Date(Date.now()+10*1E3)).toUTCString()+";path\x3d/"+";domain\x3d"+db_cookie_domain;TWP.Identity.auth()}else if(test.is("overlay"))applyTest("drawbridge-adb","overlay","6","2",includeClose=true,includeEmail=false);test.sendTrackVars(false,"event100",{wait:true})}}})})(jQuery);
var TWP=window.TWP||{};TWP.ABTestUser=TWP.ABTestUser||{};
(function ABTestAnonymous($,TWP,wp_import,VisitorSegment,undefined){var OPT_OUT_KEY="ABT__OO";var IGNORE_BL_KEY="ABT__ib";var LOCAL_TRUE="yes";var LOCAL_FALSE="no";var featureData={};var bucketData={};var disabled;var ignoreBlacklist;var state="uninitialized";var $d=$(window.document);var ABT={init:function(data){disabled=!data;$d.trigger("abtest-before",[ABT]);ABT.applyData(data);if(state!="initialized")$d.trigger("abtest-ready",[ABT]);state="initialized";$d.trigger("abtest-init",[ABT])},state:function(){return state},
trackBefore:function(eventHandler){bindTop($d,ABT.trackPageviewEventBefore(),eventHandler)},trackAfter:function(eventHandler){bindTop($d,ABT.trackPageviewEventAfter(),eventHandler)},trackValueDelimeter:function(){return TWP.ABTestUser.trackValueDelimeter},trackPageviewEventBefore:function(){return TWP.ABTestUser.trackPageviewEventBefore},trackPageviewEventAfter:function(){return TWP.ABTestUser.trackPageviewEventAfter},trackSendHandler:function(){var method=str2obj(TWP.ABTestUser.trackSendHandler);
return"function"==typeof method?method:function(){}},trackSetHandler:function(){var method=str2obj(TWP.ABTestUser.trackSetHandler);return"function"==typeof method?method:function(){}},trackUnsetHandler:function(){var method=str2obj(TWP.ABTestUser.trackUnsetHandler);return"function"==typeof method?method:function(){}},applyData:function(dataValue){var data;if(!disabled&&detectLocalStorage()&&!optOut()){data={features:[]};ignoreBlacklist=getLocalItem(IGNORE_BL_KEY);$.each(dataValue||[],function(index,
bucket){if("boolean"==typeof bucket.disabled&&!bucket.disabled)$.merge(data.features,bucket.features)});ABT.bucket(data)}},bucket:function(data){bucketData=data;var features;if(!data.disabled){features=data.features||[];$.each(features,function(index,feature){setFeature(feature)})}},ignoreBlacklist:function(value){if(!value){ignoreBlacklist=undefined;removeLocalItem(IGNORE_BL_KEY)}else{ignoreBlacklist=LOCAL_TRUE;setLocalItem(IGNORE_BL_KEY,LOCAL_TRUE)}},optOut:function(){setLocalItem(OPT_OUT_KEY,LOCAL_TRUE);
$d.trigger("abtest-optout",[ABT])},get:function(name,skipTrack){var feature=!disabled&&featureData[name]||{};var variation=feature.variation||new Variation(feature);if(!skipTrack&&feature.variation&&!variation._trackset){variation._trackset=true;ABT.trackBefore(function(){variation.setTrackVars()});ABT.trackAfter(function(){variation.unsetTrackVars()})}return variation},clear:function(){$.each(bucketData.features,function(i,f){unregisterVariation(f.name)})},forceTest:function(featureName,variantName){var key=
makeKeyNames(featureName);setLocalItem(key.name,variantName);setLocalItem(key.visit,LOCAL_TRUE);setLocalItem(key.computed,LOCAL_TRUE);setLocalItem(key.force,LOCAL_TRUE)}};ABT.$handlers={applyClass:function(isVariant,feature,variant){this.removeClass("abt-not-loaded").addClass("abt-"+feature+"-"+variant+"-"+isVariant)}};$.fn.extend({biAbtest:function(handlerName,name,cb){var config=getConfig(name);var ftr=ABT.get(config.feature);var is=ftr.is(config.variant);function getConfig(name){var n=name.split(".");
return{feature:n[0],variant:n[1]}}if(!config.feature||!config.variant)return;return this.each(function(){var $el=$(this);ABT.$handlers[handlerName].call($el,is,config.feature,config.variant);if(cb)cb.call($el,is,config.feature,config.variant)})}});TWP.ABTest=ABT;if(!!VisitorSegment)ABT.init(TWP.ABTestBucket);else if(!!wp_import&&!VisitorSegment)wp_import(["VisitorSegment"],function(vs){VisitorSegment=vs;ABT.init(TWP.ABTestBucket)});else initError("failed during dependency acquisition");function initError(msg){$d.trigger("abtest-fail",
[["init",msg].join(": ")])}function Feature(data){var name=data.name||"";var key=makeKeyNames(name);var increment=data.increment||0;var variations=data.variations||[];var blacklist=data.blacklist&&data.blacklist.referrers||[];var included=true;var blacklisted=getLocalItem(key.blacklisted)==LOCAL_TRUE;var bopt;if(!blacklisted&&!getLocalItem(key.blacklisted)){bopt={domains:blacklist,segment:{}};var segmentName;for(segmentName in data.segment)bopt.segment[segmentName]=!!data.segment[segmentName];included=
!notInSegment(bopt.segment);blacklisted=isBlacklisted(bopt.domains)||!included;setLocalItem(key.blacklisted,blacklisted?LOCAL_TRUE:LOCAL_FALSE)}var enabled=!!variations.length;var variation=variations.length&&new Variation(registerVariation(name,variations,blacklisted,increment));if(enabled&&data.active&&!variation.nocollect){this.name=name;this.variation=variation}var defaultTrack=enabled&&data.active?data.defaultTrack:[];if(blacklisted)$.merge(defaultTrack,data.blacklist&&data.blacklist.track||
[]);if(defaultTrack.length&&variation.nocollect)this.variation=new Variation({variation:{track:!included?[]:defaultTrack}});if(!enabled||!variation)unregisterVariation(name)}function Variation(objValue){var obj=objValue||{};this.nocollect=!obj.collect;var data=obj.variation||{};this.name=data.name||"";this.trackvars=data.track||[];this.customOptions=data.customOptions||{};var _self=this;this.is=function(name){return name?name===_self.name:false};this.getTrackVar=function(name,prepend,delimiterValue){var result=
[];$.each(_self.trackvars,function(index,trackvar){if(makeTrackvarName(name)===makeTrackvarName(trackvar.name))result.push(trackvar.value)});var delimiter=delimiterValue||ABT.trackValueDelimeter();result=result.join(delimiter);return result&&(prepend?prepend+delimiter:"")+result};this.sendTrackVars=function(setOp,eventKey,extraOptions){var payload=trackingPayload();var trackargs=["Darwin - TrackVar",eventKey||"",payload,extraOptions];if(setOp)ABT.trackSetHandler().apply(ABT,[payload]);else ABT.trackSendHandler().apply(ABT,
trackargs);$d.trigger("abtest-tracksend",trackargs)};this.unsetTrackVars=function(){var payload=trackingPayload();ABT.trackUnsetHandler().apply(ABT,[payload])};this.setTrackVars=function(){var payload=trackingPayload();ABT.trackSetHandler().apply(ABT,[payload])};this.sendCustomTrackVar=function(){return undefined};this.unsetCustomTrackVar=function(){return undefined};this.setCustomTrackVar=function(){return undefined};function trackingPayload(){var payload={};$.each(_self.trackvars,function(index,
trackvar){var svar;if(!trackvar.dynamic){svar=makeTrackvarName(trackvar.name);payload[svar]=payload[svar]||[];payload[svar].push(trackvar.value)}});return payload}}function registerVariation(name,variations,blacklisted,increment){var key=makeKeyNames(name);var his={cur:testHash(name,variations,blacklisted,increment),old:getLocalItem(key.hash)};var i=getLocalItem(key.name);var r=LOCAL_TRUE==getLocalItem(key.visit);var t=LOCAL_TRUE==getLocalItem(key.computed);var f=LOCAL_TRUE==getLocalItem(key.force);
var compare=function(a,b){var a=parseFloat(a.customOptions.target);var b=parseFloat(b.customOptions.target);if(a<b)return-1;if(a>b)return 1;return 0};var v=findByProp(variations,"name",i);if(!t&&!blacklisted&&("string"!==typeof i&&!v)||!f&&!!t&&his.cur!=his.old){variations.sort(compare);var ranges=[];var g=0;var h=0;$.each(variations,function(index,variant){var v=variant.customOptions&&variant.customOptions.target;if(v){v=parseFloat(v)/100;g+=v;var result={value:[h,g]};h+=v;ranges.push(result)}});
var rc=randChance();$.each(ranges,function(index,range){if(between(rc,range.value[0],range.value[1]))i=index});v=variations[i];if(v)setLocalItem(key.name,v.name);else setLocalItem(key.name,"_default")}setLocalItem(key.visit,LOCAL_TRUE);setLocalItem(key.computed,LOCAL_TRUE);setLocalItem(key.hash,his.cur);var result=v&&(!blacklisted||r)&&{variation:v,collect:true};return result}function testHash(name,variations,blacklisted,increment){var vnames=[];$.each(variations,function(index,variation){var o=variation.customOptions;
var ostr="";if(o)for(n in o)if(o.hasOwnProperty(n))ostr+=[n,o[n]].join("\x3d");vnames.push(variation.name+ostr)});var result=[name,vnames.sort().join(""),!!blacklisted,increment].join("");return result}function unregisterVariation(name){var key=makeKeyNames(name);removeLocalItem(key.name);removeLocalItem(key.visit);removeLocalItem(key.blacklisted);removeLocalItem(key.computed);removeLocalItem(key.hash);removeLocalItem(key.force)}function findByProp(arr,prop,value){var result;$.each(arr,function(i,
item){if(item[prop]==value){result=item;return false}});return result}function makeTrackvarName(value){if(!value)throw new Error("trackvar: invalid name");return value.toLowerCase()}function makeKeyNames(name){return{name:"ABT__"+name,visit:"ABT__"+name+"__visit",blacklisted:"ABT__"+name+"__blstd",computed:"ABT__"+name+"__cmpted",hash:"ABT__"+name+"__hash",force:"ABT__"+name+"__force"}}function randChance(){return Math.random(0,1)}function between(x,min,max){return x>=min&&x<=max}function getFeature(name){return featureData[name]}
function setFeature(data){if(!data.name)throw new Error("Feature: missing name");var feature=new Feature(data);if(!$.isEmptyObject(feature))featureData[data.name]=feature}function isBlacklisted(domainsValue){var domains=domainsValue||[];function regescape(str){return str.replace(/\./g,"\\.").replace(/\-/g,"\\-")}function check(domain){var reg=new RegExp("^(http://)?(www\\.)?"+regescape(domain),"gi");return!domain&&!document.referrer||(domain&&document.referrer.match(reg)||[]).length>0}var result;
if(!ignoreBlacklist)$.each(domains,function(index,domain){result=check(domain);return!result});return result}function notInSegment(segmentValue){var segment=segmentValue||{};var result;var count=0;var segmentName;for(segmentName in segment)if(segment.hasOwnProperty(segmentName)){result=result||(!!segment[segmentName]?!!VisitorSegment(segmentName):false);if(!!segment[segmentName])count++}return 0!==count?!result:1==Object.keys(segment).length?!VisitorSegment(segment[0]):false}function detectLocalStorage(){var str=
"_a-b-test";try{setLocalItem(str,str);removeLocalItem(str);return true}catch(e){return false}}function getLocalItem(name){return localStorage.getItem(name)}function setLocalItem(name,value){if(getLocalItem(name))removeLocalItem(name);localStorage.setItem(name,value)}function removeLocalItem(name){localStorage.removeItem(name)}function optOut(){return getLocalItem(OPT_OUT_KEY)===LOCAL_TRUE}function str2obj(handlerStr){var parts;var method=window;try{parts=handlerStr.split(".");$.each(parts,function(i,
obj){method=method[obj]})}catch(e){}return method}function bindTop($ctx,name,fn){if(!name)return;$ctx.on(name,fn);$ctx.each(function(){var handlers=$._data($ctx[0],"events")[name.split(".")[0]];var handler=handlers.pop();handlers.splice(0,0,handler)})}})(jQuery,TWP,window.wp_import,window.VisitorSegment);
(function magnetAnonymous(window,$,wp_pb,undefined){var SCROLL_INTERVAL=200;var DEFAULT_DEBOUNCE=100;var UP_OFFSET=-175;var DOWN_OFFSET=-10;var WINDOW_TOP_OFFSET=0;var SCREEN_BOTTOM_OFFSET=600;logMagnetTag();$(function(){var $w=$(window);var $d=$(document);var $r=$("html");var $h=$(".pb-f-page-header-v2");var $instance=$(".pb-f-page-magnet");$instance.each(function(){var $el=$(this);$el.insertAfter($h);init($el)});function init($container){var $modulearea=$container.find(".pb-module-area");var $isMobile=
$("html").hasClass("mobile");if($isMobile)makeTitle().insertBefore(".pb-f-page-magnet").addClass("mb-title");else{makeTitle().insertAfter(".pb-magnet-controls").addClass("desk-title");$(".desk-title").addClass("showInlineBlock")}var $ctrl={};$ctrl.$container=$container.find(".pb-magnet-controls");$ctrl.$mvleft=$ctrl.$container.find(".pb-magnet-mvleft");$ctrl.$mvright=$ctrl.$container.find(".pb-magnet-mvright");$container.data("magnetControl",$ctrl);var $title=$modulearea.find(".pb-magnet-title");
applyTitleCase($title.find(".pb-magnet-h2.magnet-title-case"));$modulearea.find('[data-pb-magnet-first\x3d"true"]').insertAfter($title);var $items=$container.find(".pb-magnet-item");var $imgs=$items.find(".pb-magnet-article-image");if($items.length==0)return;var tagname=$modulearea.data("tag");var omniParams=params($modulearea.data("omni"));tagLinks(omniParams);attachNavEvents();$modulearea.css("display","");function attachNavEvents(){applyLazyload();var edown="mousedown.magnet";if(!touchDevice()){containerScroll(function(){applyNavVisibility()});
$ctrl.$mvleft.off(edown).on(edown,function(){var value=Math.max(0,$container.scrollLeft()-computeWidth());moveScroll(value)});$ctrl.$mvright.off(edown).on(edown,function(){var value=$container.scrollLeft()+computeWidth();moveScroll(value)});registerOnce("nav","start_open",debounce(function(){down()},DEFAULT_DEBOUNCE,true))}else windowTop(function(){if(WINDOW_TOP_OFFSET>=$w.scrollTop())down()});registerOnce("nav","start_close",debounce(function(){up()},DEFAULT_DEBOUNCE,true));registerOnce("magnet",
"start_open",debounce(function(){if(tagname&&!!window.s)s.sendDataToOmniture("magnet_open","",{prop72:tagname})},DEFAULT_DEBOUNCE,true));function computeWidth(){var winwidth=$w.width();var itemwidth=$items.first().width();return Math.floor(winwidth/itemwidth)*itemwidth}}function params(value){var params=value?value.split("\x26"):[value];var result=[];if(params.length>0)$.each(params,function(index,value){var param=value.split("\x3d");result.push(param)});return result}function tagLinks(params){$modulearea.find("a").each(function(){var $a=
$(this);var url=$a.attr("href");$.each(params,function(index,param){url=updateUrlParam(url,param[0],param[1])});$a.attr("href",url)})}function registerOnce(arg1,arg2,fn){var regdata=[arg1,arg2];var regname=regdata.join(":");if(!$container.data(regname))wp_pb.register(regdata[0],regdata[1],fn);$container.data(regname,true)}function applyNavVisibility(){$ctrl.scrollleft=$container.scrollLeft();$ctrl.leftoffset=$container.scrollLeft()+$container.width();var rightbound=$modulearea[0].offsetWidth-$ctrl.leftoffset<=
0;$ctrl.$mvleft.toggle(!!$ctrl.scrollleft);$ctrl.$mvright.toggle(!rightbound)}function applyLazyload(){var sename="scroll.magnet-lazy";var reveal=0;$container.off(sename).on(sename,debounce(function(){lazy()},1,true));lazy();function lazy(){var count=Math.max(reveal,computeNumberOfImages());if(!!count&&"NaN"!==count.toString()&&reveal!==count){reveal=count;$imgs.filter(":lt("+reveal+")").each(function(){var $el=$(this);$el.attr("src",$el.data("original"))})}}function computeNumberOfImages(){return Math.ceil(($container.scrollLeft()+
$container.width())/$items.first().width())}}function nearBottom(){return $w.scrollTop()>=$d.height()-$w.height()-SCREEN_BOTTOM_OFFSET}function down(){$r.addClass("magnet");$(".mb-title").addClass("showBlock");if(!nearBottom())$r.addClass("magnet-nudge");if(touchDevice())$container.add(".mb-title").addClass("magnet-open");else $container.addClass("magnet-open").css({top:DOWN_OFFSET});wp_pb.report("magnet","start_open")}function up(){$r.removeClass("magnet magnet-nudge");$(".mb-title").removeClass("showBlock");
if(touchDevice())$container.add(".mb-title").removeClass("magnet-open");else $container.removeClass("magnet-open").css({top:UP_OFFSET});wp_pb.report("magnet","start_close")}function containerScroll(fn){var scroll;var rename="resize.magnet";$w.off(rename).on(rename,function(){scroll=true});var sename="scroll.magnet";$container.off(sename).on(sename,function(){scroll=true});var tid;setInterval(function(){if(scroll){if(tid)clearTimeout(tid);tid=setTimeout(function(){fn()},SCROLL_INTERVAL)}scroll=false},
SCROLL_INTERVAL)}function getTitleHtml(){return $("#PageMagnetTitle").html()}function makeTitle(){return $(getTitleHtml())}function windowTop(fn){var atop=false;var tid;var sename="scroll.magnet";$w.off(sename).on(sename,function(){var top=$(window).scrollTop();if(!atop&&top==0){atop=true;if(tid)clearTimeout(tid);tid=setTimeout(function(){fn()},SCROLL_INTERVAL)}else if(top>=0)atop=false})}function moveScroll(value){$container.stop().animate({scrollLeft:value},"slow")}}function touchDevice(){return $r.hasClass("touch")}
});function titleCase(strValue){var str=strValue.replace(/([^\W_]+[^\s-]*) */g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()});var lowers=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"];var i,j;for(i=0,j=lowers.length;i<j;i++)str=str.replace(new RegExp("\\s"+lowers[i]+"\\s","g"),function(txt){return txt.toLowerCase()});var uppers=["Id","Tv"];for(i=0,j=uppers.length;i<j;i++)str=str.replace(new RegExp("\\b"+
uppers[i]+"\\b","g"),uppers[i].toUpperCase());return str}function applyTitleCase($el){var title=titleCase(($el.text()||"").replace(/_/gi," "));$el.text(title)}function updateUrlParam(url,key,value){var n=new RegExp("([?\x26])"+key+"\x3d.*?(\x26|$)","i");var i=-1!==url.indexOf("?")?"\x26":"?";return url.match(n)?url.replace(n,"$1"+key+"\x3d"+value+"$2"):url+i+key+"\x3d"+value}function logMagnetTag(){var tagname;$(document).on("onTwpMeterComplete.omniture",function(){var modulearea=document.getElementsByClassName("pb-f-page-magnet")[0].getElementsByClassName("pb-module-area")[0];
tagname=modulearea&&modulearea.getAttribute("data-tag");if(tagname&&!!window.s)s.prop55=tagname})}function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}}})(window,jQuery,wp_pb);
(function($){var TWP=window.TWP||{};TWP.JWConfig={};TWP.videoDataId="video-data-id";TWP.youtube=TWP.youtube||{};TWP.youtube.youtubeVideos=TWP.youtube.youtubeVideos||{};TWP.PostTV=TWP.PostTV||{};var players=$(".posttv-player-container");var initPlayer=function(playerDom,i){var isYoutube=false,youtubeReadyFlag=false,jwReadyFlag=false;var $root=$(playerDom);var localPlayerId=$root.attr("data-moduleId");var shareUrl=$root.attr("data-shareUrl");var finalShareTitle=$root.attr("data-share-headline");var allowShare=
$root.attr("data-allowShare")==="true";var autoPlay=$root.attr("data-autoPlay")==="true";var showVideoText=$root.attr("data-showVideoText");var isMuted=$root.attr("data-startMuted")==="true";var uniquePlayerToken=$root.attr("data-uniqueToken");if(uniquePlayerToken==null||uniquePlayerToken==="")uniquePlayerToken=$root.closest(".pb-chain").attr("id");var youtubePlayerObj,ytExpectedState=false;var youtubeWrapper=$root.find(".posttv-player-youtube-wrapper");if(youtubeWrapper.length>0){isYoutube=true;
var trackingData={section:youtubeWrapper.attr("data-section")||"",subsection:youtubeWrapper.attr("data-subsection")||"",videoUuid:youtubeWrapper.attr("data-video-uuid")||"",displayDate:Number(youtubeWrapper.attr("data-display-date")),videoTitle:youtubeWrapper.attr("data-video-title")||""};var omnitureCall=function(trackingData,events,additionalTrackingVars){var getSectionAsPrefix=function(){var sectionAsPrefix=trackingData.section.toLowerCase();if(/^\/([^\/]+)/.test(sectionAsPrefix))sectionAsPrefix=
RegExp.$1.toLowerCase();sectionAsPrefix+=!!sectionAsPrefix?":":"";return sectionAsPrefix},getEstDateString=function(epoch){var localDate=new Date(epoch),estDate=new Date(epoch+localDate.getTimezoneOffset()*6E4-300*6E4),month=estDate.getMonth()+1;return month+"/"+estDate.getDate()+"/"+estDate.getFullYear()};var getTrackingData=function(){var sectionAsPrefix=getSectionAsPrefix(),uuidToken=trackingData.videoUuid.split("-")[trackingData.videoUuid.split("-").length-1],dateString=getEstDateString(trackingData.displayDate);
if(typeof params=="undefined")params={};var currentVideoTitle=sectionAsPrefix+"video - "+uuidToken+" - "+dateString+" - "+trackingData.videoTitle.toLowerCase();return{"page":currentVideoTitle,"channel":"wp - posttv","video":currentVideoTitle,"title":currentVideoTitle,"type":"video","section":!!trackingData.section?trackingData.section.toLowerCase():"","subsection":!!trackingData.subsection?trackingData.subsection.toLowerCase():"","source":"","videoName":"","adsDuration":"","videoType":"LiveStream"}};
var sendTrackingData=function(events,videoData){var data=$.extend({"eVar1":window.s.eVar1||videoData.page,"eVar2":videoData.channel,"eVar13":videoData.title,"eVar41":videoData.section,"eVar42":videoData.source,"eVar43":videoData.video,"eVar44":"","eVar45":s._referrer,"eVar46":"","eVar49":"hp-live-player"},additionalTrackingVars);events=events||[];s.sendDataToOmniture("interaction",events,data)};var sendDataToNielsen=function(videoData){var sectionAsPrefix=getSectionAsPrefix();var currentVideoTitle=
!!videoData.title?sectionAsPrefix+videoData.title.toLowerCase():"";var currentVideoCategory="";var paramCi="ci\x3dus-904793";var paramC6="\x26c6\x3dvc,b01";var paramCc="\x26cc\x3d1";var paramRnd="\x26rnd\x3d"+Math.ceil(Math.random()*1E9);var paramTl="\x26tl\x3ddav0-"+encodeURIComponent(currentVideoTitle);var paramCg="\x26cg\x3d"+encodeURIComponent(currentVideoCategory);var url="//secure-us.imrworldwide.com/cgi-bin/m?"+paramCi+paramC6+paramCc+paramRnd+paramTl+paramCg;self.imageForNielsenBeacon="";
self.imageForNielsenBeacon=new Image;self.imageForNielsenBeacon.src=url};if(window.s&&typeof s.sendDataToOmniture=="function"){sendTrackingData(events,getTrackingData());if(events.indexOf("event75")!=-1)sendDataToNielsen(trackingData)}};var doTrackingCall=function(events,additionalTrackingData){omnitureCall(trackingData,events,additionalTrackingData)};var loadYoutubePlayer=function(args){if(!!window.YT){TWP.youtube.youtubeVideos[args.vidID]=new YT.Player(args.containerID,{playerVars:{autohide:1,autoplay:0,
controls:1,fs:1,html5:1,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0,wmode:"transparent"},height:"100%",width:"100%",videoId:args.vidID,events:{"onReady":function(event){youtubeReadyFlag=true;doTrackingCall("event30");if(mobile_browser===1)isMuted=false;if((jwToPlay||autoPlay)&&mobile_browser===0){playVideo();doTrackingCall("event75");jwToPlay=true;if(!isMuted)doTrackingCall("event9")}},"onError":function(event){console.log("Youtube embed error.")},"onStateChange":function(event){if(!isMuted&&
event.data===YT.PlayerState.PLAYING){pausePageRefresh();ytExpectedState=undefined}else if(event.data===YT.PlayerState.ENDED||event.data===YT.PlayerState.PAUSED){resumePageRefresh();if(event.data===YT.PlayerState.ENDED){ytExpectedState=undefined;videoStopped();doTrackingCall("event13")}else if(ytExpectedState===1&&event.data===YT.PlayerState.PAUSED){ytExpectedState=undefined;playVideo()}else if(event.data===YT.PlayerState.PAUSED)doTrackingCall("event73")}}}});return TWP.youtube.youtubeVideos[args.vidID]}};
var initYoutubePlayer=function(){var init=function(){var container=$root.find(".posttv-player-youtube-container");youtubePlayerObj=loadYoutubePlayer({containerID:container.attr("id"),vidID:container.attr("data-videoId")})};if(typeof window.YT=="object")window.YT.ready(init);else if(typeof window.onYouTubeIframeAPIReady=="function"){var oldFunc=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=function(){oldFunc();init()}}else window.onYouTubeIframeAPIReady=function(){init()};var tag=document.createElement("script");
tag.src=location.protocol+"//www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}}var onDemandPlayerWrapperId="posttv-player-ondemand-wrapper-"+localPlayerId;var onDemandPlayerWrapper=$root.find("#"+onDemandPlayerWrapperId);var jwToPlay=autoPlay,jwPlaying=false,videoQueued=undefined,jwPlayerObj;if($root.find(".posttv-player-ondemand").length>0){var onPlayerCreated=function(){jwReadyFlag=true;if(autoPlay)jwToPlay=
true;setMute()};var onEmbedCodeChanged=function(){if(typeof videoQueued!=="undefined"){updateVideo(onDemandPlayerWrapper.attr("data-video-uuid"),videoQueued);return}if(uniquePlayerToken)wp_pb.report(uniquePlayerToken,"video_started");if(mobile_browser===1){isMuted=false;videoStopped();jwToPlay=true}else if(jwToPlay)playVideo();else if(!jwToPlay&&!jwPlaying)pauseVideo()};var onPlayCompleted=function(){jwToPlay=false;jwPlaying=false;videoStopped();resumePageRefresh();if(uniquePlayerToken)wp_pb.report(uniquePlayerToken,
"video_completed")};var onPause=function(){jwToPlay=false;jwPlaying=false;resumePageRefresh()};var onPlayheadTimeChanged=function(){if(jwToPlay&&!jwPlaying){jwPlaying=true;if(!isMuted)pausePageRefresh()}};var onAdStarted=function(){$root.addClass("ad-playing")};var onAdCompleted=function(){$root.removeClass("ad-playing")};var callbacks={onPlayerCreated:onPlayerCreated,onPlayCompleted:onPlayCompleted,onEmbedCodeChanged:onEmbedCodeChanged,onPause:onPause,onPlayheadTimeChanged:onPlayheadTimeChanged,
onAdStarted:onAdStarted,onAdCompleted:onAdCompleted};var shouldPlayAdOverride=function(shouldPlayAdSelection){try{var adOverride=posttvPlayerData[localPlayerId]["adOverride"];if(wp_meta_data.isHomepage===true&&adOverride!==undefined&&adOverride.disablePreroll===true){var currentTime=(new Date).getTime();for(var cnt=0;cnt<adOverride.dates.length;cnt++)if(adOverride.dates[cnt].start<currentTime&&currentTime<adOverride.dates[cnt].end)return false}}catch(ex){}return shouldPlayAdSelection};var initOptions=
function(){var args={callbacks:callbacks,showSharingOverlay:false,hideOverlayButtons:true,type:"html5"};if(shouldPlayAdOverride()===false)args=$.extend({shouldPlayAd:false},args);else if(posttvPlayerData[localPlayerId]["isYourThree"])args=$.extend({shouldPlayAd:true},args);return args}}var updateVideo=function(uuid,shouldPlayAd){shouldPlayAd=shouldPlayAdOverride(shouldPlayAd);if(isJwReady()){if(shouldPlayAd!==undefined)jwPlayerObj.playUuid(uuid,{shouldPlayAd:shouldPlayAd});else jwPlayerObj.playUuid(uuid);
if(jwPlaying&&!jwToPlay)jwToPlay=true;videoQueued=undefined}else videoQueued=shouldPlayAd===true};var socialEl=$root.find(".posttv-player-social");var imageOverlayEl=$root.find(".posttv-player-full-image-overlay");var muteEl=$root.find(".posttv-player-mute-overlay");var videoTextEl=$("#posttv-player-text-"+localPlayerId);var sentinel=false;var tweetClicked=function(){window.open("https://twitter.com/share?url\x3d"+encodeURIComponent(shareUrl)+"\x26text\x3d"+encodeURIComponent(finalShareTitle),"_blank",
"width\x3d550,height\x3d450")};var facebookClicked=function(){var winHeight=600,winWidth=600;window.open("http://www.facebook.com/sharer.php?s\x3d100\x26p[url]\x3d"+encodeURIComponent(shareUrl)+"\x26t\x3d"+encodeURIComponent(finalShareTitle),"_blank","top\x3d"+(screen.height/2-winHeight/2)+",left\x3d"+(screen.width/2-winWidth/2)+",toolbar\x3d0,status\x3d0,width\x3d"+winWidth+",height\x3d"+winHeight)};$root.find(".posttv-player-social-twitter").click(tweetClicked);$root.find(".posttv-player-social-facebook").click(facebookClicked);
var isYoutubeReady=function(){return youtubeReadyFlag};var isJwReady=function(){return TWP.PostTV.players&&TWP.PostTV.players["posttv-player-ondemand-wrapper-"+localPlayerId]&&jwReadyFlag};var setMute=function(){if(isMuted)if(!isYoutube&&isJwReady())TWP.PostTV.players["posttv-player-ondemand-wrapper-"+localPlayerId].player.setVolume(0);else{if(isYoutubeReady()){youtubePlayerObj.setVolume(0);youtubePlayerObj.mute()}}else if(!isYoutube&&isJwReady())TWP.PostTV.players["posttv-player-ondemand-wrapper-"+
localPlayerId].player.setVolume(100);else if(isYoutubeReady()){youtubePlayerObj.unMute();youtubePlayerObj.setVolume(100)}};var loadPlayer=function(loadOnly){loadOnly=typeof loadOnly!=="undefined"?loadOnly:false;if(!isYoutube&&jwPlayerObj===undefined){jwPlayerObj=TWP.PostTV.initPostTvPlayer(document.getElementById(onDemandPlayerWrapperId),initOptions());playerLoaded=true;if(!loadOnly)jwToPlay=true}else if(isYoutube&&youtubePlayerObj===undefined){playerLoaded=true;initYoutubePlayer();if(!loadOnly)jwToPlay=
true}else if(!loadOnly)playVideo()};var playVideo=function(){jwToPlay=true;if(!isYoutube&&isJwReady()){TWP.PostTV.players["posttv-player-ondemand-wrapper-"+localPlayerId].play();videoPlaying()}else if(isYoutubeReady()){ytExpectedState=1;youtubePlayerObj.playVideo();videoPlaying()}};var pauseVideo=function(){if(!isYoutube&&isJwReady()){if(jwPlaying)TWP.PostTV.players["posttv-player-ondemand-wrapper-"+localPlayerId].pause();jwToPlay=false;jwPlaying=false}else if(isYoutubeReady())youtubePlayerObj.pauseVideo()};
var loadAndPlayVideo=function(){loadPlayer(true);playVideo()};var videoStopped=function(){imageOverlayEl.show();muteEl.hide();$root.addClass("social-buttons-hidden");pauseVideo()};var videoPlaying=function(){imageOverlayEl.hide();if(isMuted){$root.addClass("social-buttons-hidden");muteEl.show()}else{if(allowShare)$root.removeClass("social-buttons-hidden");muteEl.hide()}setMute()};imageOverlayEl.click(function(){loadPlayer(false);pausePageRefresh()});muteEl.click(function(){isMuted=false;pausePageRefresh();
videoPlaying();if(isYoutube)doTrackingCall("event9")});$root.click(function(){var overlayTimeout=4E3;if(mobile_browser===1&&!sentinel){sentinel=true;socialEl.show();window.setTimeout(function(){socialEl.hide();sentinel=false},overlayTimeout)}});var playButtonTimeEl=$root.find(".posttv-player-play-time");var initPlayButton=function(){if(!posttvPlayerData[localPlayerId]["isLive"]){function padNum(n){return n>9?""+n:"0"+n}function readableDate(s){return parseInt(s/60)+":"+padNum(parseInt(s%60))}playButtonTimeEl.html(readableDate(posttvPlayerData[localPlayerId]["videoTime"]));
playButtonTimeEl.show()}else playButtonTimeEl.hide()};var initCredits=function(){if(videoTextEl.find(".posttv-player-credits").length>0)if(videoTextEl.find(".posttv-player-caption-editor").html().trim()=="")videoTextEl.find(".posttv-player-caption-separator").hide();else videoTextEl.find(".posttv-player-caption-separator").show()};var setSize=function(){var SMALL_BREAKPOINT=235;var setSizeHelp=function(){var width=$root.width();if(width<=SMALL_BREAKPOINT)$root.addClass("player-small");else $root.removeClass("player-small")};
setSizeHelp();$(window).on("resize",setSizeHelp)};var showRender=function(){$(".wait-until-render").show()};var playerLoaded=false;$(window).scroll(function(){if(!playerLoaded&&mobile_browser){var videoElRect=$root.get()[0].getBoundingClientRect();if(window.innerHeight+150>videoElRect.top)loadPlayer(true)}});var pausePageRefresh=function(){if(!!window.TWP&&!!TWP.hpRefreshTests)TWP.hpRefreshTests[localPlayerId]=function(){return false}};var resumePageRefresh=function(){if(!!window.TWP&&!!TWP.hpRefreshTests)delete TWP.hpRefreshTests[localPlayerId]};
var updateOnDemandPlayer=function(args){try{var src=imageOverlayEl.find("img").attr("src"),low_res=imageOverlayEl.find("img").attr("data-low-res-src"),hi_res=imageOverlayEl.find("img").attr("data-hi-res-src"),srcPrefix=src.match("(.*php\\?src\x3d)");if(srcPrefix==null){srcPrefix="https://img.washingtonpost.com/wp-apps/imrs.php?src\x3d";imageOverlayEl.find("img").attr("src",srcPrefix+encodeURIComponent(args.image)+"\x26w\x3d480\x26h\x3d270")}else{srcPrefix=srcPrefix[0];imageOverlayEl.find("img").attr("src",
srcPrefix+encodeURIComponent(args.image)+src.match("\\\x26w\x3d.*")[0])}if(low_res!=null)imageOverlayEl.find("img").attr("data-low-res-src",srcPrefix+encodeURIComponent(args.image)+low_res.match("\\\x26w\x3d.*")[0]);if(hi_res!=null)imageOverlayEl.find("img").attr("data-hi-res-src",srcPrefix+encodeURIComponent(args.image)+hi_res.match("\\\x26w\x3d.*")[0])}catch(ex){console.error("PostTV Player promo image couldn't be updated.")}onDemandPlayerWrapper.attr("data-video-uuid",args.uuid);videoTextEl.find(".posttv-player-headline").html(args.title);
videoTextEl.find(".posttv-player-headline").prop("href",args.url);videoTextEl.find(".posttv-player-blurb").html(args.blurb);videoTextEl.find(".posttv-player-caption-editor").html(args.editor);videoTextEl.find(".posttv-player-caption-source").html(args.source);try{wp_pb.StaticMethods.remarryHeadline(videoTextEl.find(".headline"))}catch(e){videoTextEl.find(".headline").css("width","auto")}shareUrl=args.url;finalShareTitle=args.title;posttvPlayerData[localPlayerId]["videoTime"]=args.duration;posttvPlayerData[localPlayerId]["isLive"]=
String(args.isLive)=="true";initPlayButton();initCredits();if(isJwReady()){if(args.startPlaying||imageOverlayEl.css("display")=="none")jwToPlay=true;updateVideo(args.uuid,args.shouldPlayAd)}else if(!isJwReady()&&args.startPlaying)loadPlayer(false);if(args.startPlaying&&args.scrollToPlayer){var topOffsetAdjustment=30,bottomOffsetAdjustment=30,$navBarEl=$("#nav-bar"),$liveMainEl=$(".pb-f-posttv-live-main"),$breakingNewsEl=$(".pb-f-page-breaking-news-bar"),$shareBarEl=$(".top-sharebar-wrapper",".pb-f-sharebars-top-share-bar");
if($navBarEl.length>0)topOffsetAdjustment+=$navBarEl.height();if($liveMainEl.length>0)topOffsetAdjustment+=$liveMainEl.height();if($breakingNewsEl.length>0)topOffsetAdjustment+=$breakingNewsEl.height();if($shareBarEl.length>0)topOffsetAdjustment+=$shareBarEl.height();var documentScrollTop=document.documentElement.scrollTop||document.body.scrollTop,playerTopPosition=$root.offset().top-topOffsetAdjustment;if(documentScrollTop>playerTopPosition)$("html, body").animate({scrollTop:playerTopPosition+"px"})}};
$(function(){if(uniquePlayerToken){wp_pb.register(uniquePlayerToken,"new_video_selected",updateOnDemandPlayer,this);wp_pb.register(uniquePlayerToken,"play_video",loadAndPlayVideo,this);wp_pb.register(uniquePlayerToken,"stop_video",videoStopped,this)}});var init=function(){setSize();initPlayButton();initCredits();if(autoPlay)videoPlaying();else videoStopped();if(showVideoText==="true")videoTextEl.css("display","block");if(autoPlay===true||i==0&&mobile_browser===1)loadPlayer(true);showRender()};init()};
for(var i=0;i<players.length;i++)initPlayer(players[i],i);$(window).trigger("scroll")})(jQuery);