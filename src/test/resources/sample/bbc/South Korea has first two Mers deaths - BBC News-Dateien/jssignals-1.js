/*!
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license <http://www.opensource.org/licenses/mit-license.php>
 * @author Miller Medeiros <http://millermedeiros.com/>
 * @version 0.6.3
 * @build 187 (07/11/2011 10:14 AM)
 */
define(function(){var B={VERSION:"0.6.3"};function C(H,G,E,F,D){this._listener=G;this._isOnce=E;this.context=F;this._signal=H;this._priority=D||0}C.prototype={active:true,params:null,execute:function(D){var F,E;if(this.active&&!!this._listener){E=this.params?this.params.concat(D):D;F=this._listener.apply(this.context,E);if(this._isOnce){this.detach()}}return F},detach:function(){return this.isBound()?this._signal.remove(this._listener):null},isBound:function(){return(!!this._signal&&!!this._listener)},getListener:function(){return this._listener},_destroy:function(){delete this._signal;delete this._listener;delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isBound: "+this.isBound()+", active: "+this.active+"]"}};function A(D,E){if(typeof D!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",E))}}B.Signal=function(){this._bindings=[]};B.Signal.prototype={_shouldPropagate:true,active:true,_registerListener:function(H,G,F,E){var D=this._indexOfListener(H),I;if(D!==-1){I=this._bindings[D];if(I.isOnce()!==G){throw new Error("You cannot add"+(G?"":"Once")+"() then add"+(!G?"":"Once")+"() the same listener without removing the relationship first.")}}else{I=new C(this,H,G,F,E);this._addBinding(I)}return I},_addBinding:function(D){var E=this._bindings.length;do{--E}while(this._bindings[E]&&D._priority<=this._bindings[E]._priority);this._bindings.splice(E+1,0,D)},_indexOfListener:function(D){var E=this._bindings.length;while(E--){if(this._bindings[E]._listener===D){return E}}return -1},add:function(F,E,D){A(F,"add");return this._registerListener(F,false,E,D)},addOnce:function(F,E,D){A(F,"addOnce");return this._registerListener(F,true,E,D)},remove:function(E){A(E,"remove");var D=this._indexOfListener(E);if(D!==-1){this._bindings[D]._destroy();this._bindings.splice(D,1)}return E},removeAll:function(){var D=this._bindings.length;while(D--){this._bindings[D]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(E){if(!this.active){return }var D=Array.prototype.slice.call(arguments),G=this._bindings.slice(),F=this._bindings.length;this._shouldPropagate=true;do{F--}while(G[F]&&this._shouldPropagate&&G[F].execute(D)!==false)},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal active: "+this.active+" numListeners: "+this.getNumListeners()+"]"}};return B});