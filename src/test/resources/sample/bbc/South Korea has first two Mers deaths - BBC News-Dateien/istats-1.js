define("istats-1",[],function(){var Y={version:"2.0.0"},b=Y,d=[],r={},h,i="",g=false,Z="sa_labels",F="istats-notrack",ae="_istats_"+Math.random(),G={internal:true,external:true,download:true,clickthrough:true,promoimage:true},e={type:"",url:""},N=[],T=2000,L=10000,ad=500,y=null,f={ignore:/.+\.(jpe?g|gif|png)$/i,webUrl:/^(\.\.?\/|\/|https?:\/\/|[^\/.:]+([\/.]|$))/i,pseudoProtocol:/^(mailto:|javascript:|about:|view-source:|data:)/i,internalUrl:/^(?:\/\/|https?:\/\/)?(?:[^.]+\.)*((bbc|bbci)(?:\.co\.uk|\.com)|doubleclick\.net)(:|\/|$)/i,storeUrl:/^https?:\/\/.*store\.bbc\.(co\.uk|com).*$/i,downloadUrl:/.+\.(pdf|te?xt|rtf|docx?|xlsx?|pptx?|od[tpsgbf]|mp[234]|m4a|mpeg|exe|dmg|zip|tgz)$/i,relativeUrl:/^(\.\.?\/|\/[^\/]|([^\/.:]+([\/.]|$)))/i,clickThrough:/^#sa-(.*?)(?:-sa(.*))?$/,hashLabels:/^ct_|ns_(fee|campaign|linkname|mchannel|source)=(.+?)$/,domain:/(bbc(?:\.co\.uk|\.com))(:\d+)?$/i},I={},Q={types:{"trackingfail.istats":true,"trackingsuccess.istats":true,"redirect.istats":true,"cookiecreated.istats":true}},k={},B=[],P=[],K=function(){var ag={};for(var ah in Q.types){ag[ah]=[]}return ag},aa=O(Z);w(window);aa=(aa||(s())._trackingCookie);z(Z);function w(ag){(typeof ag.istats==="undefined")&&(ag.istats={});(typeof ag.istats.enabled==="undefined")&&(ag.istats.enabled=true);return ag}function s(ag){return ag?w(ag).istats:window.istats}Y.getConfig=s;function E(){return g}Y.isReady=E;function q(){if(typeof aa==="string"){e.type="internal";return af(decodeURIComponent(aa))}}function R(ag){ag=ag.replace(/\+/g,"%20");return decodeURIComponent(ag)}function af(ag){var ai={};var ak=ag.split("&");for(var ah=0;ah<ak.length;ah++){var aj=ak[ah].split("=");ai[aj[0]]=aj[1]}return ai}Y._getLabelsFromString=af;function v(ai){if(history.replaceState){var ag=location.protocol+"//"+location.host+(location.pathname?location.pathname:"");try{history.replaceState({},"",ag+ai)}catch(ah){if(window.console&&console.log){console.log(ah)}}}else{location.hash=ai}}function a(ag){ag||(ag=location.hash);if(ag!==""){var ak=ag.match(f.clickThrough),ai,aj="",al=[];if(ak===null){return}if(ak[2]){aj="#"+ak[2]}v(aj);ai=ak[1];if(ai===""){return}e.type="click through";al=ai.split("&");for(var ah in al){if(al.hasOwnProperty(ah)&&!f.hashLabels.test(al[ah])){al[ah]="ct_"+al[ah]}}return al}}function J(){var ah=true,ai=true,ag=(s()).enabled;if(window.bbcFlagpoles_istats){ai=!(window.bbcFlagpoles_istats==="ON")}if(ai||!ag){ah=false}return ah}Y.isEnabled=J;Y.setCountername=function(ag){h=ag};Y.getCountername=function(){if(!h){h=ab()}if(!h.match(/\.page$/)){h+=".page"}return h};function ab(){var ag=window.location.pathname.replace(/\/$/,"").replace(/^\//,"").replace(/\//g,".");return ag+".page"}function V(ag){if(typeof(ag)!=="string"){throw (Error("'site' must be a string"))}ag=ag.toLowerCase().replace(/_/g,"-");return ag}Y._normaliseLabelValue=V;Y.setSite=function(ag){i=V(ag)};Y.getSite=function(){if(!i){if(typeof(r.bbc_site)==="string"){b.setSite(r.bbc_site)}}return i};Y.getDefaultURL=function(){try{var ag=b.getCollector("default")}catch(ah){return""}return ag.url+"?"+X(o({}),"&")};function U(ah,ag){if(!ah.className){return false}return(" "+ah.className+" ").indexOf(" "+ag+" ")===-1?false:true}function D(ai,ah){var ag=(ai.className)?ai.className+" ":"";if(!U(ai,ah)){ai.className=ag+ah}}function t(aj,ah){var ag=aj.className.split(" "),ak=[],ai=ag.length;while(ai--){if(ag[ai]!==ah){ak.unshift(ag[ai])}}aj.className=(ak.length)?ak.join(" "):""}Y.track=function(ag,aj){if(!J()){return}if(!G[ag]){throw ('Given linkType, "'+ag+'" is not valid.')}aj=aj||{};if(!aj.region){aj.region=[document.body]}if(typeof aj.region.push==="undefined"){aj.region=[aj.region]}var ai=aj.region.length;while(ai--){var ak=aj.region[ai];l(ak,ag);var ah=ak[ae];ah.linkTypesTracked[ag]=(aj||{});if(!ah.trackerAttached){(function(al){I.attach(al,"click",function(am){k.dispatch(al,am)})})(ak);ah.trackerAttached=true}}};Y.observe=function(ag,ai,aj){if(!Q.types[ai]){throw ('Cannot observe: Given eventType, "'+ai+'" in unknown.')}if(typeof ag.push==="undefined"){ag=[ag]}var ah=ag.length;while(ah--){l(ag[ah]);P[ag[ah][ae].eventsKey][ai].push(aj)}};Y._isInternal=function(ag){return Y._isWebUrl(ag)&&(f.relativeUrl.test(ag)||f.internalUrl.test(ag))&&(!f.storeUrl.test(ag))};Y._isExternal=function(ag){return Y._isWebUrl(ag)&&!b._isInternal(ag)};Y._isDownload=function(ag){return f.webUrl.test(ag)&&f.downloadUrl.test(ag)};Y._isWebUrl=function(ag){return f.webUrl.test(ag)&&!f.ignore.test(ag)&&!f.pseudoProtocol.test(ag)};Y._getDomainFromHost=H;function H(ag){var ah=ag.match(f.domain);return ah?ah[1]:ag}Y._getLabelsFromHashString=a;Y._createCookie=W;Y._inspectTracking=function(ag){if(typeof ag!=="undefined"){e=ag}return e};Y.log=function(ah,ag,ai,aj){ai=ai||{};if(!J()){return}if(ah.toLowerCase()!=="pageview"){ai.ns_type="hidden";ai.action_name=ag;ai.action_type=ah}e.type="logging actions";A(ai,aj)};Y.addNoTrack=function(ag){D(ag,F)};Y.removeNoTrack=function(ag){t(ag,F)};function X(aj,ai){ai=ai||"&";var ah=[];if(aj.hasOwnProperty("name")){ah.push(encodeURIComponent("name")+"="+encodeURIComponent(aj.name))}for(var ag in aj){if(aj.hasOwnProperty(ag)&&typeof(aj[ag])!="object"){if(ag==="linkLocation"){ah.push(encodeURIComponent("link_location")+"="+encodeURIComponent(aj[ag]))}else{if(ag!=="name"&&ag!=="ns_referrer"){ah.push(encodeURIComponent(ag)+"="+encodeURIComponent(aj[ag]))}}}}if(aj.hasOwnProperty("ns_referrer")){ah.push(encodeURIComponent("ns_referrer")+"="+encodeURIComponent(aj.ns_referrer))}return ah.join(ai)}Y.addLabels=function(ag){if(typeof(ag)=="string"){ag=af(R(ag))}p(r,ag)};Y._getLabels=function(){return r};function p(ai,ah){for(var ag in ah){ai[ag]=ah[ag]}return ai}Q.notify=function(ak,ai,al){var ag=P[ak[ae].eventsKey][ai];for(var ah=0,aj=ag.length;ah<aj;ah++){if(typeof ag[ah]==="function"){if(ag[ah](al)===false){return false}}}};I.attach=function(ag,ai,ah){if(ag.addEventListener){ag.addEventListener(ai,ah,false)}else{if(ag.attachEvent){ag.attachEvent("on"+ai,ah)}else{ag["on"+ai]=ah}}};I.detach=function(ag,ai,ah){if(ag.removeEventListener){ag.removeEventListener(ai,ah,false)}else{if(ag.detachEvent){ag.detachEvent("on"+ai,ah)}else{ag["on"+ai]=null}}};I.getTarget=function(ag){ag=ag||window.event;return ag.target||ag.srcElement};function m(ah,ag){var ai=ah;do{if(ai.nodeName=="A"){return ai}if(ai===ag){return false}}while(ai=ai.parentNode)}function ac(ag){if(!b._isWebUrl(ag)){return}if(b._isExternal(ag)){return"external"}else{if(b._isDownload(ag)){return"download"}else{if(b._isInternal(ag)){return"internal"}}}}function u(ak,ah,aj,ag,ai){ak.istats=ak.istats||{};ak.istats.linkType=ah,ak.istats.linkTrackerUrl=aj,ak.istats.linkLocation=ag,ak.istats.linkElement=ai}k.dispatch=function(an,am){var ah=m(I.getTarget(am),this),ag,ai,ak,aj,al;if(!ah||!ah.href){return}aj=new Date().getTime();al=(ah.istatsTimestamp&&(aj-ah.istatsTimestamp)<ad);if(al||U(ah,F)){return}ag=ac(ah.href);ai=k[ag];ak=an[ae].linkTypesTracked[ag];if(!ag||!ai||!ak){return}ah.istatsTimestamp=aj;am.istats=am.istats||{};k[ag](an,ah,am)};k.external=function(aj,ah,ai){var ag=aj[ae].linkTypesTracked.external||{};ag.extlink_url=ah.href;ag.ns_type="hidden";ag.action_type="extlink";ag.ns_referrer=C();if(ah.id){ag.extlink_id=ah.id}p(ag,M(ah));if(!ag.linkLocation){ag.linkLocation=""}e.type="external";u(ai,"external",X(ag),ag.linkLocation,ah);x(ag,aj,ah,ai)};k.download=function(aj,ah,ai){var ag=aj[ae].linkTypesTracked.download||{};ag.download_url=ah.href;ag.ns_type="hidden";ag.action_type="download";ag.ns_referrer=C();if(ah.id){ag.download_id=ah.id}p(ag,M(ah));if(!ag.linkLocation){ag.linkLocation=""}e.type="download";u(ai,"download",X(ag),ag.linkLocation,ah);x(ag,aj,ah,ai)};k.internal=function(aj,ah,ai){var ag=aj[ae].linkTypesTracked.internal||{};ag.intlink_from_url=location.href;ag.intlink_ts=new Date().getTime();if(ah.id){ag.intlink_id=ah.id}p(ag,M(ah));if(!ag.linkLocation){ag.linkLocation=""}aa=X(ag);W(Z,aa,L);Q.notify(aj,"cookiecreated.istats",ai)};function M(ah){var ag={};while(ah){if(ah.linktrack){if(typeof(ah.linktrack)==="string"){ag=af(R(ah.linktrack))}if(typeof(ah.linktrack)==="object"){ag=ah.linktrack}break}ah=ah.parentNode}return ag}function x(am,al,ah,ai){var ag=ai.altKey||ai.ctrlKey||ai.metaKey||ai.shiftKey,ak=function(){};var aj=ag||(ah.target&&!ah.target.match(/^_(self|parent|top)$/i));if(!aj){ak=function(){if(Q.notify(al,"redirect.istats",ai)!==false){window.location.href=ah.href}}}clearTimeout(y);y=setTimeout(function(){Q.notify(al,"trackingfail.istats",ai);ak()},T);A(am,function(){clearTimeout(y);if(Q.notify(al,"trackingsuccess.istats",ai)!==false){ak()}},ai);if(!aj){if(ai.preventDefault){ai.preventDefault()}else{event.returnValue=false}}}function l(ag){if(typeof ag[ae]!=="undefined"){return}ag[ae]={eventsKey:P.length,linkTypesTracked:{}};P.push(K())}function W(ag,am,ai){var aj=new Date(),al=365*24*60*60*1000,ao=window.location.host,ak,an,ah;if(typeof ai==="undefined"){ai=al}aj.setTime(aj.getTime()+ai);an="; expires="+aj.toGMTString();ak=H(ao);ah=ag+"="+am+an+"; domain="+ak+"; path=/";document.cookie=ah;return ah}function O(ai){var al=ai+"=",ak=document.cookie.split(";"),ah;for(var aj=0,ag=ak.length;aj<ag;aj++){ah=ak[aj];while(ah.charAt(0)===" "){ah=ah.substring(1,ah.length)}if(ah.indexOf(al)===0){return decodeURIComponent(ah.substring(al.length,ah.length))}}return null}function z(ag){if(O(ag)!==null){W(ag,"",-1)}}Y.addCollector=function(ag){if(typeof(ag)!=="object"){throw new Error("Only an object can be passed in as a collector")}if(!ag.name){throw new Error("Collector must have a name")}if(!ag.url){throw new Error("Collector must have a url")}if(ag.seperator){ag.separator=ag.seperator;delete ag.seperator}d.push(ag);return true};Y.getCollector=function(ag){for(var ah=0;ah<d.length;ah++){if(d[ah].name===ag){return d[ah]}}throw Error("Unable to find "+ag+" in collectors")};function o(ah){if(typeof(ah)==="undefined"){ah={}}for(var ag in r){if(typeof(ah[ag])==="undefined"){ah[ag]=r[ag]}}ah.bbc_site=b.getSite();ah.name=b.getCountername();ah.ns_ti=document.title;ah.ns_c=(document.characterSet?document.characterSet:document.defaultCharset);ah.ns__t=(new Date().getTime());ah.ns_jspageurl=location&&location.href?location.href:document.URL;ah.ns_referrer=C();return ah}function C(){return encodeURI(((window.orb.referrer)?window.orb.referrer:document.referrer))}function A(ak,am,al,ag){if(!J()){return}if(!g){if(!ag){B.push({labels:ak,callback:am,event:al})}return}if(d.length==0){throw Error("No data collectors available")}ak=o(ak);N.push(ak);var aj=0;for(var ai=0;ai<d.length;ai++){collector=d[ai];separator=collector.separator||"&";var ah=new Image();ah.src=collector.url+"?"+X(ak,separator);if(typeof am==="function"){ah.onload=function(){aj++;if(aj==d.length){am()}}}}}Y._sendData=A;Y.labelsSent=function(){return N};function c(ag){return ag.split("?")[0].split("#")[0]}function j(ah){if(!ah.intlink_from_url){return false}var ag=C();if(!ag||c(ah.intlink_from_url)===c(ag)){return true}else{b.log("error","istats-internal-link-tracking",ah);return false}}function S(){if(g){return}var ai;if(!J()){return}ai=q()||a();g=true;var ah=p({},r);if(ai){if(j(ai)){ah=p(ah,ai)}(s())._linkTracked=true}b.log("pageview",b.getCountername(),ah);if(B.length>0){for(var ag in B){A(B[ag]["labels"],B[ag]["callback"],B[ag]["event"],true)}}}Y.invoke=S;function n(){if(typeof(istatsTrackingUrl)==="string"&&!E()){var aj=document.createElement("a");aj.href=istatsTrackingUrl;var ag="//"+aj.hostname+aj.pathname;b.addCollector({name:"default",url:ag,separator:"&"});var ah=aj.search.replace(/&amp;/g,"&").replace(/^\?/,"");var ai=af(R(ah));b.setCountername((window.istats_countername)?window.istats_countername:ai.name);b.addLabels(ai);b.invoke()}}setTimeout(n,300);return Y});