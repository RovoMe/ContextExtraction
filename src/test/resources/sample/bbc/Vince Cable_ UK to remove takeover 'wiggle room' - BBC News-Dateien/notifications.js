//Build 18 at Thu Dec 17 2015 15:05:29 GMT+0000 (UTC) for live
!function(t,e,i){function n(t,e){return typeof t===e}function o(){var t,e,i,o,a,s,r;for(var c in b)if(b.hasOwnProperty(c)){if(t=[],e=b[c],e.name&&(t.push(e.name.toLowerCase()),e.options&&e.options.aliases&&e.options.aliases.length))for(i=0;i<e.options.aliases.length;i++)t.push(e.options.aliases[i].toLowerCase());for(o=n(e.fn,"function")?e.fn():e.fn,a=0;a<t.length;a++)s=t[a],r=s.split("."),1===r.length?w[r[0]]=o:(!w[r[0]]||w[r[0]]instanceof Boolean||(w[r[0]]=new Boolean(w[r[0]])),w[r[0]][r[1]]=o),_.push((o?"":"no-")+r.join("-"))}}function a(t){var e=k.className,i=w._config.classPrefix||"";if(E&&(e=e.baseVal),w._config.enableJSClass){var n=new RegExp("(^|\\s)"+i+"no-js(\\s|$)");e=e.replace(n,"$1"+i+"js$2")}w._config.enableClasses&&(e+=" "+i+t.join(" "+i),E?k.className.baseVal=e:k.className=e)}function s(){return"function"!=typeof e.createElement?e.createElement(arguments[0]):E?e.createElementNS.call(e,"http://www.w3.org/2000/svg",arguments[0]):e.createElement.apply(e,arguments)}function r(){var t=e.body;return t||(t=s(E?"svg":"body"),t.fake=!0),t}function c(t,i,n,o){var a,c,l,d,f="modernizr",u=s("div"),p=r();if(parseInt(n,10))for(;n--;)l=s("div"),l.id=o?o[n]:f+(n+1),u.appendChild(l);return a=s("style"),a.type="text/css",a.id="s"+f,(p.fake?p:u).appendChild(a),p.appendChild(u),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),u.id=f,p.fake&&(p.style.background="",p.style.overflow="hidden",d=k.style.overflow,k.style.overflow="hidden",k.appendChild(p)),c=i(u,t),p.fake?(p.parentNode.removeChild(p),k.style.overflow=d,k.offsetHeight):u.parentNode.removeChild(u),!!c}function l(t,e){return!!~(""+t).indexOf(e)}function d(t){return t.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-")}function f(e,n){var o=e.length;if("CSS"in t&&"supports"in t.CSS){for(;o--;)if(t.CSS.supports(d(e[o]),n))return!0;return!1}if("CSSSupportsRule"in t){for(var a=[];o--;)a.push("("+d(e[o])+":"+n+")");return a=a.join(" or "),c("@supports ("+a+") { #modernizr { position: absolute; } }",function(t){return"absolute"==getComputedStyle(t,null).position})}return i}function u(t){return t.replace(/([a-z])-([a-z])/g,function(t,e,i){return e+i.toUpperCase()}).replace(/^-/,"")}function p(t,e,o,a){function r(){d&&(delete A.style,delete A.modElem)}if(a=n(a,"undefined")?!1:a,!n(o,"undefined")){var c=f(t,o);if(!n(c,"undefined"))return c}for(var d,p,h,m,g,v=["modernizr","tspan"];!A.style;)d=!0,A.modElem=s(v.shift()),A.style=A.modElem.style;for(h=t.length,p=0;h>p;p++)if(m=t[p],g=A.style[m],l(m,"-")&&(m=u(m)),A.style[m]!==i){if(a||n(o,"undefined"))return r(),"pfx"==e?m:!0;try{A.style[m]=o}catch(b){}if(A.style[m]!=g)return r(),"pfx"==e?m:!0}return r(),!1}function h(t,e){return function(){return t.apply(e,arguments)}}function m(t,e,i){var o;for(var a in t)if(t[a]in e)return i===!1?t[a]:(o=e[t[a]],n(o,"function")?h(o,i||e):o);return!1}function g(t,e,i,o,a){var s=t.charAt(0).toUpperCase()+t.slice(1),r=(t+" "+T.join(s+" ")+s).split(" ");return n(e,"string")||n(e,"undefined")?p(r,e,o,a):(r=(t+" "+j.join(s+" ")+s).split(" "),m(r,e,i))}function v(t,e,n){return g(t,i,i,e,n)}var b=[],y={_version:"3.2.0",_config:{classPrefix:"n-",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(t,e){var i=this;setTimeout(function(){e(i[t])},0)},addTest:function(t,e,i){b.push({name:t,fn:e,options:i})},addAsyncTest:function(t){b.push({name:null,fn:t})}},w=function(){};w.prototype=y,w=new w;var _=[],k=e.documentElement,E="svg"===k.nodeName.toLowerCase();w.addTest("localstorage",function(){var t="modernizr";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(e){return!1}}),w.addTest("svg",!!e.createElementNS&&!!e.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);var x=y._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):[];y._prefixes=x;var C=y.testStyles=c;w.addTest("touchevents",function(){var i;if("ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch)i=!0;else{var n=["@media (",x.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");C(n,function(t){i=9===t.offsetTop})}return i});var S="Moz O ms Webkit",T=y._config.usePrefixes?S.split(" "):[];y._cssomPrefixes=T;var I={elem:s("modernizr")};w._q.push(function(){delete I.elem});var A={style:I.elem.style};w._q.unshift(function(){delete A.style});var j=y._config.usePrefixes?S.toLowerCase().split(" "):[];y._domPrefixes=j,y.testAllProps=g,y.testAllProps=v,w.addTest("cssanimations",v("animationName","a",!0)),w.addTest("texttrackapi","function"==typeof s("video").addTextTrack),w.addTest("track","kind"in s("track")),o(),a(_),delete y.addTest,delete y.addAsyncTest;for(var N=0;N<w._q.length;N++)w._q[N]();t.NotificationsModernizr=w}(window,document),define("mybbc/notifications/vendor/modernizr-custom",function(){}),define("mybbc/templates/signed-in",[],function(){return'<section class="notification-error__container"></section><section class="notification-settings__container notification-settings__container--js"></section><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title">Notifications<sup class="notification-title__beta">beta</sup></h2><ul class="notification-header-icons"><li><a class="notifications__settings--js" href="#"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul><a href="#" class="notifications-pop-up"></a></header><div id="notifications-wrapper"><div class="notification-panel" style="display: block;"><notifications><div class="spinner"><img class="loader-icon notifications-image" src="{{baseAssetUrl}}img/loader/32px/34px_Icon32px_Lively_Dark.gif" alt="Settings"></div></notifications></div></div></div>'}),define("mybbc/templates/signed-out",[],function(){return'<div id="notifications-main" class="notifications-main--css notifications-main--js notification-signed-out"><div class="notifications-no-scroll"><div class="notifications-fake"><div class="notifications-top-header"><p class="notifications-main-header notifications-trafalgar">Never miss your favourites</p><p class="notifications-description notifications-pica">Get timely notifications about your programmes, music,&nbsp;<span>radio and much more.</span></p></div><div class="notifications-cta notifications-cta--upsell"><div class="notification-sign-in"><a href="{{idConfig.urls.signin}}?ptrt={{ptrt}}" tabindex="3" class="notifications-sign-in__link--js notifications-pica"><span>Sign in</span></a></div><p class="notifications-pica">or <a href="{{idConfig.urls.register}}?ptrt={{ptrt}}" class="notifications-register__link--js notifications-upsell-register notifications-pica-bold">Register</a></p></div></div><div class="notifications-wide-spread"><div class="notifications-limitation-container"><div class="notifications-top-header"><p class="notifications-main-header notifications-trafalgar" tabindex="1">Never miss your favourites</p><p class="notifications-description notifications-pica" tabindex="2">Get timely notifications about your programmes, music,&nbsp;<span>radio and much more.</span></p></div><div class="notifications-cta notifications-cta--upsell"><div class="notification-sign-in"><a href="{{idConfig.urls.signin}}?ptrt={{ptrt}}" tabindex="3" class="notifications-sign-in__link--js notifications-pica"><span>Sign in</span></a></div><p class="notifications-pica">or&nbsp; <a href="{{idConfig.urls.register}}?ptrt={{ptrt}}" tabindex="4" class="notifications-register__link--js notifications-upsell-register notifications-pica-bold">Register</a></p></div></div></div></div></div>'}),define("mybbc/templates/on-boarding",[],function(){return'<section class="notification-error__container"></section><div id="notifications-main" class="notifications-main--css notifications-main--js notifications-on-boarding--js notifications-on-boarding notifications-no-scroll"><div class="notifications-carousel notifications-onboarding-parent-carousel--js hidden" id="notifications-onboarding-parent-carousel"><div class="notifications-carousel__wrap"><div class="notifications-carousel__slide"><div class="on-boarding"><div aria-label="Close" class="on-boarding-close">&nbsp;</div><div class="notifications-fake"><div class="notifications--desktop"><div class="onboarding-image enter-animation"></div><div class="notifications-top-header"><p class="notifications-main-header notifications-10/12 notifications-canon" role="heading">Never miss<br>your favourites</p><p class="notifications-description notifications-10/12 notifications-pica">This is the place to get notifications about your programmes, music, radio and much more.</p><p class="notifications-description notifications-10/12 notifications-pica">If you have favourites, we&#39;ll keep you updated on those, and anything new you add. Manage your notifications at any time in settings.</p></div><div class="notifications-cta notifications-10/12"><div class="notification-sign-in"><a href="javascript:void(0)" role="link" class="notifications-sign-in__link--js notifications-pica"><span>OK, get me started</span></a></div></div></div></div><div class="notifications-wide-spread"><div class="notifications--desktop"><div class="onboarding-image enter-animation"></div><div class="notifications-wide-spread--absolute"><div class="notifications-top-header"><p class="notifications-main-header notifications-main-header__first--js notifications-10/12 notifications-canon enter-animation" role="heading" tabindex="0">Never miss<br>your favourites</p><div class="notifications-description__first--js" tabindex="0"><p class="notifications-description notifications-10/12 notifications-pica enter-animation">This is the place to get notifications about your programmes, music, radio and much more.</p><p class="notifications-description notifications-10/12 notifications-pica enter-animation">If you have favourites, we&#39;ll keep you updated on those, and anything new you add. Manage your notifications at any time in settings.</p></div></div><div class="notifications-cta notifications-10/12 enter-animation"><div class="notification-sign-in notifications-start-onboarding__link--js" id="start-onboarding"><a href="javascript:void(0)" role="link" aria-label="OK, get me started" alt="OK, get me started" title="OK, get me started" class="notifications-pica"><span>OK, get me started</span></a></div></div></div></div></div></div></div><div class="notifications-carousel__slide"><div class="notifications-carousel notifications-onboarding-carousel notifications-onboarding-carousel--js hidden" id="notifications-onboarding-carousel"><div class="notifications-carousel__wrap"><div class="notifications-carousel__slide notifications-carousel__slide--slide-0"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" role="heading" class="notifications__header notifications__header--js"><h2 class="notification-title notifications__title--js-1" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a role="link" class="notifications__settings--js" href="javascript:void(0)"><img role="img" class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings" aria-label="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation first-time" tabindex="0"><a role="link" aria-label="Notification title" tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-unread"></span></div><div class="notification-text notifications-11/12"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev inactive" data-slide="prev" tabindex="-1"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" role="link" class="notifications-carousel__controls--skip__link--js" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-1"><div class="notifications-favourites__container"><div class="notifications-favourites--preview"></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-2"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title notifications__title--js-3" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a role="link" class="notifications__settings--js" href="javascript:void(0)"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-music-icon"></div><span class="notification-dot notification-new"></span></div><div class="notification-text notifications-11/12 notification-new"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">Here&#39;s a new notification about an available music clip from one of your followed artists.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">Music</span> <span class="notification-time notifications-brevier">Just Now</span></div></div></div></a></li><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-read"></span></div><div class="notification-text notifications-11/12 notification-read"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">Simply click on an episode to start watching.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-3"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title enter-animation notifications__title--js-4" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a class="notifications__settings--js" href="javascript:void(0)"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div class="notifications-arrow-pointer enter-animation"></div><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-music-icon"></div><span class="notification-dot notification-new"></span></div><div class="notification-text notifications-11/12 notification-new"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">Here&#39;s a new notification about an available music clip from one of your followed artists.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">Music</span> <span class="notification-time notifications-brevier">Just Now</span></div></div></div></a></li><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-read"></span></div><div class="notification-text notifications-11/12 notification-read"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">Simply click on an episode to start watching.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div></div></div></div><div class="notifications-carousel__slide"><div class="on-boarding on-boarding--js on-boarding-last-slide hidden"><div aria-label="Close" class="on-boarding-close">&nbsp;</div><div class="notifications-fake"><div class="onboarding-image"></div><div class="notifications-top-header"><p class="notifications-main-header notifications-10/12" tabindex="0">Are you ready for notifications?</p></div><div class="notifications-cta"><div class="notification-sign-in"><a href="javascript:void(0)" role="link" class="notifications-sign-in__link--js notifications-pica"><span>Yes, I&#39;m in</span></a></div></div></div><div class="notifications-wide-spread"><div class="notifications-limitation-container"><div class="onboarding-image enter-animation"></div><div class="notifications-wide-spread--absolute"><div class="notifications-top-header"><p class="notifications-main-header notifications-main-header__are-you-ready--js notifications-10/12 enter-animation" tabindex="0">Are you ready for notifications?</p></div><div class="notifications-cta enter-animation first-time"><div class="notification-sign-in notifications-opt-in__link--js"><a href="javascript:void(0)" role="link" class="notifications-pica"><span>Yes, I&#39;m in</span></a></div><p class="notifications-pica"></p></div></div></div></div></div></div></div></div></div>'}),define("mybbc/templates/error",[],function(){return'<div class="notifications-error" id="hub-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, Something has gone wrong</p></div><p class="notifications-pica notifications-error__body">There’s been an error and your notifications<br>can’t be displayed at the moment. Please try again later.</p></div><div class="notifications-error--inner" id="hub-error-inner"><p class="notifications-error--inner__body notifications-10/12">Sorry. Something has gone wrong.<br>Your notifications could not be updated. Please try again later.</p><div aria-label="Close notification error message" class="notifications-error--inner__close" aria-action="close">&nbsp;</div></div><div class="notifications-error" id="settings-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, Something has gone wrong</p></div><p class="notifications-pica notifications-error__body">There’s been an error and your notifications settings<br>cannot be retrieved. Please try again later.</p><div class="notifications-error__back" aria-action="close"><div class="notifications-error__back__arrow"></div><div class="notifications-error__back__text">Back</div></div></div><div class="notifications-error--inner" id="settings-error-inner"><p class="notifications-error--inner__body notifications-10/12">Sorry. Something has gone wrong.<br>Your settings could not be updated. Please try again later.</p><div aria-label="Close notification error message" class="notifications-error--inner__close" aria-action="close">&nbsp;</div></div><div class="notifications-error" id="onboarding-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, Something has gone wrong</p></div><p class="notifications-pica notifications-error__body">There’s been an error and we are unable to get you<br>started with notifications. Please try again later.</p></div>';
}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/classie",[],function(){return e()}):"undefined"!=typeof exports?module.exports=e():t.classie=e()}(this,function(){function t(t){return new RegExp("(^|\\s+)"+t+"(\\s+|$)")}function e(t,e){var a=i(t,e)?o:n;a(t,e)}var i,n,o;"classList"in document.documentElement?(i=function(t,e){return t.classList.contains(e)},n=function(t,e){var i=e.split(" ");t.classList.add(i[0]),i.length>1&&n(t,i.slice(1).join(" "))},o=function(t,e){var i=e.split(" ");t.classList.remove(i[0]),i.length>1&&o(t,i.slice(1).join(" "))}):(i=function(e,i){return t(i).test(e.className)},n=function(t,e){var o=e.split(" ");i(t,o[0])||(t.className=t.className+" "+o[0]),o.length>1&&n(t,o.slice(1).join(" "))},o=function(e,i){var n=i.split(" ");e.className=e.className.replace(t(n[0])," "),n.length>1&&o(e,n.slice(1).join(" "))});var a={hasClass:i,addClass:n,removeClass:o,toggleClass:e,has:i,add:n,remove:o,toggle:e};return a}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/eventie",[],function(){return e()}):"undefined"!=typeof exports?module.exports=e():t.eventie=e()}(this,function(){return{addEvent:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):(t["e"+e+i]=i,t[e+i]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i]))},removeEvent:function(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):(t.detachEvent("on"+e,t[e+i]),t[e+i]=null)},triggerEvent:function(t,e,i,n){var o=document.createEvent("Event"),n=n||!1;""===o.type&&o.initEvent(e,!0,n),o.data=i||{},t.dispatchEvent(o)}}}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/utils",[],function(){return e(t)}):"undefined"!=typeof exports?module.exports=e(t):t.utils=e(t)}(this,function(t){var e=function(t){t&&(this.logger=t)};return e.prototype={handledParse:function(t,e,i){try{return JSON.parse(t)}catch(n){return this.logger&&this.logger.error(n,t),"function"==typeof i&&i(),e||null}},extend:function(){var t,e,i,n,o,a=Array.prototype.slice.call(arguments),s=this;if(0===a.length)return{};n=a[a.length-1],o=n===!0,"boolean"==typeof n&&a.pop();for(var r=0;r<a.length;r++)if(e=s.keys(a[r]),0!==e.length)for(var i in a[r])(!o||a[r].hasOwnProperty(i))&&(t=t||{},s.isArray(a[r][i])&&o?"undefined"!=typeof t[i]&&s.isArray(t[i])?s.forEach(a[r][i],function(e,n){t[i][n]=s.isObject(e)?s.extend(t[i][n],e,o):e}):t[i]=a[r][i].slice():s.isObject(a[r][i])&&o?t[i]=s.isObject(t[i])?s.extend(t[i],a[r][i],o):s.extend(a[r][i],o):null!==a[r][i]&&void 0!==a[r][i]&&(t[i]=a[r][i]));return t},forEach:function(t,e,i){i=i||null;for(var n=0,o=t.length;o>n;n++)n in t&&e.call(i,t[n],n,t)},truncate:function(t,e){return e=e||30,shortened=t.substring(0,e+1),t.length>e?-1==shortened.indexOf(" ")?shortened.substring(0,shortened.length-1)+"...":shortened.substr(0,Math.min(shortened.length,shortened.lastIndexOf(" ")))+" ...":t},each:function(t,e){if(this.isObject(t))for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)},bind:function(t,e){return"function"==typeof t?t.bind?t.bind(e):function(){t.apply(e,arguments)}:void 0},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},keys:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},isObject:function(t){return"object"==typeof t&&null!==t}},e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/logger",["mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("mybbc/notifications/utils")):t.logger=e()}(this,function(t){function e(t){var e,i=arguments.length>0?Array.prototype.slice.call(arguments,1):[],n=this.root.console&&("default"===this.mode||"cookie"===this.mode&&-1!==document.cookie.indexOf(this.cookieName));this.level=t.toLowerCase(),n&&(e="function"==typeof this.root.console[this.level]?this.level:"log",i[0]=this.getLogTitle()+i[0],this.root.console[e].apply?this.root.console[e].apply(this.root.console,i):this.root.console.log&&this.root.console.log(i))}function i(t,e){var i;return e=e||[],i=Array.prototype.slice.call(e),i.unshift(t),i}var n=this,o=function(t,e){e=e||{},this.context=t||"No Context",this.root=window?window:n,this.mode=o.defaults.mode||e.mode,this.cookieName=o.defaults.cookieName||e.cookieName};return o.defaults={mode:"cookie",cookieName:"ckps_notifications_log"},o.getLogger=function(t,e){return new this(t,e)},o.prototype={log:function(){e.apply(this,i("log",arguments))},info:function(){e.apply(this,i("info",arguments))},error:function(){e.apply(this,i("error",arguments))},warn:function(){e.apply(this,i("warn",arguments))},debug:function(){e.apply(this,i("debug",arguments))},getLogTitle:function(){return["[",this.context,":",this.level.toUpperCase(),"] "].join("")}},o}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/NotificationsTemplate",e):"undefined"!=typeof exports?module.exports=e():t.NotificationsTemplate=e()}(this,function(){var TemplateParser=function(){function Parser(t){this.setHtmlContent(t)}return Parser.prototype={setHtmlContent:function(t){this.htmlContent=t},getHtmlContent:function(){return this.htmlContent},compile:function(data){this.data=data||this.data;for(var templateData=this.data,variableFindPattern=/{{([A-Za-z0-9_@./#&+-]+)}}/gi,matchVariableName,rawContent=this.getHtmlContent(),replaceValue;null!==(match=variableFindPattern.exec(rawContent));){matchVariableName=match[1];try{replaceValue=eval("templateData."+matchVariableName)}catch(ex){continue}rawContent=rawContent.replace(new RegExp(match[0],"g"),replaceValue)}return this.compiledHtml=rawContent,this.compiledHtml}},Parser}(),NotificationsTemplate=function(t,e,i){i=i||{},this.name=t,this.templateParser=e,this.templateRequireBasePath=i.templateRequireBasePath||"mybbc/templates/",i.html?(this.templateParser.setHtmlContent(i.html),this.html(i.html),this.loaded(!0)):this.loaded(!1)};return NotificationsTemplate.create=function(t,e){return new this(t,new TemplateParser,e)},NotificationsTemplate.prototype={getTemplateFullRequirePath:function(){return this.templateRequireBasePath+this.name},load:function(t,e){e=e||null;var i=this;require([this.getTemplateFullRequirePath()],function(n){i.templateParser.setHtmlContent(n),i.html(n),i.loaded(!0),"function"==typeof t&&t.call(e,i)})},compile:function(t){return this.templateParser.compile(t)},html:function(t){return t&&(this.data=t),this.data},loaded:function(t){return void 0!==t&&(this.isLoaded=t),t}},NotificationsTemplate}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/ErrorView",["mybbc/notifications/classie","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/NotificationsTemplate"],e):"undefined"!=typeof exports?module.exports=e(require("classie"),require("eventie"),require("logger"),require("utils"),require("NotificationsTemplate")):t.ErrorView=e(classie,eventie,logger,utils,NotificationsTemplate)}(this,function(t,e,i,n,o){var a=function(a){function s(){p.innerHTML=h.compile({baseAssetUrl:u.mainApp.basePath}),m=p.querySelector(u.showErrorWithID),r(m),t.add(m,"show"),u.isInner?e.addEvent(m.querySelector(u.errorCloseEl),"click",u.closeEvent):"function"==typeof u.closeEvent&&u.errorCloseEl&&(e.removeEvent(m.querySelector(u.errorCloseEl),"click",u.closeEvent),e.addEvent(m.querySelector(u.errorCloseEl),"click",u.closeEvent)),u.stateChanged&&u.stateChanged.call(u,"shown"),u.showErrorCallback&&u.showErrorCallback("shown")}function r(t){for(var i=t.querySelectorAll("p, [aria-action=close]"),n=0;n<i.length;n++)i[n].tabIndex=n+1,i[n].getAttribute("aria-action")&&(e.removeEvent(i[n],"keydown",c),e.addEvent(i[n],"keydown",c))}function c(t){13==t.keyCode&&"function"==typeof u.closeEvent&&u.closeEvent()}function l(t,e){m||u.currentErrorView!=t.view||(t=t||{},u.showErrorCallback=e,u.showErrorWithID=t.errorElID,u.isInner=t.isInner,u.closeEvent=t.closeEvent,u.currentErrorView=t.view,u.errorCloseEl=t.closeEl,u.accesibilityInstance=t.accesibilityInstance,p=t.extContainer||document.querySelector(u.container),h.loaded()?s():h.load(s))}function d(t,e){m&&u.currentErrorView==t&&(m.parentElement.removeChild(m),e&&u.stateChanged&&u.stateChanged("hidden"),m=null)}function f(t){u.currentErrorView=t,d(t,!0)}var u,p,h,m,g=new n,v=(new i("Error view"),{container:".notification-error__container",containerForInner:"#notifications-main",templateName:"error",currentErrorView:"main"});return u=g.extend(v,a),h=o.create(u.templateName),{showError:l,hideError:d,changeView:f}};return a}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/carousel",e):"undefined"!=typeof exports?module.exports=e():(t.carousel=e(),(t.jQuery||t.Zepto)&&!function(e){e.fn.Swipe=function(i){return this.each(function(){e(this).data("Swipe",new t.Swipe(e(this)[0],i))})}}(t.jQuery||t.Zepto))}(this,function(){function t(t,e){function i(){E=T.children,S=E.length,E.length<2&&(e.continuous=!1),_.transitions&&e.continuous&&E.length<3&&(T.appendChild(E[0].cloneNode(!0)),T.appendChild(T.children[1].cloneNode(!0)),E=T.children),x=new Array(E.length),C=t.getBoundingClientRect().width||t.offsetWidth,T.style.width=E.length*C+"px";for(var i=E.length;i--;){var n=E[i];n.style.width=C+"px",n.setAttribute("data-index",i),_.transitions&&(n.style.left=i*-C+"px",f(i,j>i?-C:i>j?C:0,0))}e.continuous&&_.transitions&&(f(l(j-1),-C,0),f(l(j+1),C,0)),_.transitions||(T.style.left=j*-C+"px"),t.style.visibility="visible"}function n(){_.addEventListener?((_.touch||_.isWindowsPhone())&&M&&(T.addEventListener("touchstart",B,!1),T.addEventListener("pointerdown",B,!1)),_.transitions&&(T.addEventListener("webkitTransitionEnd",B,!1),T.addEventListener("msTransitionEnd",B,!1),T.addEventListener("oTransitionEnd",B,!1),T.addEventListener("otransitionend",B,!1),T.addEventListener("transitionend",B,!1)),window.addEventListener("resize",B,!1)):window.onresize=function(){i()},I.length>0&&w(Array.prototype.slice.call(I),function(t){_.addEventListener?t.addEventListener("click",a,!1):t.attachEvent("onclick",a)}),A.length>0&&w(Array.prototype.slice.call(A),function(t,e){_.addEventListener?t.addEventListener("click",s,!1):t.attachEvent("onclick",s)})}function o(){I.length>0&&w(Array.prototype.slice.call(I),function(t){_.addEventListener?t.removeEventListener("click",a,!1):t.detachEvent("onclick",a)}),A.length>0&&w(Array.prototype.slice.call(A),function(t,e){_.addEventListener?t.removeEventListener("click",s,!1):t.detachEvent("onclick",s)})}function a(t){var i=this.dataset&&this.dataset.slide?this.dataset.slide:this.getAttribute("data-slide"),n=j;"next"==i?c():r(),"function"==typeof e.onControlclicked&&e.onControlclicked.call(this,t,j,n,T)}function s(t){var i=this.dataset&&this.dataset.slideTo?parseInt(this.dataset.slideTo,10):null!==this.getAttribute("data-slide-to")?parseInt(this.getAttribute("data-slide-to"),10):[].slice.call(this.parentNode.childNodes).indexOf(this);d(i),"function"==typeof e.onIndicatorclicked&&e.onIndicatorclicked(this,j,T)}function r(){e.continuous?d(j-1):j&&d(j-1)}function c(){e.continuous?d(j+1):j<E.length-1&&d(j+1)}function l(t){return(E.length+t%E.length)%E.length}function d(t,i){if(j!=t){if(_.transitions){var n=Math.abs(j-t)/(j-t);if(e.continuous){var o=n;n=-x[l(t)]/C,n!==o&&(t=-n*E.length+t)}for(var a=Math.abs(j-t)-1;a--;)f(l((t>j?t:j)-a-1),C*n,0);t=l(t),f(j,C*n,i||N),f(t,0,i||N),e.continuous&&f(l(t-n),-(C*n),0)}else t=l(t),p(j*-C,t*-C,i||N,P);j=t,y(e.callback&&e.callback(j,E[j]))}}function f(t,e,i,n){u(t,e,i,n),x[t]=e}function u(t,e,i,n){var o=E[t],a=o&&o.style;n=n||!1,a&&(a.webkitTransitionDuration=a.MozTransitionDuration=a.msTransitionDuration=a.OTransitionDuration=a.transitionDuration=i+"ms",a.webkitTransitionTimingFunction=a.MozTransitionTimingFunction=a.msTransitionTimingFunction=a.OTransitionTimingFunction=a.transitionTimingFunction=O[n?k.easing:P].css,a.webkitTransform="translate("+e+"px,0)translateZ(0)",a.msTransform=a.MozTransform=a.OTransform="translateX("+e+"px)")}function p(t,i,n,o){if(!n)return void(T.style.left=i+"px");var a=+new Date,s=function(){var c=+new Date-a;return c>n?(T.style.left=i+"px",F&&m(),T.style.height=E[j].offsetHeight+"px",e.transitionEnd&&e.transitionEnd.call(event,j,E[j]),void(r&&clearInterval(r))):(T.style.left=O[o].js(c,t,i-t,n)+"px",void(!r&&_.animationFrame&&window.requestAnimationFrame(s)))};if(_.animationFrame)window.requestAnimationFrame(s);else var r=setInterval(s,parseInt(1e3/60,10))}function h(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function m(){D=setTimeout(c,F)}function g(){F=0,clearTimeout(D)}function v(){t.style.visibility="hidden"}var b=function(){},y=function(t){setTimeout(t||b,0)},w=function(t,e,i){if(i=i||null,Array.prototype.forEach)return Array.prototype.forEach.call(t,e,i);for(var n=0,o=t.length;o>n;n++)n in t&&e.call(i,t[n],n,t)},_={addEventListener:!!window.addEventListener,animationFrame:!!window.requestAnimationFrame,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,isWindowsPhone:function(){return-1!==navigator.appVersion.indexOf("Win")&&"undefined"!=typeof window.navigator.pointerEnabled&&null!==navigator.userAgent.match(/.+windows.+(touch|phone).+/i)},transitions:function(t){var e=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var i in e)if(void 0!==t.style[e[i]])return!0;return!1}(document.createElement("swipe"))},k={startSlide:0,speed:300,continuous:!0,easing:"ease",draggable:!0,touchEvents:!0};if(t){e=e||{};var E,x,C,S,T=t.children[0],I=t.querySelectorAll(e.controlsSelector||'[data-slide][data-target-carousel="#'+t.id+'"]'),A=t.querySelectorAll(e.indicatorSelector||'[data-slide-to][data-target-carousel="#'+t.id+'"]'),j=parseInt(e.startSlide,10)||k.startSlide,N="undefined"!=typeof e.speed?e.speed:k.speed,P=e.easing||k.easing,L="undefined"!=typeof e.draggable?e.draggable:k.draggable,M="undefined"!=typeof e.touchEvents?e.touchEvents:k.touchEvents;e.continuous=void 0!==e.continuous?e.continuous:k.continuous;var D,q,O={easeInOutExpo:{css:"cubic-bezier(1, 0, 0, 1)",js:function(t,e,i,n){return 0===t?e:t>=n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e}},linear:{css:"linear",js:function(t,e,i,n){return 0===t?e:t>=n?e+i:i*(Math.floor(t/n*100)/100)+e}},ease:{css:"ease",js:function(t,e,i,n){var o;return 0===t?e:t>=n?e+i:(o=1.0042954579734844*Math.exp(-6.404173895841566*Math.exp(-7.290824133098134*(t/n))),i*o+e)}}},F=e.auto||0,R={},H={},U={},B={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"pointerdown":this.start(t);break;case"touchmove":this.move(t);break;case"pointermove":this.move(t);break;case"touchend":y(this.end(t));break;case"pointerup":y(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":y(this.transitionEnd(t));break;case"resize":y(i)}e.stopPropagation&&t.stopPropagation()},start:function(t){if(t.touches)var e=t.touches[0];var i=_.isWindowsPhone()?t.clientX:e.pageX,n=_.isWindowsPhone()?t.clientY:e.pageY;i&&n&&(R={x:i,y:n,time:+new Date},H={x:i,y:n},q=void 0,U={},T.addEventListener("touchmove",this,!1),T.addEventListener("touchend",this,!1),T.addEventListener("pointermove",this,!1),T.addEventListener("pointerup",this,!1))},move:function(t){if(window.navigator.pointerEnabled||!(t.touches.length>1||t.scale&&1!==t.scale)){if(e.disableScroll&&h(t),t.touches){var i=t.touches[0];H.x=i.pageX,H.y=i.pageY}else _.isWindowsPhone()&&(H.x=t.clientX?t.clientX:H.x,H.y=t.clientY?t.clientY:H.y);U={x:H.x-R.x,y:H.y-R.y},"undefined"==typeof q&&(q=!!(q||Math.abs(U.x)<Math.abs(U.y))),q||(h(t),g(),L&&(e.continuous?(u(l(j-1),U.x+x[l(j-1)],0),u(j,U.x+x[j],0),u(l(j+1),U.x+x[l(j+1)],0)):(U.x=U.x/(!j&&U.x>0||j==E.length-1&&U.x<0?Math.abs(U.x)/C+1:1),u(j-1,U.x+x[j-1],0),u(j,U.x+x[j],0),u(j+1,U.x+x[j+1],0))))}},end:function(t){var i=500,n=10,o=30,a=+new Date-R.time,s=Number(a)<i&&Math.abs(U.x)>n||Math.abs(U.x)>C*(o/100),r=Math.abs(N-Math.floor(Math.abs(U.x)/C*1.2*N));r=.5>r/N?.5*N:r/N>.75?.75*N:r;var c=!j&&U.x>0||j==E.length-1&&U.x<0,d=j;e.continuous&&(c=!1);var u=U.x<0;q||(s&&!c?(u?(e.continuous?(f(l(j-1),-C,0),f(l(j+2),C,0)):f(j-1,-C,0),f(j,x[j]-C,r),f(l(j+1),x[l(j+1)]-C,r),j=l(j+1)):(e.continuous?(f(l(j+1),C,0),f(l(j-2),-C,0)):f(j+1,C,0),f(j,x[j]+C,r),f(l(j-1),x[l(j-1)]+C,r),j=l(j-1)),e.callback&&e.callback(j,E[j])):e.continuous?(f(l(j-1),-C,N),f(j,0,N),f(l(j+1),C,N)):(f(j-1,-C,N),f(j,0,N),f(j+1,C,N)),e.onSwipe&&e.onSwipe(j,d,u?"right":"left")),T.removeEventListener("touchmove",B,!1),T.removeEventListener("touchend",B,!1),T.removeEventListener("pointermove",B,!1),T.removeEventListener("pointerup",B,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==j&&(F&&m(),T.style.height=E[j].offsetHeight+"px",e.transitionEnd&&e.transitionEnd.call(t,j,E[j]))}};return i(),F&&m(),n(),{setup:function(){i()},slide:function(t,e){g(),d(t,e)},prev:function(){g(),r()},next:function(){g(),c()},stop:function(){g()},getPos:function(){return j},getNumSlides:function(){return S},getActiveSlideEl:function(){return E[j]},hide:function(){v()},kill:function(){g(),T.style.width="",T.style.left="";for(var t=E.length;t--;){var e=E[t];e.style.width="",e.style.left="",_.transitions&&u(t,0,0)}_.addEventListener?(T.removeEventListener("touchstart",B,!1),T.removeEventListener("pointerdown",B,!1),T.removeEventListener("webkitTransitionEnd",B,!1),T.removeEventListener("msTransitionEnd",B,!1),T.removeEventListener("oTransitionEnd",B,!1),T.removeEventListener("otransitionend",B,!1),T.removeEventListener("transitionend",B,!1),T.removeEventListener("click",B,!1),window.removeEventListener("resize",B,!1)):window.onresize=null,o()}}}}return t}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/onboarding",["mybbc/notifications/eventie","mybbc/notifications/utils","mybbc/notifications/carousel","mybbc/notifications/classie","mybbc/notifications/logger"],e):"undefined"!=typeof exports?module.exports=e(require("eventie"),require("utils"),require("carousel"),require("Logger")):t.onboarding=e(eventie,utils,carousel,classie,Logger)}(this,function(t,e,i,n,o){function a(t){t=t||{},D=R.extend(tt,t),s(D.mainElSelector),M=D.carousels,t.app&&(L=t.app),D.errorView&&(q=D.errorView,q.changeView("onboarding")),y(),r(),d(),U=!0}function s(t){F=document.querySelector(t),F.style.display="block"}function r(){var e=document.querySelector(".notifications-opt-in__link--js"),i=document.querySelector(".notifications-start-onboarding__link--js"),n=Array.prototype.slice.call(document.querySelectorAll(".on-boarding-close"));t.addEvent(e,"click",l),t.addEvent(i,"click",g),R.forEach(n,function(e){t.addEvent(e,"click",m)}),nt.startListeners()}function c(){var e=document.querySelector(".notifications-opt-in__link--js"),i=document.querySelector(".notifications-start-onboarding__link--js"),n=Array.prototype.slice.call(document.querySelectorAll(".on-boarding-close"));t.removeEvent(e,"click",l),t.removeEvent(i,"click",g),R.forEach(n,function(e){t.removeEvent(e,"click",m)}),nt.stopListeners()}function l(){L.getUserPreferencesModel().updateUserOnBoarding(function(t,e){return t?(q.showError({view:"onboarding",isInner:!1,errorElID:"#onboarding-error-main"}),void H.error("Error updating user onboarding",t)):void v()})}function d(){var t=document.querySelector(".orb-nav-pri-container"),e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),n=u(e,i,t.offsetHeight),o=400;e>i&&768>e?p(z,Math.max(e,n-t.offsetHeight)+"px"):p(z,n-t.offsetHeight+"px"),j(z),_(),NotificationsModernizr.cssanimations||setTimeout(function(){_()},o)}function f(){V.style.top="",V.setAttribute("style",""),V.setAttribute("style","top: 0px"),j(V);var t,e=getComputedStyle(V),i=z.clientWidth,n=z.clientHeight,o=1008,a=800,s=750,r=1173,c=o/a,l=s/r,d=parseFloat(e.width,10),f=0,u=.15;768>i?(f=d/l,t=-(f-n)+(f*u-n/2)):(f=d/c,t=-(f-n/2)),V.setAttribute("style","top: "+t+"px; height: "+f+"px")}function u(t,e,i){var n=419,o=1008,a=460+i,e=e||Math.max(document.documentElement.clientHeight,window.innerHeight||0);return n>=t?Math.max(e,a):o>t?Math.max(.7*e,a):a}function p(t,e){t.setAttribute("data-orig-height",t.style.height),t.style.minHeight=e,t.style.height=e,t.style.maxHeight=e}function h(){p(z,z.getAttribute("data-orig-height"))}function m(){"hidden"!==L.getDrawerState()&&L.navNotificationElement.click()}function g(){Q||(L.isUserOnBoarded()?v():(I("onboardingParent").next(),Q=!0))}function v(){NotificationsModernizr.cssanimations?(t.addEvent(F,b(),function(t){"hidden"!==L.getDrawerState()&&L.navNotificationElement.click(),L.prepareAndLaunchNotificationApp()}),n.add(F,"notifications-on-boarding--fadeout")):("hidden"!==L.getDrawerState()&&L.navNotificationElement.click(),L.prepareAndLaunchNotificationApp())}function b(){var t=document.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var i in e)if("undefined"!=typeof t.style[i])return e[i]}function y(){var t=M.onboardingParent.config;t.callback=it.onboardingParentCasouselSlideChanged,t.transitionEnd=it.onboardingParentCasouselSlideChangeFinished,T("onboardingParent",t),_(),w(),nt.checkInitialFocus()}function w(){for(var t=document.querySelectorAll(".notifications-wide-spread .enter-animation"),e=0;e<t.length;e++)j(t[e])}function _(){var t=document.querySelector("#notifications-main"),e=t.offsetHeight;document.querySelector("#orb-panels").style.height=e+"px"}function k(t){var e=M.onboarding.config;e.callback=t||it.onboardingCasouselSlideChanged,e.onControlclicked=it.onBoardingCarouselControlClicked,e.onSwipe=it.onBoardingCarouselSwiped,T("onboarding",e);for(var i=0;i<Z.length;i++)n.add(Z[i],"first-time"),j(Z[i])}function E(){return B}function x(t){B=t}function C(t){t.target.querySelector(J).innerHTML=et[E()].title.replace(/'/g,"&#146;"),t.target.querySelector(X).innerHTML=et[E()].body.replace(/'/g,"&#146;"),n.remove(V,"enter-animation"),1===B&&(n.add(V,"enter-animation"),f(),S()),2===B?(n.add(W,"swing onboarding"),n.add(Y,"new-notifications onboarding")):(n.remove(W,"swing onboarding"),1===B&&n.remove(Y,"new-notifications onboarding")),nt.setCarouselSlideFocus("onboarding",J)}function S(){var t,e=getComputedStyle(V),i=e.backgroundImage,n=i.split(".gif").shift(),o=V.style.top,a=V.style.height;t="background-image: "+n.replace(/\"|\'/g,"")+".gif?_"+Date.now()+") !important;top: "+o+";height: "+a+";",V.setAttribute("style",t)}function T(t,e){var o=document.querySelector(M[t].selector);n.remove(o,"hidden"),M[t].carousel=i(o,e)}function I(t){return M[t].carousel}function A(t){for(var e=document.querySelectorAll(".notifications-carousel__slide--slide-"+t+" .enter-animation"),i=0;i<e.length;i++)n.remove(e[i],"first-time");2==t&&(O=ot(e).animate(["fade-in-animation","move-down-animation"]));for(var o=0;o<$.length;o++)n.remove($[o],"first-time swipe-left-in swipe-left-out swipe-right-out swipe-right-in");for(O=t<E()?ot($).animate(["swipe-right-out","swipe-right-in"],C):ot($).animate(["swipe-left-out","swipe-left-in"],C),o=-1;++o<$.length;)j($[o]);x(t)}function j(t){var e=t.style.display,i=t.getAttribute("style");t.style.display="none",t.setAttribute("style","");t.offsetHeight;t.style.display=e,t.setAttribute("style",i)}function N(){if(M.onboarding.carousel){var t=document.querySelector(M.onboarding.selector);n.add(t,"hidden"),M.onboarding.carousel.slide(0,0),M.onboarding.config=tt.carousels.onboarding.config,M.onboarding.carousel.kill(),M.onboarding.carousel=void 0}M.onboardingParent.config=tt.carousels.onboardingParent.config,M.onboardingParent.carousel.kill(),x(0),U=!1,Q=!1,O&&O.unbindAll();for(var e=0;e<$.length;e++)$[e].className="",n.add($[e],"notifications-carousel__content notifications-carousel__content--js"),$[e].querySelector(J).innerHTML=et[0].title.replace(/'/g,"&#146;"),$[e].querySelector(X).innerHTML=et[0].body.replace(/'/g,"&#146;"),j($[e]);n.add($[0],"first-time"),n.remove(V,"enter-animation"),c(),S(),j(V)}function P(t,e){var i=M.onboarding.carousel;e===i.getNumSlides()-1&&t===i.getNumSlides()-1&&(w(),M.onboardingParent.carousel.next())}var L,M,D,q,O,F,R=new e,H=new o("Onboarding"),U=!1,B=0,G=700,V=document.querySelector(".notifications-favourites--preview"),z=document.getElementById("notifications-main"),W=document.getElementById("notification-link"),J=".notifications-carousel__header--js p",X=".notifications-carousel__description--js p",K=".notifications-main-header__are-you-ready--js",Y=document.getElementById("not-num"),$=(document.querySelector(J),document.querySelector(X),document.querySelectorAll(".notifications-carousel__content--js")),Z=document.querySelectorAll(".first-time"),Q=!1,tt={carousels:{onboardingParent:{selector:".notifications-onboarding-parent-carousel--js",config:{speed:G,easing:"easeInOutExpo",continuous:!1,draggable:!1,touchEvents:!1}},onboarding:{selector:".notifications-onboarding-carousel--js",config:{indicatorSelector:".notifications-carousel-pages__link--js",controlsSelector:".notifications-carousel__controls--js",speed:0,continuous:!1,draggable:!1}}}},et=[{title:"Notifications appear here",body:"For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow."},{title:"You'll receive a notification...",body:"...when you add your favourite programme, a music artist, playlist, and in future much more."},{title:"Stay up to date",body:"You will get notifications whenever there's something new."},{title:"You're in charge",body:"You can manage the notifications you receive in settings."}],it={onboardingParentCasouselSlideChangeFinished:function(t,e){var i={1:J,2:K};nt.setCarouselSlideFocus("onboardingParent",i[t])},onboardingParentCasouselSlideChanged:function(t,e){var i=t,o=1===i&&"undefined"==typeof M.onboarding.carousel;o&&k(),2==t&&n.remove(e.querySelector(".on-boarding--js"),"hidden"),_()},onboardingCasouselSlideChanged:function(t,e){A(t)},onBoardingCarouselControlClicked:function(t,e,i){var n=this.getAttribute("data-slide");"next"===n&&P(e,i)},onBoardingCarouselSwiped:function(t,e,i){"right"==i&&P(t,e)}},nt=function(){function e(t){var e=t.which||t.keyCode;e==f?l=Date.now():e==u&&(d=Date.now())}function i(t){var e=t.which||t.keyCode;e==u&&t.shiftKey&&(t.preventDefault?t.preventDefault():t.returnValue=!1,L.navNotificationElement.click(),L.navNotificationElement.focus())}function n(t){var e=t.which||t.keyCode;e!=u||t.shiftKey||(t.preventDefault?t.preventDefault():t.returnValue=!1,c.setCarouselSlideFocus("onboarding",J,!1))}var o,a,s,r,c={},l=Date.now(),d=Date.now(),f=13,u=9,p=2e3;return c.checkInitialFocus=function(){o=document.querySelector(M.onboardingParent.selector+" .notifications-main-header__first--js"),a=document.querySelector(M.onboardingParent.selector+" "+K),s=document.querySelector(M.onboardingParent.selector+" .notifications-description__first--js"),r=document.querySelectorAll(M.onboardingParent.selector+" .notifications-carousel__controls--skip__link--js");var t=Date.now();"undefined"!=typeof L.navNotificationElement.lastEnterPress&&t-L.navNotificationElement.lastEnterPress<p&&o.focus()},c.setCarouselSlideFocus=function(t,e,i){i=i!==!1;var n=Date.now();if(!(i&&n-l>=p))return"onboarding"==t?M[t].carousel.getActiveSlideEl().querySelector(e).focus():void document.querySelector(M[t].selector+" "+e).focus()},c.startListeners=function(){t.addEvent(document.querySelector(M.onboardingParent.selector),"keydown",e),t.addEvent(o,"keydown",i),t.addEvent(a,"keydown",i),R.forEach([].slice.call(document.querySelectorAll(J)),function(e){t.addEvent(e,"keydown",i)}),R.forEach([].slice.call(r),function(e){t.addEvent(e,"keydown",n)})},c.stopListeners=function(){t.removeEvent(document.querySelector(M.onboardingParent.selector),"keydown",e),t.removeEvent(o,"keydown",i),t.removeEvent(a,"keydown",i),R.forEach([].slice.call(document.querySelectorAll(J)),function(e){t.removeEvent(e,"keydown",i)}),R.forEach([].slice.call(r),function(e){t.removeEvent(e,"keydown",n)})},c}(),ot=function(e){function i(){var t=document.createElement("fakeelement"),e={animation:"animationend",MozAnimation:"mozAnimationEnd",webkitAnimation:"webkitAnimationEnd",msAnimation:"msAnimationEnd"};for(var i in e)if("undefined"!=typeof t.style[i])return e[i]}function o(t,e,i){this.els=t,this.callback=i,this.classList=e}return e.length?(o.prototype={getElementNextAnimationClassInfo:function(t){for(var e=!1,i=0;i<this.classList.length;i++)if(!n.has(t,this.classList[i])){e=!0;break}return e?{index:i,className:this.classList[i]}:null},animationEndCallback:function(e){t.removeEvent(e.target,i(),this.animationEndCallbackBind);var o=this.getElementNextAnimationClassInfo(e.target);null!==o&&(o.index<this.classList.length-1&&t.addEvent(e.target,i(),this.animationEndCallbackBind),n.add(e.target,o.className)),this.callback&&this.callback.call(null,e)},start:function(){var e=-1;for(this.animationEndCallbackBind=R.bind(this.animationEndCallback,this);++e<this.els.length;)n.remove(this.els[e],this.classList.join(" ")),t.addEvent(this.els[e],i(),this.animationEndCallbackBind),n.add(this.els[e],this.classList[0])},unbindAll:function(){for(var e=-1;++e<this.els.length;)t.removeEvent(this.els[e],i(),this.animationEndCallbackBind)}},{animate:function(t,i){var n=new o(e,t,i);return n.start(),n}}):void H.error("No elements passed to sequencedAnimations")},at={init:function(t){a(t)},getCarousel:function(t){return M[t]},initialised:U,resetOnboarding:N,removeCustomHeights:h};return at}),function(t){function e(t){var e={val:t},i=t.split(/\s+in\s+/);return i[1]&&(e.val=S(0)+i[1],i=i[0].slice(S(0).length).trim().split(/,\s*/),e.key=i[0],e.pos=i[1]),e}function i(t,e,i){var n={};return n[t.key]=e,t.pos&&(n[t.pos]=i),n}function n(t,n,o){function a(t,e,i){p.splice(t,0,e),h.splice(t,0,i)}f(t,"each");var r,c=t.outerHTML,l=t.previousSibling,u=t.parentNode,p=[],h=[];o=e(o),n.one("update",function(){u.removeChild(t)}).one("premount",function(){u.stub&&(u=n.root)}).on("update",function(){var t=T(o.val,n);if(t){if(!Array.isArray(t)){var e=JSON.stringify(t);if(e==r)return;r=e,d(h,function(t){t.unmount()}),p=[],h=[],t=Object.keys(t).map(function(e){return i(o,e,t[e])})}d(p,function(e){if(e instanceof Object){if(t.indexOf(e)>-1)return}else{var i=y(t,e),n=y(p,e);if(i.length>=n.length)return}var o=p.indexOf(e),a=h[o];return a?(a.unmount(),p.splice(o,1),h.splice(o,1),!1):void 0});var f=[].indexOf.call(u.childNodes,l)+1;d(t,function(e,l){var d=t.indexOf(e,l),m=p.indexOf(e,l);if(0>d&&(d=t.lastIndexOf(e,l)),0>m&&(m=p.lastIndexOf(e,l)),!(e instanceof Object)){var g=y(t,e),v=y(p,e);g.length>v.length&&(m=-1)}var b=u.childNodes;if(0>m){if(!r&&o.key)var w=i(o,e,d);var _=new s({tmpl:c},{before:b[f+d],parent:n,root:u,item:w||e});return _.mount(),a(d,e,_),!0}return o.pos&&h[m][o.pos]!=d&&(h[m].one("update",function(t){t[o.pos]=d}),h[m].update()),d!=m?(u.insertBefore(b[f+m],b[f+(d>m?d+1:d)]),a(d,p.splice(m,1)[0],h.splice(m,1)[0])):void 0}),p=t.slice()}})}function o(t,e,i){g(t,function(t){if(1==t.nodeType){t.parentNode&&t.parentNode.isLoop&&(t.isLoop=1),t.getAttribute("each")&&(t.isLoop=1);var n=_(t);if(n&&!t.isLoop){for(var o,a=new s(n,{root:t,parent:e},t.innerHTML),r=n.name,c=e;!_(c.root)&&c.parent;)c=c.parent;a.parent=c,o=c.tags[r],o?(Array.isArray(o)||(c.tags[r]=[o]),c.tags[r].push(a)):c.tags[r]=a,t.innerHTML="",i.push(a)}d(t.attributes,function(i){/^(name|id)$/.test(i.name)&&(e[i.value]=t)})}})}function a(t,e,i){function o(t,e,n){if(e.indexOf(S(0))>=0){var o={dom:t,expr:e};i.push(u(o,n))}}g(t,function(t){var i=t.nodeType;if(3==i&&"STYLE"!=t.parentNode.tagName&&o(t,t.nodeValue),1==i){var a=t.getAttribute("each");return a?(n(t,e,a),!1):(d(t.attributes,function(e){var i=e.name,n=i.split("__")[1];return o(t,e.value,{attr:n||i,bool:n}),n?(f(t,i),!1):void 0}),_(t)?!1:void 0)}})}function s(t,e,i){function n(){d(Object.keys(C),function(t){f[t]=T(C[t],h||c);
})}function s(t){if(d(b,function(e){e[t?"mount":"unmount"]()}),h){var e=t?"on":"off";h[e]("update",c.update)[e]("unmount",c.unmount)}}var r,c=x.observable(this),f=w(e.opts)||{},p=m(t.tmpl),h=e.parent,g=[],b=[],y=e.root,_=e.item,k=t.fn,E=y.tagName.toLowerCase(),C={};k&&y._tag&&y._tag.unmount(!0),y._tag=this,this._id=~~((new Date).getTime()*Math.random()),u(this,{parent:h,root:y,opts:f,tags:{}},_),d(y.attributes,function(t){C[t.name]=t.value}),p.innerHTML&&!/select/.test(E)&&(p.innerHTML=v(p.innerHTML,i)),this.update=function(t,e){u(c,t,_),n(),c.trigger("update",_),l(g,c,_),c.trigger("updated")},this.mount=function(){if(n(),k&&k.call(c,f),s(!0),a(p,c,g),c.parent||c.update(),c.trigger("premount"),k)for(;p.firstChild;)y.appendChild(p.firstChild);else r=p.firstChild,y.insertBefore(r,e.before||null);y.stub&&(c.root=y=h.root),c.trigger("mount")},this.unmount=function(t){var e=k?y:r,i=e.parentNode;if(i){if(h)Array.isArray(h.tags[E])?d(h.tags[E],function(t,e){t._id==c._id&&h.tags[E].splice(e,1)}):delete h.tags[E];else for(;e.firstChild;)e.removeChild(e.firstChild);t||i.removeChild(e)}c.trigger("unmount"),s(),c.off("*"),y._tag=null},o(p,this,b)}function r(e,i,n,o,a){n[e]=function(e){e=e||t.event,e.which=e.which||e.charCode||e.keyCode,e.target=e.target||e.srcElement,e.currentTarget=n,e.item=a,i.call(o,e)===!0||/radio|check/.test(n.type)||(e.preventDefault&&e.preventDefault(),e.returnValue=!1);var s=a?o.parent:o;s.update()}}function c(t,e,i){t&&(t.insertBefore(i,e),t.removeChild(e))}function l(t,e,i){d(t,function(t,n){var o=t.dom,a=t.attr,s=T(t.expr,e),l=t.dom.parentNode;if(null==s&&(s=""),l&&"TEXTAREA"==l.tagName&&(s=s.replace(/riot-/g,"")),t.value!==s){if(t.value=s,!a)return o.nodeValue=s;if(f(o,a),"function"==typeof s)r(a,s,o,e,i);else if("if"==a){var d=t.stub;s?d&&c(d.parentNode,d,o):(d=t.stub=d||document.createTextNode(""),c(o.parentNode,o,d))}else if(/^(show|hide)$/.test(a))"hide"==a&&(s=!s),o.style.display=s?"":"none";else if("value"==a)o.value=s;else if("riot-"==a.slice(0,5))a=a.slice(5),s?o.setAttribute(a,s):f(o,a);else{if(t.bool){if(o[a]=s,!s)return;s=a}"object"!=typeof s&&o.setAttribute(a,s)}}})}function d(t,e){for(var i,n=0,o=(t||[]).length;o>n;n++)i=t[n],null!=i&&e(i,n)===!1&&n--;return t}function f(t,e){t.removeAttribute(e)}function u(t,e,i){return e&&d(Object.keys(e),function(i){t[i]=e[i]}),i?u(t,i):t}function p(){if(t){var e=navigator.userAgent,i=e.indexOf("MSIE ");return i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):0}}function h(t,e){var i=document.createElement("option"),n=/value=[\"'](.+?)[\"']/,o=/selected=[\"'](.+?)[\"']/,a=e.match(n),s=e.match(o);i.innerHTML=e,a&&(i.value=a[1]),s&&i.setAttribute("riot-selected",s[1]),t.appendChild(i)}function m(t){var e=t.trim().slice(1,3).toLowerCase(),i=/td|th/.test(e)?"tr":"tr"==e?"tbody":"div",n=document.createElement(i);return n.stub=!0,"op"===e&&C&&10>C?h(n,t):n.innerHTML=t,n}function g(t,e){if(t)if(e(t)===!1)g(t.nextSibling,e);else for(t=t.firstChild;t;)g(t,e),t=t.nextSibling}function v(t,e){return t.replace(/<(yield)\/?>(<\/\1>)?/gim,e||"")}function b(t,e){return e=e||document,e.querySelectorAll(t)}function y(t,e){return t.filter(function(t){return t===e})}function w(t){function e(){}return e.prototype=t,new e}function _(t){return A[t.getAttribute("riot-tag")||t.tagName.toLowerCase()]}function k(t){var e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e)}function E(t,e,i){var n=A[e],o=t.innerHTML;return t.innerHTML="",n&&t&&(n=new s(n,{root:t,opts:i},o)),n&&n.mount?(n.mount(),I.push(n),n.on("unmount",function(){I.splice(I.indexOf(n),1)})):void 0}var x={version:"v2.0.15",settings:{}},C=p();x.observable=function(t){t=t||{};var e={},i=0;return t.on=function(n,o){return"function"==typeof o&&(o._id="undefined"==typeof o._id?i++:o._id,n.replace(/\S+/g,function(t,i){(e[t]=e[t]||[]).push(o),o.typed=i>0})),t},t.off=function(i,n){return"*"==i?e={}:i.replace(/\S+/g,function(t){if(n)for(var i,o=e[t],a=0;i=o&&o[a];++a)i._id==n._id&&(o.splice(a,1),a--);else e[t]=[]}),t},t.one=function(e,i){function n(){t.off(e,n),i.apply(t,arguments)}return t.on(e,n)},t.trigger=function(i){for(var n,o=[].slice.call(arguments,1),a=e[i]||[],s=0;n=a[s];++s)n.busy||(n.busy=1,n.apply(t,n.typed?[i].concat(o):o),a[s]!==n&&s--,n.busy=0);return e.all&&"all"!=i&&t.trigger.apply(t,["all",i].concat(o)),t},t},function(t,e,i){function n(){return r.href.split("#")[1]||""}function o(t){return t.split("/")}function a(t){t.type&&(t=n()),t!=s&&(c.trigger.apply(null,["H"].concat(o(t))),s=t)}if(i){var s,r=i.location,c=t.observable(),l=i,d=!1,f=t.route=function(t){t[0]?(r.hash=t,a(t)):c.on("H",t)};f.exec=function(t){t.apply(null,o(n()))},f.parser=function(t){o=t},f.stop=function(){d&&(l.removeEventListener?l.removeEventListener(e,a,!1):l.detachEvent("on"+e,a),c.off("*"),d=!1)},f.start=function(){d||(l.addEventListener?l.addEventListener(e,a,!1):l.attachEvent("on"+e,a),d=!0)},f.start()}}(x,"hashchange",t);var S=function(t,e,i){return function(n){return e=x.settings.brackets||t,i!=e&&(i=e.split(" ")),n&&n.test?e==t?n:RegExp(n.source.replace(/\{/g,i[0].replace(/(?=.)/g,"\\")).replace(/\}/g,i[1].replace(/(?=.)/g,"\\")),n.global?"g":""):i[n]}}("{ }"),T=function(){function e(t,e){return t=(t||S(0)+S(1)).replace(S(/\\{/g),"￰").replace(S(/\\}/g),"￱"),e=o(t,a(t,S(/{/),S(/}/))),new Function("d","return "+(e[0]||e[2]||e[3]?"["+e.map(function(t,e){return e%2?i(t,!0):'"'+t.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")':i(e[1])).replace(/\uFFF0/g,S(0)).replace(/\uFFF1/g,S(1))+";")}function i(t,e){return t=t.replace(/\n/g," ").replace(S(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),""),/^\s*[\w- "']+ *:/.test(t)?"["+a(t,/["' ]*[\w- ]+["' ]*:/,/,(?=["' ]*[\w- ]+["' ]*:)|}|$/).map(function(t){return t.replace(/^[ "']*(.+?)[ "']*: *(.+?),? *$/,function(t,e,i){return i.replace(/[^&|=!><]+/g,n)+'?"'+e+'":"",'})}).join("")+'].join(" ").trim()':n(t,e)}function n(e,i){return e=e.trim(),e?"(function(v){try{v="+(e.replace(r,function(e,i,n){return n?"(d."+n+"===undefined?"+("undefined"==typeof t?"global.":"window.")+n+":d."+n+")":e})||"x")+"}finally{return "+(i===!0?'!v&&v!==0?"":v':"v")+"}}).call(d)":""}function o(t,e){var i=[];return e.map(function(e,n){n=t.indexOf(e),i.push(t.slice(0,n),e),t=t.slice(n+e.length)}),i.concat(t)}function a(t,e,i){var n,o=0,a=[],s=new RegExp("("+e.source+")|("+i.source+")","g");return t.replace(s,function(e,i,s,r){!o&&i&&(n=r),o+=i?1:-1,o||null==s||a.push(t.slice(n,r+s.length))}),a}var s={},r=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_$]\w*)/gi;return function(t,i){return t&&(s[t]=s[t]||e(t))(i)}}(),I=[],A={};x.tag=function(t,e,i,n){return"function"==typeof i?n=i:i&&k(i),A[t]={name:t,tmpl:e,fn:n},t},x.mount=function(t,e,i){function n(t){var n=e||t.getAttribute("riot-tag")||t.tagName.toLowerCase(),o=E(t,n,i);o&&s.push(o)}var o,a=function(t){return t=Object.keys(A).join(", "),t.split(",").map(function(e){t+=', *[riot-tag="'+e.trim()+'"]'}),t},s=[];if("object"==typeof e&&(i=e,e=0),"string"==typeof t?("*"==t&&(t=a(t)),o=b(t)):o=t,"*"==e){if(e=a(t),o.tagName)o=b(e,o);else{var r=[];d(o,function(t){r=b(e,t)}),o=r}e=0}return o.tagName?n(t):d(o,n),s},x.update=function(){return d(I,function(t){t.update()})},x.mountTo=x.mount,x.util={brackets:S,tmpl:T},"object"==typeof exports?module.exports=x:"function"==typeof define&&define.amd?define("mybbc/notifications/vendor/riot.min",[],function(){return x}):t.riot=x}("undefined"!=typeof window?window:void 0),define("mybbc/notifications/config",[],function(){var t={feedAggregatedBaseUrl:"//notifications.files.bbci.co.uk/",feedAggregatedInitialFeed:"latest.json",preferencesUrls:{get:"https://preferences.notifications.api.bbc.co.uk/subscriptions",postPreference:"https://preferences.notifications.api.bbc.co.uk/preference",postPreferenceRelay:"https://preferences.notifications.api.bbc.co.uk/preference/relay"},idcta:{urls:{signin:"https://ssl.bbc.co.uk/id/signin",register:"https://ssl.bbc.co.uk/id/register"}},notificationsPollingInterval:6e4,preferencesPollingInterval:6e4,lockExpiry:3e4,cacheTimeout:6e5,visibleChunkAmount:10,maxNotificationAge:5},e={env:t};return e}),define("mybbc/notifications/vendor/relay",[],function(){function t(t,e){var i,n="__iframe_"+ ++s.frameCount,o=document.createElement("iframe");o.setAttribute("name",n),o.style.cssText="visibility: hidden; position: absolute; height: 0; width: 0;",o.id=n,document.body.appendChild(o),o.attachEvent?o.attachEvent("onload",function(){t(o)}):o.onload=function(){t(o)},o.src=e,i=frames[n],i.name=n,"about:blank"===e&&(i.document.open(),i.document.write("<html></html>"),i.document.close())}function e(t){t.parentNode.removeChild(t)}function i(t,e,i,o){function a(){t.loadcount++,"function"==typeof t.handleLoad&&t.handleLoad()}var s,r,c,l;t.callback=o||function(){},r=t.document.createElement("script"),c="var eventMethod = window.addEventListener? 'addEventListener' : 'attachEvent',    eventListener = window[eventMethod],    eventName = (eventMethod === 'attachEvent')? 'onmessage' : 'message';var messageCount = 0, messageHandler = function(e) { if (messageCount++) {return}; self.callback(e.data); return false;  }; eventListener(eventName, messageHandler, false);loadcount = 0; function handleLoad(){};",r.type="text/javascript";try{r.appendChild(t.document.createTextNode(c))}catch(d){r.text=c}t.document.body.appendChild(r);try{s=t.document.createElement('<iframe name="myIframe"/>')}catch(d){s=t.document.createElement("iframe")}s.src="about:blank",s.attachEvent?s.attachEvent("onload",a):s.onload=a,s.id=s.name="myIframe",t.document.body.appendChild(s),l=t.document.createElement("form"),l.method="POST",l.id="myForm",l.setAttribute("target","myIframe"),l.target="myIframe",l.action=i,l.innerHTML=n(e),t.document.body.appendChild(l),r=t.document.createElement("script"),r.type="text/javascript",c='n = loadcount;myIframe = frames["myIframe"];handleLoad = function() {if (loadcount === n+1) {setTimeout(function(){ myIframe.location.replace("about:blank"); }, 0)} else if (loadcount === n+2) {handleLoad = function(){};setTimeout(function(){ if (!window.postMessage) { self.callback(myIframe.name=="myIframe"? null:myIframe.name); }}, 0);}};document.getElementById("myForm").submit();';try{r.appendChild(t.document.createTextNode(c))}catch(d){r.text=c}t.document.body.appendChild(r)}function n(t){var e="";if("object"==typeof t){for(var i in t)t.hasOwnProperty(i)&&(e+=o(i,t[i]));return e}return o("data",t)}function o(t,e){return'<input type="text" name="'+a(t)+'" value="'+a(e)+'" />'}function a(t){return t=""+t,t.replace(/([&<>"])/g,function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return e[t]})}var s={frameCount:0};return s.post=function(n,o,a){var s,r,c,l,d,f="about:blank",u=1e4;"object"==typeof a?(d=a.callback,"undefined"!=typeof a.referer&&(f=a.referer),"undefined"!=typeof a.timeout&&(u=a.timeout)):"function"==typeof a&&(d=a),r=function(t){s=frames[t.id],c=setTimeout(function(){t&&e(t),t=null,d&&(d(null),d=null)},u),l=function(i){clearTimeout(c),t&&e(t),d&&d(i)},i(s,n,o,l)},t(r,f)},s}),function(t){function e(t){return this._attempts=0,this._setSettings(t),this}e.defaults={type:"GET",dataType:"json",jsonpCallback:"colbertCallback",appendJsonpCallback:!0,async:!0,timeout:15e3,data:"",cache:!1,responseType:"text",retryThreshold:1,url:t.location.toString(),contentType:"application/x-www-form-urlencoded",accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"}},e.create=function(t){return new e(t)},e._setupRelay=function(t){this.prototype.relayEnabled=!0,this.prototype.relay=t},e.prototype={_prepareData:function(t){return"string"!=typeof t.data&&"application/json"==t.contentType&&(t.data=JSON.stringify(t.data)),t},isXHRCorsSupported:function(){return"undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest},isIE6to10:function(){return t.navigator.appVersion.toLowerCase().indexOf("msie")>=0},_serialize:function(t,e){if(!_isArray(t)&&"object"!=typeof t)return t;var i=[];for(var n in t)if(t.hasOwnProperty(n)){var o=e?e+"["+n+"]":n,a=t[n];i.push("object"==typeof a?serialize(a,o):encodeURIComponent(o)+"="+encodeURIComponent(a))}return i.join("&")},send:function(){var e,i,n={},o=this._settings,a=t.location.protocol,s=this,r=function(){return!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)},c=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],l=function(t,e){n[t.toLowerCase()]=e},d=function(){if(o.data&&"GET"!=o.type.toUpperCase()&&l("Content-Type",o.contentType),!o.ignoreHeaders&&(o.crossDomain||l("X-Requested-With","XMLHttpRequest"),l("Accept",o.accepts[o.dataType]||"*/*"),"undefined"!=typeof o.headers))for(var t in o.headers)o.headers.hasOwnProperty(t)&&l(t,o.headers[t])},f=function(){return new XDomainRequest},u=function(){for(var t=null,e=-1;++e<c.length;){try{t=c[e]()}catch(i){continue}break}return t},p=function(){if(4==this.readyState){var i,n="function"==typeof s._failCallback?s._failCallback:function(){t.console&&console.log("Request failed: ",arguments)},r="function"==typeof s._successCallback?s._successCallback:function(){t.console&&console.log("Request successful: ",arguments)};this.onreadystatechange=null,this.status>=200&&this.status<300||304==this.status||0===this.status&&"file:"==a?(i=e.responseText,r(i,this,o)):(n(this.statusText||null,this.status?"error":"abort",this,o),++s._attempts<s._settings.retryThreshold&&s.send())}},h=function(){var e,i="function"==typeof s._successCallback?s._successCallback:function(){t.console&&console.log("Request successful: ",arguments)};e=this.responseText,i(e,this,o)},m=function(){var e="function"==typeof s._failCallback?s._failCallback:function(){t.console&&console.log("Request failed: ",arguments)};e(this.statusText||null,"error",this,o)};if(d(),"jsonp"==o.dataType)return this.sendJSONP();if("postRelay"===o.dataType)return this.sendRelay();if(o.crossDomain||(urlAnchor=document.createElement("a"),urlAnchor.href=o.url,urlAnchor.href=urlAnchor.href,o.crossDomain=window.location.protocol+"//"+window.location.host!=urlAnchor.protocol+"//"+urlAnchor.host),this.isIE6to10()&&o.crossDomain&&!this.isXHRCorsSupported())i=f(),i.onload=h,i.onerror=m,i.onprogress=function(){},i.ontimeout=function(){},i.open(o.type,o.url),o=this._prepareData(o),i.send(o.data);else{e=u(),!r()&&e.responseType&&(e.responseType=o.responseType),e.onreadystatechange=p,e.open(o.type,o.url,o.async),o.useCookies&&(e.withCredentials=!0),e.timeout=o.timeout,d();for(name in n)n.hasOwnProperty(name)&&e.setRequestHeader(name,n[name]);o=this._prepareData(o),e.send(o.data)}return this},sendJSONP:function(){var i,n=this._settings,o=!1,a=this,s="function"==typeof a._failCallback?a._failCallback:function(){t.console&&console.log("Request failed: ",arguments)},r="function"==typeof a._successCallback?a._successCallback:function(){t.console&&console.log("Request successful: ",arguments)},c=function(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")},l=function(){document.head&&u.parentNode&&document.head.removeChild(u),e&&e.jsonpCallbackData&&n.jsonpCallback in e.jsonpCallbackData?1==e.jsonpCallbackData[n.jsonpCallback]?(delete e.jsonpCallbackData[n.jsonpCallback],t[n.jsonpCallback]=void 0):e.jsonpCallbackData[n.jsonpCallback]--:t[n.jsonpCallback]=void 0},d=function(e){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState?t.console&&t.console.log("OTHER STATES jsonp: ",this.readyState):(o=!0,u.onload=u.onerror=u.onreadystatechange=null,l(),"type"in e&&"error"==e.type&&(i&&clearTimeout(i),s(null,e.type,u,n)))},f=function(){s(null,"error",u,n),l()};!n.cache&&n.appendJsonpCallback&&(n.url=c(n.url,"_="+(new Date).getTime())),n.appendJsonpCallback&&(n.url=c(n.url,"callback="+n.jsonpCallback));var u=document.createElement("script");return u.type="text/javascript",u.onload=u.onerror=u.onreadystatechange=d,t[n.jsonpCallback]=function(){if(arguments&&1==arguments.length){var t=arguments[0];r(t,u,n)}else s(null,"error",u,n);i&&clearTimeout(i)},e&&(e.jsonpCallbackData=e.jsonpCallbackData||{},e.jsonpCallbackData[n.jsonpCallback]=n.jsonpCallback in e.jsonpCallbackData?++e.jsonpCallbackData[n.jsonpCallback]:1),u.src=n.url,i=setTimeout(f,n.timeout),document.head.appendChild(u),this},sendRelay:function(t){var e=this._settings;e.callback="function"==typeof t?t:"function"==typeof this._successCallback?this._successCallback:function(){},this._prepareData(e),this.relay.post(e.data,e.url,e.callback)},done:function(t){return"function"==typeof t?(this._successCallback=t,this):void 0},fail:function(t){return"function"==typeof t?(this._failCallback=t,this):void 0},_setSettings:function(t){this._settings=this._extend(e.defaults,t||{})},_extend:function(){var t=-1,e={};if(!arguments)return{};for(;++t<arguments.length;){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}},"undefined"!=typeof define&&"undefined"!=typeof define.amd?define("mybbc/notifications/request",["mybbc/notifications/vendor/relay"],function(t){return t&&e._setupRelay(t),e}):"undefined"!=typeof module&&"undefined"!=typeof module.exports?exports=e:t.request=e}(this),define("mybbc/notifications/NotificationLoader",["require","mybbc/notifications/config","mybbc/notifications/request"],function(t){var e=t("mybbc/notifications/config"),i=t("mybbc/notifications/request"),n=function(){this._currentChunkIndex=0,this.isLoading=!1,this.pollingIntervalId,this.url,this.request=i};return n.prototype.startPolling=function(t,i,n){var o=this;this.pollingStarted()||(this.pollingIntervalId=setInterval(function(){o.loadNotifications(t,i,n)},e.env.notificationsPollingInterval))},n.prototype.loadNotifications=function(t,e,i){this.url=t;var n=new this.request(this._getRequestParams(i)),o={notifications:[]},a=null,s=this;n._successCallback=function(t,i,n){a=t,"function"==typeof e&&s._onSuccess(e,a,o,i)},n._failCallback=function(t,i,n){e(!0,"notificationloader.load.error",i)},n.send()},n.prototype._onSuccess=function(t,e,i,n){try{null!==e&&(e="object"==typeof e?e:JSON.parse(e.trim()),"undefined"==typeof e.notifications?i.notifications=e:i=e),t(null,i,n.status)}catch(o){t(!0,"notificationloader.parse.error",n.status)}},n.prototype.pollingStarted=function(){return"number"==typeof this.pollingIntervalId},n.prototype._getRequestParams=function(t){var e=this,i={contentType:"application/json",type:"GET",dataType:"jsonp",url:e.url,jsonpCallback:"colbertCallback",timeout:1e4};if("undefined"!=typeof t)for(var n in t)i[n]=t[n];return i},n}),function(t){function e(t,e){var i;"number"!=typeof t&&(i=t,t=32*i.length);var n=Math.ceil(t/32),o=-1;if(this.m=t=32*n,this.k=e,a){var s=1<<Math.ceil(Math.log(Math.ceil(Math.log(t)/Math.LN2/8))/Math.LN2),r=1===s?Uint8Array:2===s?Uint16Array:Uint32Array,c=new ArrayBuffer(s*e),l=this.buckets=new Int32Array(n);if(i)for(;++o<n;)l[o]=i[o];this._locations=new r(c)}else{var l=this.buckets=[];if(i)for(;++o<n;)l[o]=i[o];else for(;++o<n;)l[o]=0;this._locations=[]}}function i(t){return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function n(t){for(var e,i,n=t.length,o=2166136261,a=-1;++a<n;)e=t.charCodeAt(a),(i=4278190080&e)&&(o^=i>>24,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),(i=16711680&e)&&(o^=i>>16,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),(i=65280&e)&&(o^=i>>8,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),o^=255&e,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return o+=o<<13,o^=o>>7,o+=o<<3,o^=o>>17,o+=o<<5,4294967295&o}function o(t){return t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24),t+=t<<13,t^=t>>7,t+=t<<3,t^=t>>17,t+=t<<5,4294967295&t}t.BloomFilter=e,t.fnv_1a=n,t.fnv_1a_b=o;var a="undefined"!=typeof ArrayBuffer;e.prototype.locations=function(t){for(var e=this.k,i=this.m,a=this._locations,s=n(t),r=o(s),c=-1,l=s%i;++c<e;)a[c]=0>l?l+i:l,l=(l+r)%i;return a},e.prototype.add=function(t){for(var e=this.locations(t+""),i=-1,n=this.k,o=this.buckets;++i<n;)o[Math.floor(e[i]/32)]|=1<<e[i]%32},e.prototype.test=function(t){for(var e,i=this.locations(t+""),n=-1,o=this.k,a=this.buckets;++n<o;)if(e=i[n],0===(a[Math.floor(e/32)]&1<<e%32))return!1;return!0},e.prototype.size=function(){for(var t=this.buckets,e=0,n=0,o=t.length;o>n;++n)e+=i(t[n]);return-this.m*Math.log(1-e/this.m)/this.k},define("mybbc/notifications/vendor/bloomfilter",[],function(){return e})}("undefined"!=typeof exports?exports:this),define("mybbc/notifications/BloomFilterManager",["require","mybbc/notifications/vendor/bloomfilter","mybbc/notifications/logger","mybbc/notifications/utils"],function(t){var e=t("mybbc/notifications/vendor/bloomfilter"),i=new(t("mybbc/notifications/logger"))("Bloom Filter Manager"),n=new(t("mybbc/notifications/utils"))(i),o=8192,a=function(t){this.filterName=t,this.filter=new e(o,16)};return a.prototype.override=function(t){"string"==typeof t&&""!==t&&(t=n.handledParse(t,[])),n.isArray(t)&&0===t.length&&(t=o),this.filter=new e(t,16)},a.prototype.add=function(t){t&&""!==t&&this.filter.add(t)},a.prototype.getCleanArray=function(){return[].slice.call(this.filter.buckets)},a.prototype.contains=function(t){return t&&""!==t?this.filter.test(t):!1},a.prototype.checkOrAdd=function(t){t&&""!==t&&(this.contains(t)||this.add(t))},a}),define("mybbc/notifications/AccessibilityManager",["require","mybbc/notifications/eventie","mybbc/notifications/classie"],function(t){function e(t,e,i,n){var o=t.cloneNode(!0);return o.firstChild.innerHTML=e,o.firstChild.tabIndex=-1,o.firstChild.setAttribute("href","#"+i),o.firstChild.setAttribute("data-type",i),o.id=i,V.addEvent(o.firstChild,"click","function"==typeof n?function(){n.apply(w,arguments)}:function(){a(),E.focus(),k.tabIndex="0",setTimeout(function(){M.children[0].onblur=function(t){J||k.click()},E.focus()},1)}),o}function i(t){var i=document.querySelector(".orb-skip-links ul"),n=i.children[0];i.appendChild(e(n,"Load next","notifications-loadNext",t.nextActionCallback)),i.appendChild(e(n,"Go to top","notifications-gotoTop",t.gotoTopActionCallback)),i.appendChild(e(n,"Close","notifications-close")),D=document.querySelector(".notification-title"),O=document.querySelector(".notification-header-icons a"),F=document.getElementById("notifications-loadNext"),R=document.getElementById("notifications-gotoTop"),M=document.getElementById("notifications-close"),k=document.getElementById("notification-link")||{},E=document.querySelector("#orb-nav-links .orb-nav-news a")||{},C=document.querySelector(".notification-header-icons li a")||{},S=".notification-item",L=t._getdrawerStateChecker,I=t._getNotificationCollection,A=t.nextActionCallback,j=t.gotoTopActionCallback,N=t.closeActionCallback,t.iconHiddenTextEl&&null!==t.iconHiddenTextEl&&(U=t.iconHiddenTextEl),t.iconAriaLiveEl&&null!==t.iconAriaLiveEl&&(B=t.iconAriaLiveEl),G=L(),h(),o()}function n(t){q=document.querySelector(t),q&&(q.onfocus=function(t){var e=document.querySelector(".show .notifications-error__body");l(e),C.tabIndex=document.activeElement.tabIndex+1,k.tabIndex=document.activeElement.tabIndex})}function o(){k.onclick=function(t){if(_=!0,"hidden"!=G())if("disabled"==W&&h(),l(q?q:D),document.activeElement==k){C.tabIndex=1,C.focus(),a(),P=T=0,k.tabIndex=0}else document.activeElement.blur(),P=document.activeElement.tabIndex,T=P+1,C.tabIndex=T>0?T:1},k.onfocus=function(t){"shown"!=G()||_||(k.click(),y(),k.tabIndex=null,_=!1)},D.onfocus=function(t){var e=O;l(e),C.tabIndex=document.activeElement.tabIndex+1,k.tabIndex=document.activeElement.tabIndex},O.onfocus=function(t){H=document.querySelector(S);var e=H;l(e)},s()}function a(){document.getElementById(F.id).children[0].tabIndex=-1,document.getElementById(R.id).children[0].tabIndex=-1,document.getElementById(M.id).children[0].tabIndex=-1}function s(t){M.children[0].onblur=function(t){J||k.click()},M.children[0].onfocus=function(t){E.tabIndex=1},R.onfocus=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,C.focus()}}function r(t,e){switch(e){case"notifications-loadNext":"function"==typeof A&&A();break;case"notifications-gotoTop":"function"==typeof j&&j();break;case"notifications-close":M.children[0].onblur=null,E.focus(),k.tabIndex=null,setTimeout(function(){M.children[0].onblur=function(t){J||k.click()}},1e3),"function"==typeof N&&N()}}function c(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName}function l(t){c(t)&&(C=t)}function d(t){"undefined"!=typeof U&&(U.textContent=t)}function f(t){"undefined"!=typeof B&&(B.textContent=t)}function u(){return w={init:i,updateNextFocus:l,handleNotificationAccessClickEnterEvent:r,initAccessLinkEvents:s,checkIfLastInList:v,accessLinkEntered:!1,clearAccessLinkFocus:a,setErrorTitle:n,updateIconHiddenText:d,updateIconAriaLiveText:f}}function p(){return w||u()}function h(){V.addEvent(window,"keyup",m),V.addEvent(window,"keydown",g),null===E.onfocus&&(E.onfocus=function(t){P=0,this.tabIndex=0,y()}),W="enabled"}function m(t){if(t.preventDefault&&t.preventDefault(),9===t.keyCode){if(document.activeElement===E)return void y();P=document.activeElement.tabIndex,T=P+1,setTimeout(function(){v()},1)}}function g(t){return J=!1,t.shiftKey&&9===t.keyCode&&(J=!0,(document.activeElement==D||document.activeElement==q)&&(J=!1,k.click(),k.tabIndex="0",E.tabIndex="1",E.focus(),y())),t.shiftKey||9!==t.keyCode||"#notifications-close"!==document.activeElement.getAttribute("href")?void(13==t.keyCode&&z.has(document.activeElement,"notification-item")&&document.activeElement.click()):(t.preventDefault(),!1)}function v(){var t=function(){var t=document.activeElement.nextSibling;return null!==t&&"div"==t.nodeName.toLowerCase()&&"no-notifications"==t.id};if(t()){switch(b()){case"02":l(document.getElementById(F.id)),F.firstElementChild.text="Load next",document.getElementById(R.id).firstElementChild.tabIndex=T+1,R.firstElementChild.text="Go to top",document.getElementById(M.id).firstElementChild.tabIndex=T+2;break;case"2":l(document.getElementById(R.id)),document.getElementById(M.id).firstElementChild.tabIndex=T+1,document.getElementById(F.id).firstElementChild.tabIndex=-1}C.firstElementChild&&(C.firstElementChild.tabIndex=T)}}function b(){var t="";return I().allPagesLoaded()||(t+="0"),t+="2"}function y(){E.onfocus=null,V.removeEvent(window,"keyup",m),V.removeEvent(window,"keydown",g),clearInterval(x),W="disabled"}var w,_,k,E,x,C,S,T,I,A,j,N,P,L,M,D,q,O,F,R,H,U,B,G,V=t("mybbc/notifications/eventie"),z=t("mybbc/notifications/classie"),W="disabled",J=!1;return{getInstance:p}}),function(t){function e(t){return function(t){return t.getHours()+":"+(t.getMinutes().toString().length<2?"0":"")+t.getMinutes()}(new Date(t))}function i(t){return l[new Date(t).getDay()]}function n(t){return d.toDateString()===new Date(t).toDateString()}function o(t){return 1==a(t)}function a(t){return new Date(t).getDay()-d.getDay()}function s(t){var e=new Date;return e.setDate(e.getDate()-t),e}function r(t){t instanceof Date==!1&&(t=new Date(t));var e=Math.abs(t.getTime()-d.getTime());return Math.ceil(e/864e5)}function c(t){d=new Date(t)}var l=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),d=new Date,f={getClockTime:e,getWeekday:i,isToday:n,isTomorrow:o,getDayDifference:a,howOld:r,goBackDays:s,setTime:c,serverTime:d};"undefined"!=typeof define&&define.amd?define("mybbc/notifications/DateManager",[],function(){return f}):"undefined"!=typeof f?module.exports=f:t.DateManager=f}(this),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/PreferencesClient",["require","mybbc/notifications/logger","mybbc/notifications/utils"],function(t){var i=new(t("mybbc/notifications/logger"))("Preferences Client"),n=new(t("mybbc/notifications/utils"))(i);return e(n,i)}):"undefined"!=typeof exports?module.exports=e():t.PreferencesClient=e()}(this,function(t,e){var i=function(e,n){this.requestClient=e,this.settings=t.extend(i.defaults,n),this._setRequestMap(this._getConfig()),this.setLastRequestInfo({error:!1})};return i.defaults={},i.prototype={fetch:function(t){this.callback=t,this._call(this._isCORSBrowser()?"get":"getJSONP",{},this._preferencesRequestSuccessCallback(),this._preferencesRequestErrorCallback())},updatePreferences:function(t,e){return this._preferencesDataValid(t)?(this.callback=e,void this._call(this._isCORSBrowser()?"postPreference":"postPreferenceRelay",t,this._preferencesRequestSuccessCallback(),this._preferencesRequestErrorCallback())):null},_isXHRCorsSupported:function(){return"undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest},_call:function(t,e,i,n){var o=this._getRequestParams(t);"undefined"!=typeof e&&(o.data=e),"postRelay"===o.dataType&&(o.callback=this.callback),req=this.requestClient.create(o),req.done(i).fail(n).send()},_getRequestParams:function(t){return t in this.requestMap?this.requestMap[t]:{}},_setRequestMap:function(t){this.requestMap={get:{url:t.env.preferencesUrls.get,useCookies:!0,ignoreHeaders:!0,dataType:"json"},getJSONP:{url:t.env.preferencesUrls.get,useCookies:!0,ignoreHeaders:!0,dataType:"jsonp",jsonpCallback:"preferencesCallback"+Date.now()},postPreference:{type:"POST",url:t.env.preferencesUrls.postPreference,useCookies:!0,ignoreHeaders:!0,dataType:"json",contentType:"application/json"},postPreferenceRelay:{type:"POST",url:t.env.preferencesUrls.postPreferenceRelay,useCookies:!0,ignoreHeaders:!0,dataType:"postRelay",contentType:"application/json"}}},_preferencesRequestSuccessCallback:function(){var i=this;return function(n){var o,a,s=arguments.length>0?Array.prototype.slice.call(arguments):[];s.unshift(null);try{o="object"==typeof n?n:t.handledParse(""===n?"{}":n),hasError="status"in o&&200!=o.status,hasError&&(a="preferences.jsonp.call.error."+o.status,e.error(a),i.setLastRequestInfo({error:!0,info:a})),"function"==typeof i.callback&&(i.callback.call(i,null,o.response||o),i.setLastRequestInfo({error:!1,info:o.response||o}))}catch(r){e.error("Error caught after fetching preferences",r),"function"==typeof i.callback&&i.callback.call(i,!0,r),i.setLastRequestInfo({error:!0,info:r})}}},_preferencesRequestErrorCallback:function(){var t=this;return function(e,i,n){var o=arguments.length>0?Array.prototype.slice.call(arguments):[];o.unshift(!0),t.setLastRequestInfo({error:!0,info:o}),"function"==typeof t.callback&&t.callback.apply(t,o)}},getLastRequestInfo:function(){return this.lastRequestInfo},setLastRequestInfo:function(t){this.lastRequestInfo=t},_isCORSBrowser:function(){return this._isXHRCorsSupported()&&-1===window.navigator.userAgent.indexOf("Automated Test UserAgent")},_preferencesDataValid:function(t){var i="undefined"!=typeof t&&"undefined"!=typeof t.readFilter&&"undefined"!=typeof t.lastReadFlag;return i||e.error("Preferences data validation failed",t),i},_getConfig:function(){return this.settings.config||{}}},i}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/LocalStorageCache",e):"undefined"!=typeof exports?module.exports=e():t.LocalStorageCache=e()}(this,function(){var t=function(t){var e="mybbc_notifications_";return{get:function(){return NotificationsModernizr.localstorage?localStorage.getItem(e.concat(t)):null},put:function(i){NotificationsModernizr.localstorage&&localStorage.setItem(e.concat(t),i)},clear:function(){NotificationsModernizr.localstorage&&localStorage.removeItem(e.concat(t))}}};return t}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/StorageManager",["mybbc/notifications/config","mybbc/notifications/utils","mybbc/notifications/LocalStorageCache"],e):"undefined"!=typeof exports?module.exports=e():t.StorageManager=e()}(this,function(t,e,i){var n=new e,o=function(t){this.storeKey=t,this.storeKeyCache=i(this.storeKey),this.lockCache=i("lockPolling"),this.initialised=!1};return o.prototype={model:{cacheTimeout:null,preferences:null,subscriptions:null},init:function(){
this.params={cacheTimeout:t.env.cacheTimeout,cachedData:this.getCached(),preferencesPollingInterval:NotificationsModernizr.localstorage?t.env.preferencesPollingInterval:2*t.env.preferencesPollingInterval},this.initialised=!0},getCached:function(){var t=this.get();return"object"!=typeof t&&""!==t&&null!==t?n.handledParse(t,this.model):t},hasCache:function(){return this.getCached()!==this.model},checkExpired:function(){return this.hasExpired(this.params.cachedData)},lock:function(e){this.lockCache.put(JSON.stringify({locked:e,timestamp:Date.now()+t.env.lockExpiry}))},unlock:function(){this.lock(!1)},get:function(t){var e=this.storeKeyCache.get();return e=e?n.handledParse(e,this.model):this.model,t&&delete e.cacheTimeout,e},clear:function(){this.storeKeyCache.clear(),this.lockCache.clear(),this.init()},set:function(t){var e=this.clone(t);(!e||"string"==typeof e&&""===e)&&(e=this.model),e.cacheTimeout||(e.cacheTimeout=Date.now()+this.params.cacheTimeout),this.storeKeyCache.put(JSON.stringify(e)),this.unlock(),this.params.cachedData=this.getCached()},hasExpired:function(t){return NotificationsModernizr.localstorage?!t.cacheTimeout||new Date-new Date(t.cacheTimeout)>=0:!0},isLocked:function(){if(!NotificationsModernizr.localstorage)return!1;var t=this.lockCache.get();return t=t?n.handledParse(t,{locked:!1,timestamp:Date.now()}):{locked:!1,timestamp:Date.now()},new Date-new Date(t.timestamp)>=0?(this.unlock(),!1):t.locked},clone:function(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}},o}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/UserPreferences",["require","mybbc/notifications/StorageManager","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/DateManager"],function(t){var i=t("mybbc/notifications/StorageManager"),n=new(t("mybbc/notifications/logger"))("UserPreferences"),o=new(t("mybbc/notifications/utils"))(n),a=t("mybbc/notifications/DateManager");return e(i,o,n,a)}):"undefined"!=typeof exports?module.exports=e(require("StorageManager"),require("utils"),require("logger"),require("dateManager")):t.UserPreferences=e(StorageManager,utils,logger,dateManager)}(this,function(t,e,n,o){var a=function(i){var n=this;this.settings=e.extend(a.defaults,i),this.client=this.settings.client,this.cacheManager=this.settings.cacheManager||new t("cachedPreferences"),this.cacheManager.initialised||this.cacheManager.init(),this.defaultAttributes={subscriptions:[],preferences:{lastRead:o.goBackDays(n.client._getConfig().env.maxNotificationAge).toISOString(),readFilter:this.settings.filter.getCleanArray(),productsEnabled:a.defaultProductsEnabled}},this.attributes=e.extend(this.defaultAttributes),this.setFetchLastCallInfo({error:!1})};return a.defaultProductsEnabled=[{product:"IPLAYER",enabled:!0},{product:"MUSIC",enabled:!0}],a.HAS_ON_BOARDED_PARAM_NAME="hasOnboarded",a.defaults={},a.prototype={get:function(t){return NotificationsModernizr.localstorage?(this.attributes=e.extend(this.attributes,this.cacheManager.get(t),!0),this.attributes):this.attributes},set:function(t){null!==t.preferences&&"undefined"!=typeof t.preferences.productsEnabled&&this.fixProductsEnabledData(t),this.attributes=e.extend(this.attributes,t,!0),NotificationsModernizr.localstorage&&this.cacheManager.set(this.attributes),n.info("Updated localStorage/object cache with new preferences data",this.attributes)},fixProductsEnabledData:function(t){var i,n=a.defaultProductsEnabled.slice();i=null!==t.preferences.productsEnabled?t.preferences.productsEnabled:[],e.forEach(n,function(t){e.forEach(i,function(e){t.product===e.product&&(t.enabled=e.enabled)},this)}),t.preferences.productsEnabled=n},fetch:function(t){var e=this;!this.cacheManager.checkExpired()||this.cacheManager.isLocked()?(n.info("Serving user preferences from localStorage"),t(null,e.get(!0))):this.callService(t)},callService:function(t){var e=this;this.client.fetch(function(i,o){return e.setFetchLastCallInfo(e.client.getLastRequestInfo()),i?(n.log("Error reading user preferences",arguments),t(!0,e.get(!0))):(n.info("Successfully fetched user preferences from service",o),e.cacheManager.lock(!0),e._saveData(o),void t(null,o))})},poll:function(t){this.isPolling=!0;var e=this,i=this.cacheManager.params.preferencesPollingInterval;this.cacheManager.params.pollingFn=function(){e.fetch(t)},setInterval(this.cacheManager.params.pollingFn,i),n.info("Polling on user preferences started, it will happen every %s seconds, next polling is at [%s]",i/1e3,new Date(Date.now()+i))},sync:function(t,i){var o=this,a=this.get(!0);a.preferences=e.extend(a.preferences,{readFilter:this.settings.filter.getCleanArray()},{lastReadFlag:!1},t.preferences,!0),this.client.updatePreferences(this._prepareData(a.preferences),function(t,s){"string"==typeof t&&(t=e.handledParse(t,!0)),t&&void 0===t.status?(n.error("Error syncing user preferences",arguments),"function"==typeof i&&i(!0,s)):(t=null===t?{status:200}:t,t.status>304?(n.error("Error syncing user preferences",arguments),"function"==typeof i&&i(!0,s)):(a.preferences.lastRead=(new Date).toISOString(),a.preferences.currentDateTime=(new Date).toISOString(),delete a.lastReadFlag,o.set(a),n.info("Success syncing preferences",s),"function"==typeof i&&i(null,s)))})},updateProductEnabled:function(t,e,n){var o=this.get().preferences,a=!1,s={product:t.toUpperCase(),enabled:e};for(i=0;i<o.productsEnabled.length;i++)t.toUpperCase()==o.productsEnabled[i].product&&(a=!0,o.productsEnabled[i].enabled=e);a||o.productsEnabled.push(s),this.sync({preferences:{productsEnabled:o.productsEnabled.slice()}},n)},getProducts:function(){var t=this.get().preferences;return t.productsEnabled},getEnabledProducts:function(){for(var t=this.getProducts(),e=[],i=0;i<t.length;i++)t[i].enabled&&e.push(t[i].product);return e},updateUserOnBoarding:function(t){this.sync({preferences:{hasOnboarded:!0,lastReadFlag:!0}},t)},_prepareData:function(t){var i=e.extend({},t);return"object"==typeof t.readFilter&&t.readFilter instanceof Array&&(i.readFilter=JSON.stringify(t.readFilter)),delete i.lastRead,delete i.currentDateTime,i},_saveData:function(t){this.set(t),null!==t.preferences&&"undefined"!=typeof t.preferences.readFilter&&this.settings.filter.override(t.preferences.readFilter)},_getActiveSubscriptions:function(t){var i={};return(t=t||this.get(!0).subscriptions)?(e.forEach(t,function(t){t.enabled&&(i[t.topic]=t)},this),i):i},setFetchLastCallInfo:function(t){this.fetchLastCallInfo=t},getFetchLastCallInfo:function(){return this.fetchLastCallInfo}},a}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/popup",["mybbc/notifications/classie","mybbc/notifications/eventie"],e):"undefined"!=typeof exports?module.exports=e(require("classie"),require("eventie")):t.NotificationCollection=e(classie,eventie)}(this,function(t,e){var i={unseenLatestDataCount:0,state:"hidden",lastWrapperScrollPos:0,defaults:{showDuration:2},eventie:e,classie:t,init:function(t){t=t||{},this.el=t.el||null,this.containerEl=t.containerEl||null,this.notificationItemsSelector=t.notificationItemsSelector||null,this.wrapperEl=t.wrapperEl||null,this.mainApp=t.mainApp||null,this.showDuration=t.showDuration||this.defaults.showDuration||null,this.setEventListeners()},setEventListeners:function(){this.eventie.addEvent(this.el,"click",this._onNotificationPopupClicked())},html:function(t){this.el.innerHTML=t},check:function(){var t=this;if(0!==this.unseenLatestDataCount)return this.wrapperEl.scrollTop>=this._getLatestAddedItemHeights()-15&&"hidden"!=this.mainApp.getDrawerState()?(this.html(this.unseenLatestDataCount+" NEW notification(s)"),"shown"!=this.state?this.show():void(this.wrapperEl.scrollTop<this.lastWrapperScrollPos&&!this.hideTimeout&&(this.hideTimeout=setTimeout(function(){"hidden"!=t.state&&t.hide()},2e3)))):void("hidden"!=this.state&&this.hide())},_getLatestAddedItemHeights:function(){for(var t,e=0,i=document.querySelectorAll(this.notificationItemsSelector),n=-1;++n<this.unseenLatestDataCount&&(t=i[n]);)e+=t.offsetHeight;return e},_onNotificationPopupClicked:function(){var t=this;return function(e){t.wrapperEl.scrollTop=0,t.hide()}},hide:function(){this.classie.remove(this.containerEl,"has-new"),this.state="hidden",this.hideTimeout&&clearTimeout(this.hideTimeout),this.unseenLatestDataCount=0},show:function(){this.classie.add(this.containerEl,"has-new"),this.state="shown",this.lastWrapperScrollPos=this.wrapperEl.scrollTop}};return i}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/collections/AbstractCollection",["mybbc/notifications/eventie","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("eventie"),require("mybbc/notifications/eventie")):t.AbstractCollection=e(eventie,utils)}(this,function(t,e){var i=new e,n=function(t,e){t=t||[],this.models=t,this.eventCallbacks={},this.modelIds=Array.prototype.concat.call([],Array.prototype.map.call(t,function(t){return t.id}))||[],this.initialise(e)};return n.extend=function(t){var e=function(){n.apply(this,arguments)};return t=t||{},e.prototype=i.extend(new n(t.models),t),e.prototype.constructor=e,e},n.prototype={url:"",model:null,initialise:function(t){return this},setUrl:function(t){this.url=t},toJSON:function(){var t=[];return this.isEmpty()?t:(this.each(function(e,i){t.push(e.toJSON())}),t)},toArray:function(){return this.models},fetch:function(t){return this},bind:function(t){var e=this;return"undefined"!=typeof Function.prototype.bind?t.bind(this):function(){t.apply(e,arguments)}},parse:function(t){return t},filter:function(){return this},success:function(){return this},fail:function(){return this},first:function(){return this.isEmpty()?[]:this.models.slice(0,1)[0]},last:function(){return this.isEmpty()?[]:this.models.slice(-1)[0]},at:function(t){return this.isEmpty()?[]:this.models.slice(t,t+1)[0]},indexOf:function(t){var e=-1;return this.each(function(i,n){i.id==t&&(e=n)}),e},isEmpty:function(){return 0===this.models.length},add:function(t){return this},each:function(t){if(!this.isEmpty()){var e=Array.prototype.forEach||function(t){for(var e=(this.length,-1);++e<this.length;)t(this[e],e)};e.call(this.models,t)}},has:function(t){return this.modelIds.indexOf(t)>=0},on:function(e,i,n){var o;n=n||null,i=i||function(){},o=this.getEventCallbackHash(e,i),this.eventCallbacks[o]=function(t){i.call(n,t,t.data)},t.addEvent(document,e,this.eventCallbacks[o])},off:function(e,i,n){var o;o=this.getEventCallbackHash(e,i),o in this.eventCallbacks&&t.removeEvent(document,e,this.eventCallbacks[o])},trigger:function(e,i,n){t.triggerEvent(document,e,i,n)},getEventCallbackHash:function(t,e){return escape(t+e.toString().slice(0,150))}},n}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/models/AbstractModel",e):"undefined"!=typeof exports?module.exports=e():t.AbstractModel=e()}(this,function(){function t(){var t=-1,e={};if(!arguments)return{};for(;++t<arguments.length;){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}var e=function(t,e){this.attributes=t||{},this.id=this.attributes[this.idAttribute]||void 0,this.initialise(e)};return e.extend=function(i){var n=function(){e.apply(this,arguments)};return i=i||{},n.prototype=t(new e(i.models),i),n.prototype.constructor=n,n},e.prototype={idAttribute:"id",initialise:function(t){return this},toJSON:function(){return this.attributes},get:function(t){return"undefined"!=typeof this.attributes[t]?this.attributes[t]:void 0},set:function(t,e){this.attributes[t]=e},fill:function(t){if(this.attributes=t,!(this.idAttribute in this.attributes))throw new Error("Can not fill model with no id");this.id=this.attributes[this.idAttribute]},isEmpty:function(){return 0===Object.keys(this.attributes).length}},e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/models/NotificationModel",["mybbc/notifications/models/AbstractModel"],e):"undefined"!=typeof exports?module.exports=e(require("AbstractModel")):t.NotificationCollection=e(AbstractModel)}(this,function(t){var e=t.extend({});return e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/collections/NotificationCollection",["mybbc/notifications/collections/AbstractCollection","mybbc/notifications/models/NotificationModel","mybbc/notifications/NotificationLoader","mybbc/notifications/config","mybbc/notifications/DateManager","mybbc/notifications/logger"],e):"undefined"!=typeof exports?module.exports=e(require("AbstractCollection"),require("NotificationModel"),require("NotificationLoader"),require("config"),require("DateManager"),require("logger")):t.NotificationCollection=e(AbstractCollection,NotificationModel,NotificationLoader,config,DateManager,Logger)}(this,function(t,e,i,n,o,a){var s=t.extend({model:e,baseUrl:n.env.feedAggregatedBaseUrl,url:n.env.feedAggregatedInitialFeed,urlTopic:"aggregated",maxNotificationAgeDays:n.env.maxNotificationAge,latestLoader:new i,loader:new i,logger:a.getLogger("NotificationCollection"),dateManager:o,state:{pageSize:n.env.visibleChunkAmount,lastItemShownModelId:null,errorThrown:!1,itemsToload:n.env.visibleChunkAmount,sortKey:"creationTimestamp",newItemsAddedCount:0,newLatestItemsAddedCount:0,endOfPagesReached:!1,endOfItemsReached:!1,reachedOldNotifications:!1},initialise:function(t){return t=t||{},this.latestUrl=this.url,this.userPreferencesModel=t.userPreferencesModel||{},this.initialFetch=!1,this.fetchInprogress=!1,this.modelIds=[],this.nextPageReadyCallback=null,this},getNextPage:function(t){this.nextPageReadyCallback=t,this.hasCachedModels()?this.checkCachedModels():this.reachedLastPage()||this.prepareFetch()},checkCachedModels:function(){this.getAvailableCachedItemsCount()<this.state.pageSize?this.reachedLastPage()?this.getPageFromCache(!0):this.prepareFetch():this.getPageFromCache()},getPageFromCache:function(t){t=t||!1,this.notify(),this.state.lastItemShownModelId=t?this.last().id:this.at(this.indexOf(this.state.lastItemShownModelId)+this.state.pageSize).id,t?(this.state.endOfItemsReached=!0,this.logger.info("Last page prepared from the collection cache (from previously loaded data)")):this.logger.info("Next page prepared from the collection cache (from previous calls)",this.state.lastItemShownModelId)},prepareFetch:function(){return this.fetchInprogress?void this.logger.warn("Attempt to get nextPage but previous fetch in progress"):(this.state.itemsToload=this.state.pageSize-this.getAvailableCachedItemsCount(),void this.fetch())},fetch:function(t){return this.logger.info("Fetching started, %s items to load:",this.state.itemsToload,"Fetch URL: "+this.getFullUrl()),t=t||{},this.success=t.success||this.success,this.fail=t.fail||this.fail,this.loader.loadNotifications(this.getFullUrl(),this.bind(this.onNotificationsLoaded),this.getLoadParams()),this.fetchInprogress=!0,this},getFullUrl:function(t){return this.baseUrl.replace(/\/?$/,"/")+this.urlTopic+"/"+(t?this.latestUrl:this.url)},hasCachedModels:function(){return this.getAvailableCachedItemsCount()>0},getAvailableCachedItemsCount:function(){var t=this.state.lastItemShownModelId,e=this.indexOf(t);return this.models.length-(e+1)},setUrlTopic:function(t){this.urlTopic=t},getLoadParams:function(){return{cache:!0,jsonpCallback:"_"+this.urlTopic.replace(":","_")+"_"+this.url.replace(/(:|-|\.)/g,"_")}},onNotificationsLoaded:function(t,e){var i;return t?(i=e||"notificationloader.error",this.fail(e,"pages")):void this.success(e,"pages")},success:function(t,e){var i;this.checkStartPolling(),i=this.parse(t),this.filterStartTime=Date.now(),this.logger.info("Applying filters to the loaded data [%s items]: ",i.length),i=this.applyFilters(i),this.filterEndTime=Date.now(),this.logger.info("Finished Applying filters to the loaded data [%s ms], [%s items accepted after filtering]",this.filterEndTime-this.filterStartTime,i.length),this.add(i,e).sort(),"pages"==e?this.handlePagesLoadSuccess(t):"latest"==e&&this.state.newLatestItemsAddedCount>0&&(this.logger.info("%s New notifications received (from latest.json)",this.state.newLatestItemsAddedCount),this.trigger("notification.latest.update",{content:this.toJSON().slice(0,Math.max(this.indexOf(this.state.lastItemShownModelId)+1,this.state.pageSize)),newLatestItemsCount:this.state.newLatestItemsAddedCount}))},handlePagesLoadSuccess:function(t){var e;return this.checkState(),e="undefined"!=typeof t.next&&"false"!=t.next&&!this.state.reachedOldNotifications&&this.userPreferencesModel.getEnabledProducts().length>0,this.setUrl(e?t.next:null),null===this.url?(this.fetchInprogress=!1,this.notify(),this._setEndOfPagesReached()):this.state.itemsToload>0?this.fetch():(this.logger.info("Fetching finished, %s items to load:",this.state.itemsToload,"Next URL to load: %s",this.getFullUrl()),this.fetchInprogress=!1,this.notify(),void(this.state.lastItemShownModelId=this.at(this.indexOf(this.state.lastItemShownModelId)+this.state.pageSize).id))},checkStartPolling:function(){this.initialFetch||(this.setLatestNotificationPolling(),this.initialFetch=!0)},setLatestNotificationPolling:function(){this.logger.info("Polling started to pull latest.json"),this.latestLoader.startPolling(this.getFullUrl(!0),this.bind(this.onLatestNotificationsLoaded),this.getLoadParams())},onLatestNotificationsLoaded:function(t,e){var i;return t?(i=e||"notificationloader.error",this.fail(e,"latest")):void this.success(e,"latest")},parse:function(t){return t.notifications},_getActiveSubscriptions:function(){var t="undefined"!=typeof this.userPreferencesModel.get()&&"subscriptions"in this.userPreferencesModel.get()?this.userPreferencesModel.get().subscriptions:[];return this.userPreferencesModel._getActiveSubscriptions(t)},applyFilters:function(t){return t=this.filterDataByProductsEnabled(t),t=this.filterDataByCreationDate(t),t=this.filterDataBySubscriptions(t)},isUserSubscribedToTopic:function(t,e){return t.topic[e]in this._getActiveSubscriptions()},isItemTopicCreatedAfterSubscribe:function(t,e){return new Date(t.creationTimestamp).getTime()>new Date(e).getTime()},filterDataByProductsEnabled:function(t){var e,i=this.userPreferencesModel.getEnabledProducts(),n=[];if(0===i.length)return[];for(var o in t)t.hasOwnProperty(o)&&(e=t[o],-1!=i.indexOf(e.product.toUpperCase())&&n.push(e));return n},filterDataBySubscriptions:function(t){var e,i,n,o=[],a=this,s=this._getActiveSubscriptions();for(var r in t)if(t.hasOwnProperty(r)){e=t[r],i=!1;for(var c=0;c<e.topic.length;c++)a.isUserSubscribedToTopic(e,c)&&(n=s[e.topic[c]].lastSubscribed||void 0,("undefined"==typeof n||a.isItemTopicCreatedAfterSubscribe(e,n))&&(i=!0));i&&o.push(e)}return o},filterDataByCreationDate:function(t){var e,i=this;return t.filter(function(t){return e=i.dateManager.howOld(t.creationTimestamp)<=parseInt(i.maxNotificationAgeDays,10),e||(i.state.reachedOldNotifications=!0),e})},sort:function(){var t=this;return this.models=this.models.sort(function(e,i){return"creationTimestamp"==t.state.sortKey?new Date(i.get(t.state.sortKey))-new Date(e.get(t.state.sortKey)):i.get(t.state.sortKey)-e.get(t.state.sortKey)}),this},add:function(t,e){for(var i,n=this,o=-1,a=0;++o<t.length;)i=t[o],n.has(i.id)||(n.modelIds.push(i.id),a++,n.models.push(new n.model(i)));return"latest"===e?this.state.newLatestItemsAddedCount=a:"pages"===e&&(this.state.newItemsAddedCount=a),this},checkState:function(){var t=this.state.itemsToload,e=this.state.newItemsAddedCount;this.state.itemsToload=e>=t?0:t-e},notify:function(){var t=this.state.lastItemShownModelId;this.logger.info('Next page prepared after fetching finished, triggering the "%s" event',"notification.new.page.ready"),this.trigger("notification.new.page.ready",{content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0}),"function"==typeof this.nextPageReadyCallback&&this.nextPageReadyCallback({content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0})},fail:function(t,e){this.checkStartPolling(),this.logger.error(t),this.fetchInprogress=!1,"pages"===e&&(0!==this.toArray().length||this.state.errorThrown?this.toArray().length>0&&(this.checkState(),this.notify(),this._setEndOfPagesReached()):(this.trigger("notification.load.error"),this.state.errorThrown=!0)),this.logger.error("Error loading notifications",t)},reachedLastPage:function(){return this.state.endOfPagesReached},hasItemsToLoad:function(){return!this.state.endOfItemsReached},_setEndOfPagesReached:function(){var t=this.indexOf(this.state.lastItemShownModelId),e=this.state.pageSize-this.state.itemsToload;this.logger.info("Reached the end of the pages, no more notification files to load"),this.state.lastItemShownModelId=this.at(t+Math.min(e,this.state.pageSize)).id,0===this.getAvailableCachedItemsCount()&&(this.state.endOfItemsReached=!0),this.state.endOfPagesReached=!0}});return s}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/analytics",["istats-1","mybbc/notifications/logger","mybbc/notifications/eventie","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("istats-1"),require("logger"),require("eventie")):t.Analytics=e(istats,logger,eventie)}(this,function(t,e,i,n){var o=e.getLogger("Notifications Analytics"),a=new n,s={track:function(e){return a.each(e,function(e,i){t.track(i,e),o.info("Analytics track",i,e)}),this},log:function(e,i,n){t.log(e,i,n),o.info("Analytics log event",e,i,n)},serialiseTopic:function(t){var e;return e=t.slice(0,5).join("!").replace(/urn:bbc:/g,"").replace(/:/g,"-"),e=t.length>5?e.concat("!more than 5"):e},listenTo:function(t,e,n){i.addEvent(t,e,a.bind(n,this))}};return s}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/SettingsView",["mybbc/notifications/classie","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/NotificationsTemplate"],e):"undefined"!=typeof exports?module.exports=e():t.SettingsView=e()}(this,function(t,e,i,n,o){var a=function(a){function s(t){t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}function r(t){C=t}function c(){return C}function l(){e.addEvent(x.settingIconEl,"click",d),e.addEvent(x.settingIconEl,"keydown",f)}function d(t){s(t),h()}function f(t){var e=t.which||t.charCode;e==A&&(this.enterPressed=!0)}function u(t){s(t),p()}function p(e){e="undefined"==typeof e?!0:e,c()!==L&&(x.errorView.changeView("hub"),t.remove(S,"show"),r(L),"function"==typeof x.stateChanged&&x.stateChanged(L,e))}function h(){E.loaded()?b():E.load(b)}function m(t){var e,i=this,n=!1,o=this.dataset&&this.dataset.product||this.getAttribute("data-product"),a=this.dataset&&!!this.dataset.enabled&&JSON.parse(this.dataset.enabled)||JSON.parse(this.getAttribute("data-enabled")),r=!a,c=x.mainApp.getUserPreferencesModel();if("keypress"===t.type){if(e=t.which||t.charCode,-1==[A,j].indexOf(e))return;s(t),n=!0}c.updateProductEnabled(o,r,function(t,e){t?v(t,r):g(i,r)})}function g(e,i){t[i?"add":"remove"](e,"show"),e.dataset?e.dataset.enabled=i:(e.setAttribute("data-enabled",i),e.setAttribute("aria-checked",i))}function v(t,e){var i="#settings-error-inner";x.errorView.showError({view:"settings",isInner:!0,closeEvent:function(){x.errorView.hideError("settings",!1),document.querySelector(".notification-title--js").tabIndex=document.activeElement.tabIndex+1},errorElID:i,closeEl:".notifications-error--inner__close"},function(t){"shown"===t&&e&&document.querySelector(i+" .notifications-error--inner__body").focus()}),I.error("Error syncing the user product settings",t)}function b(){var e,i=x.mainApp.getUserPreferencesModel().getProducts(),n=[];if(x.errorView.changeView("settings"),S.innerHTML=E.compile({baseAssetUrl:x.mainApp.basePath}),t.add(S,"show"),i.length){for(var o=0;o<i.length;o++)e=i[o],e=T.extend(e,{checked:e.enabled,show:e.enabled?"show":"",name:D[e.product]||e.product.toLowerCase()}),n.push(e);_(n)}else x.errorView.showError({extContainer:S,view:"settings",isInner:!1,closeEvent:u,errorElID:"#settings-error-main",closeEl:".notifications-error__back"}),I.error("Error getting the product info",null);"function"==typeof x.stateChanged&&x.stateChanged(P,!0),k()}function y(){var t='<div class="notifications-settings-item" each="{ item in items }"><div class="notifications-long-primer notifications-settings-text" tabindex="0">{{item.name}} Notifications</div><div class="notifications-settings-tickbox notifications-settings-tickbox--js {{item.show}}" tabindex="0" data-product="{{item.product}}" data-enabled ="{{item.checked}}" role="checkbox" aria-checked="{{item.checked}}"></div></div>';return t}function w(){x.riot.tag("notifications-settings-items",y(),function(t){this.items=t.items||[]})}function _(t){x.riot.mount("notifications-settings-items",{items:t||[]}),r(P)}function k(){var t=S.querySelector(".notifications__settings__back-btn--js"),i=S.querySelectorAll(".notifications-settings-tickbox--js");T.forEach(Array.prototype.slice.call(i),function(t){e.addEvent(t,"click",m),e.addEvent(t,"keypress",m)}),e.addEvent(t,"click",u),q.checkInitialFocus(),q.startListeners()}var E,x,C,S,T=new n,I=new i("Settings view"),A=13,j=32,N=9,P="shown",L="hidden",M={el:".notification-settings__container--js",settingIconEl:document.querySelector(".notifications__settings--js"),templateName:"settings"},D={IPLAYER:"iPlayer",MUSIC:"Music"};x=T.extend(M,a),S=document.querySelector(x.el),E=o.create(x.templateName),r(L),w();var q=function(){function t(t){var e=t.which||t.keyCode;e==A?a=Date.now():e==N&&(r=Date.now())}function i(t){var e=t.which||t.keyCode;e==N&&t.shiftKey&&(s(t),p())}var n,o={},a=Date.now(),r=Date.now(),c=2e3;return o.hasKeyPressedRecently=function(){var t=Date.now();return"undefined"!=typeof r&&c>t-r||"undefined"!=typeof a&&c>t-a},o.checkInitialFocus=function(){n=S.querySelector(".notification-title--js"),x.settingIconEl.enterPressed&&(n.focus(),x.settingIconEl.enterPressed=!1)},o.startListeners=function(){e.addEvent(S,"keydown",t),e.addEvent(n,"keydown",i)},o.stopListeners=function(){e.removeEvent(S,"keydown",t),e.removeEvent(n,"keydown",i)},o}();return{init:function(){l()},load:function(){h()},render:b,hide:p,setSettingsIconFocus:function(){q.hasKeyPressedRecently()&&x.settingIconEl.focus()}}};return a}),define("mybbc/notifications/app",["require","mybbc/notifications/vendor/riot.min","mybbc/notifications/NotificationLoader","mybbc/notifications/config","mybbc/notifications/BloomFilterManager","mybbc/notifications/classie","mybbc/notifications/AccessibilityManager","mybbc/notifications/DateManager","mybbc/notifications/PreferencesClient","mybbc/notifications/UserPreferences","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/popup","mybbc/notifications/collections/NotificationCollection","mybbc/notifications/analytics","mybbc/notifications/SettingsView","mybbc/notifications/request"],function(t){function e(){var t=function(){var t='<img class="loader-icon notifications-image <%=svg-animation-class%>" src="<%=spinnerUrl%>" alt="Spinner">';return NotificationsModernizr.svg&&NotificationsModernizr.cssanimations&&!y()?t.replace(/<%=spinnerUrl%>/g,bt.baseAssetUrl+"svg/loader.svg").replace(/<%=svg-animation-class%>/g,"spinner__img--svg"):t.replace(/<%=spinnerUrl%>/g,bt.baseAssetUrl+"img/loader/32px/34px_Icon32px_Lively_Dark.gif").replace(/<%=svg-animation-class%>/g,"")},e='<ul class="notification-items" aria-live="polite" aria-relevant="additions" aria-atomic="true"> <li class="notification-item notification__item--js { item.newItem }" each="{ item in items }" tabIndex="{ parent.getIndex() }"> <a href="{ item.notification.url }" title="{ item.notification.title }" tabindex="-1"><div class="notification-icon-and-dot notifications-1/12 notification-{item.product.toLowerCase()}"><div class="notifications-image notification-{ item.product.toLowerCase() }-icon"> </div> <span class="notification-dot { item.newItem }"> </span></div><div class="notification-text notifications-11/12 { item.newItem }"> <div class="notification-title-items"> <div class="notifications-7/12"><p class="notification-text-body notifications-long-primer"> { parent.generateDescription(item) } </p></div><div class="notifications-4/12"> <img class="notifications-image notification-clock-icon notification-type-{ item.type }" src="<%=baseAssetUrl%>svg/clock.svg" alt="{ item.notification.description  } { parent.decodeDate(item.creationTimestamp) }" onerror="this.src=\'<%=baseAssetUrl%>img/clock.png\'; this.onerror=null;"></img><span class="notification-episode-name notifications-brevier">{ parent.manageText(item) }</span><span class="notification-time notifications-brevier">{ parent.decodeDate(item.creationTimestamp) }</span> </div></div></div></a></li><div id="no-notifications" class="no-notifications visible-{ items.length > 0 }"><p tabindex="988" class="notifications-long-primer"> No notifications right now. We’ll let you know when something from your favourite programmes, artists and playlists is available for you. </p><p tabindex="989" class="notifications-long-primer">If your notifications are turned off, you can always turn them back on, just go to settings.</p></div><div class="clearfix"></div></ul><div class="spinner">'+t()+"</div>";return e.replace(/<%=baseAssetUrl%>/g,bt.baseAssetUrl||"")}function i(){at.tag("notificationamount","{ notificationamount }",function(t){this.notificationamount=t.amount||"no"}),at.tag("notifications",e(),function(t){this.items=t.items,this.decodeDate=function(t){var e=new Date(t),i=new Date(U),n=Math.floor(Math.abs(i-e)/36e5),o=Math.floor(Math.abs(i-e)/6e4);Math.floor(Math.abs(i-e)/1e3);return n>23&&48>n?"Yesterday":n>=48&&168>n?(n/24).toFixed(0)+" days ago":n>0?n+" hour{{plural}} ago ".replace("{{plural}}",1===n?"":"s"):o>0?o+" minute{{plural}} ago ".replace("{{plural}}",1===o?"":"s"):"Just now"};var e=0;this.getIndex=function(){return++e},this.generateDescription=function(t){var e="";return e="EPISODE_EXPIRY"===t.type||"episode-expiry-today"===t.type?t.notification.title+" episode "+function(e){return ft.isToday(e)?(t.type="episode-expiry-today",["expires today at ",ft.getClockTime(e),". Don't miss out!"].join(" ")):ft.isTomorrow(e)?["expires tomorrow at ",ft.getClockTime(e),". Don't miss out!"].join(" "):ft.isToday(e)||ft.isTomorrow(e)?void 0:ft.getDayDifference(e)>0?["expires on ",ft.getWeekday(e)," at ",ft.getClockTime(e),". Don't miss out!"].join(" "):0===ft.getDayDifference(e)?["expired today "," at ",ft.getClockTime(e),"."].join(" "):["expired on ",ft.getWeekday(e)," at ",ft.getClockTime(e),"."].join(" ")}(t.expires):t.notification.title},this.manageText=function(t){return t.notification.episode?ht.truncate(t.notification.episode):t.product[0].toUpperCase()+t.product.substring(1,t.product.length).toLowerCase()}})}function n(t){a(t),0===t.length?(_t=!0,o(t)):(_t=_t?!1:_t,at.mount("notifications",{items:t})),s(t)}function o(t){yt=t,at.mount("notifications",{items:[]})}function a(t){t=c(t)}function s(t){var e=document.querySelector(".notification-items");Q=l(t),Q>wt&&(lt.remove(document.getElementById("not-num"),"new-notifications"),lt.remove(document.getElementById("notification-link"),"swing"),W.offsetWidth,lt.add(J,"new-notifications"),lt.add(document.getElementById("notification-link"),"swing"),wt=Q),K.hide(),yt=t,$.check(z),mt.check(),gt.track({internal:{region:document.querySelectorAll(".notification__item--js"),linkLocation:"notifications"}}),M(e,function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;for(var e=t.target||t.srcElement;e&&e.tagName&&"li"!==e.tagName.toLowerCase();)e=e.parentNode;if(e&&e.parentNode){var i=[].indexOf.call(e.parentNode.children,e);lt.hasClass(e,"notification-new")&&wt--,X.checkOrAdd(V.at(i).id),gt.log("click","notifications-item",{notifications_id:V.at(i).id,notifications_state:""===V.at(i).get("newItem")?"read":"new",notifications_priority:(V.at(i).get("priority")||"normal").toLowerCase(),notifications_product:V.at(i).get("product").toLowerCase(),notifications_type:V.at(i).get("type").toLowerCase(),
notifications_title:V.at(i).get("notification").title,topic_name:gt.serialiseTopic(V.at(i).get("topic"))}),yt[i].newItem="",at.update(),"undefined"!=typeof X&&P({readFilter:"undefined"!=typeof X.filter?X.getCleanArray():null,lastReadFlag:!1},function(){"a"===e.firstElementChild.tagName.toLowerCase()&&window.location.assign(e.firstElementChild.href)})}}),at.update(),L("updateDrawerHeight"),r()}function r(){var t,e=dt.getInstance(),i=document.querySelectorAll(".notification__item--js");return e.accessLinkEntered?(t=yt.length-yt.length%Et,e.accessLinkEntered=!1,e.clearAccessLinkFocus(),void(i[t]&&i[t].focus())):(e.updateNextFocus(document.querySelector(".notification-item")),e.updateIconHiddenText(Q>0?"New notifications":"No new notifications"),void(kt>0&&("hidden"!==B.getDrawerState()?e.updateIconAriaLiveText("New Notification available."):e.updateIconAriaLiveText('New Notification. To view open the "Notification Panel" link.'))))}function c(t){for(var e=0,i=t.length;i>e;e++)X.contains(t[e].id)?t[e].newItem="":new Date(ot)-new Date(t[e].creationTimestamp)<0?t[e].newItem="notification-new":t[e].newItem="notification-unread";return t}function l(t){return t.filter(function(t){return"notification-new"===t.newItem}).length}function d(t){bt=ht.extend(vt,t||{}),this.setUserPreferencesModel(bt.userPreferencesModel),this.setReadFilter(bt.readFilter),z=document.getElementById("notifications-wrapper"),J=document.getElementById("not-num"),W=document.getElementById("notification-link"),R(),T(),i(),b(".spinner"),g(W),v({el:document.querySelector(".notifications-pop-up"),containerEl:document.querySelector(".notifications__header--js"),notificationItemsSelector:".notification__item--js",wrapperEl:z,mainApp:B}),h(),w(z),p(),f(bt.errorView),u()}function f(t){nt=t,nt.changeView("hub")}function u(){it=ct({riot:at,mainApp:B,errorView:nt,stateChanged:function(t,e){var i=document.querySelector(".notifications-main--js");i.style.display="shown"==t?"none":"block","hidden"===t&&it.setSettingsIconFocus(),"hidden"!==B.getDrawerState()&&e&&B.updateDrawerHeight()}}),it.init()}function p(){dt.getInstance().init({iconHiddenTextEl:W.querySelector(".hidden-span"),iconAriaLiveEl:W.querySelector(".notification-link__live--js"),_getdrawerStateChecker:function(){return function(){return B.getDrawerState.call(B)}},_getNotificationCollection:function(){return V},nextActionCallback:function(){q(O),K.show(),z.scrollTop=z.scrollHeight,V.getNextPage(),F(!0),this.accessLinkEntered=!0},gotoTopActionCallback:function(t){t.preventDefault&&t.preventDefault(),this.updateNextFocus(document.querySelector(".notification-item")),z.scrollTop=0}})}function h(){["resize","orientationchange"].forEach(function(t){(NotificationsModernizr.touchevents||"orientationchange"!==t)&&ut.addEvent(window,t,function(){et&&clearTimeout(et),et=setTimeout(m,100)})}),m()}function m(){var t,e,i,n=420;tt=window.innerWidth,Z=NotificationsModernizr.touchevents||y()?.75:.65,e=document.querySelector(".orb-nav-pri-container"),i=null!==e?e.offsetHeight:0,t=window.innerHeight*Z-i-document.querySelector(".notifications__header--js").offsetHeight,NotificationsModernizr.touchevents||y()||(t=Math.min(t,n)),z.style.maxHeight=t+"px",L("updateDrawerHeight"),$&&$.check(z)}function g(t){lt.add(t,"animated"),lt.add(t,"three")}function v(t){mt.init(t)}function b(t){K={selector:t,state:"hidden",getEl:function(){return document.querySelector(this.selector)||{style:{}}},hide:function(){this.getEl().style.display="none",this.setState("hidden")},show:function(){this.getEl().style.display="block",this.setState("shown"),L("updateDrawerHeight")},setState:function(t){this.state=t},getState:function(){return this.state}}}function y(){return-1!==navigator.appVersion.indexOf("Win")&&"undefined"!=typeof window.navigator.pointerEnabled&&null!==navigator.userAgent.match(/.+windows.+(touch|phone).+/i)}function w(t){$={enabled:!1,endOfScrollTimestamp:Date.now(),endOfScrollDelayMilliseconds:300,enable:function(t){ut.removeEvent(t,"scroll",S),ut.addEvent(t,"scroll",S),NotificationsModernizr.touchevents||y()?(ut.removeEvent(t,"touchstart",_),ut.removeEvent(t,"touchmove",k),ut.removeEvent(t,"pointerdown",_),ut.removeEvent(t,"pointermove",k),ut.addEvent(t,"touchstart",_),ut.addEvent(t,"touchmove",k),ut.addEvent(t,"pointerdown",_),ut.addEvent(t,"pointermove",k),lt.add(t,"notifications--touch")):(ut.removeEvent(t,"mousewheel",E),ut.addEvent(t,"mousewheel",E),ut.removeEvent(t,"mousewheel",S),ut.addEvent(t,"mousewheel",S),ut.removeEvent(t,"DOMMouseScroll",E),ut.addEvent(t,"DOMMouseScroll",E),ut.removeEvent(t,"DOMMouseScroll",S),ut.addEvent(t,"DOMMouseScroll",S)),lt.remove(t,"notifications-no-scroll"),this.enabled=!0},disable:function(t){ut.removeEvent(t,"scroll",S),NotificationsModernizr.touchevents||y()?(ut.removeEvent(t,"touchstart",S),ut.removeEvent(t,"touchmove",S),ut.removeEvent(t,"touchstart",_),ut.removeEvent(t,"touchmove",k),ut.removeEvent(t,"pointerdown",_),ut.removeEvent(t,"pointermove",k),lt.remove(t,"notifications--touch")):(ut.removeEvent(t,"mousewheel",E),ut.removeEvent(t,"DOMMouseScroll",E),ut.removeEvent(t,"mousewheel",S),ut.removeEvent(t,"DOMMouseScroll",S)),lt.add(t,"notifications-no-scroll"),lt.remove(document.querySelector("#notifications__header"),"shadowAdded"),this.enabled=!1},check:function(t){var e=function(){return t.offsetHeight>=parseInt(t.style.maxHeight,10)},i="notification__windows-scroll";return _t?void this.disable(t):void(e()||V.models.length>=rt.env.visibleChunkAmount?(this.enabled||this.enable(t),(NotificationsModernizr.touchevents||y())&&(t.tabIndex="0",t.style.outline="none",t.focus()),(-1!==navigator.appVersion.indexOf("Win")&&!y()||-1!==navigator.appVersion.indexOf("Linux"))&&lt.add(t,i)):(this.enabled&&this.disable(t),(-1!==navigator.appVersion.indexOf("Win")&&!y()||-1!==navigator.appVersion.indexOf("Linux"))&&lt.remove(t,i)))},_isSafari:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("safari")>-1&&-1===t.indexOf("chrome")},_checkFixSafari7Scroll:function(){var t;this._isSafari()&&(t=document.createElement("style"),t.type="text/css",t.innerHTML="#notifications-wrapper::-webkit-scrollbar {     -webkit-appearance: none;     width: 8px; }  #notifications-wrapper::-webkit-scrollbar-track {     background-color: transparent;     border-radius: 8px; }  #notifications-wrapper::-webkit-scrollbar-thumb {     border-radius: 8px;     background-color: rgba(0, 0, 0, .6); }",document.head.appendChild(t))},setEndOfScrollTimestamp:function(t){this.endOfScrollTimestamp=t},init:function(t){this._checkFixSafari7Scroll(),this.enable(t)}},$.init(t)}function _(t){Y=window.navigator.pointerEnabled?t.clientY:t.targetTouches[0].pageY}function k(t){var e=(this.scrollTop+30>=this.scrollHeight-this.offsetHeight,(window.navigator.pointerEnabled?t.clientY:t.changedTouches[0].pageY)-Y);y()&&(this.scrollTop-=(Math.abs(e)<10?20*(0>e?-1:1):e)/20),x.call(this,t,e)}function E(t){var e=t.wheelDelta||-t.detail;lt[this.scrollTop>0?"add":"remove"](document.getElementById("notifications__header"),"shadowAdded"),x.call(this,t,e)}function x(t,e){var i=this.scrollTop+30>=this.scrollHeight-this.offsetHeight;(i||"shown"===K.getState())&&0>=e&&(this.scrollTop=this.scrollHeight,C.call(this,t))}function C(t){var e;if(this.scrollTop+30>=this.scrollHeight-this.offsetHeight&&V.hasItemsToLoad()&&!V.fetchInprogress){if(Date.now()-$.endOfScrollTimestamp<$.endOfScrollDelayMilliseconds)return;if($.setEndOfScrollTimestamp(Date.now()),K.show(),V.getNextPage(),e=document.querySelectorAll(".notification__item--js"),e.length>0){var i=Array.prototype.slice.call(e,-1)[0];lt.add(i,"notification-border")}"function"==typeof t.preventDefault&&t.preventDefault()}}function S(t){mt.check(),lt[this.scrollTop>0?"add":"remove"](document.getElementById("notifications__header"),"shadowAdded"),y()||C.call(this,t)}function T(){I(function(t,e){return t?pt.error("Error:",e):void 0})}function I(t){"undefined"==typeof V&&(V=new st([],{userPreferencesModel:G}),V.on("notification.latest.update",A),V.on("notification.new.page.ready",A),V.on("notification.load.error",j),V.getNextPage(),"function"==typeof t&&t(null,"success"))}function A(t,e){e.newLatestItemsCount>0?(kt=e.newLatestItemsCount,mt.unseenLatestDataCount+=kt):kt=0,setTimeout(function(){n(e.content||[])},300)}function j(t){nt.showError({view:"hub",isInner:!1,errorElID:"#hub-error-main"}),dt.getInstance().setErrorTitle(".show .notifications-error__header--text")}function N(t){var e=null!==t.preferences?t.preferences.readFilter:[],i=ft.goBackDays(xt);!e instanceof Array&&"string"==typeof e&&(e=ht.handledParse(e,[])),X.override(e),ot=null!==t.preferences&&"undefined"!==t.preferences.lastRead?t.preferences.lastRead:i.toISOString(),U=null!==t.preferences&&"undefined"!=typeof t.preferences.currentDateTime?t.preferences.currentDateTime:(new Date).toISOString(),ft.setTime(U),at.update(c(yt))}function P(t,e){G.sync({preferences:t},function(t,i){t&&pt.log("Error syncing user preferences",arguments),"function"==typeof e&&e(t,i)})}function L(t){return"undefined"==typeof B&&"function"==typeof B[t]?null:B[t]()}function M(t,e){ut.removeEvent(t,"click",e),ut.addEvent(t,"click",e)}function D(t){var e=function(){return 0===yt.length?"none":l(yt)>0?"new":"read"};"hidden"===t?(lt.remove(document.getElementById("not-num"),"new-notifications"),q(O),at.update(yt),gt.log("close-pane","notifications-icon"),F(!0),it&&it.hide(!1)):($&&$.check(z),gt.log("open-pane","notifications-icon",{notification_state:e()}),lt.remove(document.getElementById("notification-link"),"swing"),lt.remove(document.querySelector(".notification-panel"),"has-new"),wt=0,F(!0,function(t,e){t&&nt.showError({view:"hub",isInner:!0,closeEvent:function(){nt.hideError("hub",!1)},errorElID:"#hub-error-inner",closeEl:".notifications-error--inner__close"})}))}function q(t){if(!_t)for(var e=document.querySelectorAll(".notification-items li"),i=e.length;i--;)t(i,e)}function O(t,e){lt.hasClass(e[t],"notification-new")&&(lt.remove(e[t],"notification-new"),lt.add(e[t],"notification-unread"),yt[t].newItem="notification-unread",lt.remove(document.getElementById("notification-link"),"swing"))}function F(t,e){"undefined"!=typeof X&&P({readFilter:"undefined"!=typeof X.filter?X.getCleanArray():null,lastReadFlag:t},e)}function R(){var t=document.querySelector(".notifications__settings--js");gt.listenTo(t,"click",H)}function H(t){t.preventDefault?t.preventDefault():t.returnValue=!1,this.log("click","notifications-settings")}Array.prototype.forEach=Array.prototype.forEach||function(t){for(var e=(this.length,-1);++e<this.length;)t(this[e],e)};var U,B,G,V,z,W,J,X,K,Y,$,Z,Q,tt,et,it,nt,ot,at=t("mybbc/notifications/vendor/riot.min"),st=(t("mybbc/notifications/NotificationLoader"),t("mybbc/notifications/collections/NotificationCollection")),rt=t("mybbc/notifications/config"),ct=(t("mybbc/notifications/BloomFilterManager"),t("mybbc/notifications/SettingsView")),lt=t("mybbc/notifications/classie"),dt=t("mybbc/notifications/AccessibilityManager"),ft=t("mybbc/notifications/DateManager"),ut=(t("mybbc/notifications/PreferencesClient"),t("mybbc/notifications/eventie")),pt=(t("mybbc/notifications/UserPreferences"),t("mybbc/notifications/request"),new(t("mybbc/notifications/logger"))("Main App")),ht=new(t("mybbc/notifications/utils"))(pt),mt=t("mybbc/notifications/popup"),gt=t("mybbc/notifications/analytics"),vt={baseAssetUrl:""},bt={},yt=[],wt=0,_t=!0,kt=0,Et=rt.env.visibleChunkAmount,xt=rt.env.maxNotificationAge,Ct={init:function(t){"undefined"!=typeof this.name&&"mainApp"==this.name&&(B=this),d.call(Ct,t)},drawerStateChanged:function(t){D(t)},setUserPreferencesModel:function(t){G=t},setReadFilter:function(t){X=t},updateVariables:N,userPreferencesModel:G};return Ct}),define("mybbc/notifications/NotificationsMain",["require","mybbc/notifications/config","orb/nav","mybbc/notifications/analytics","mybbc/notifications/classie","mybbc/notifications/utils","mybbc/notifications/PreferencesClient","mybbc/notifications/UserPreferences","mybbc/notifications/request","mybbc/notifications/BloomFilterManager","mybbc/notifications/logger","mybbc/notifications/StorageManager","mybbc/notifications/LocalStorageCache","mybbc/notifications/ErrorView","mybbc/notifications/NotificationsTemplate","mybbc/notifications/vendor/modernizr-custom"],function(t,e,i,n,o,a,s,r,c,l,d,f,u,p,h){var m,g,v,b,y=new d("App container"),w=new l("readFilter"),_=".notification-error__container",k=!1,E=new f("cachedPreferences"),x=new a,C={},S="preferencesUserId",T={name:"mainApp",drawerName:"notifications",errorState:!1,notificationPanelCreated:!1,orb:i,idConfig:e.env.idcta,userIdCache:u(S),run:function(t,i){this.basePath=i||"","function"==typeof t.getInstance&&(t=t.getInstance()),this.setIdcta(t),this.checkCookies(),this.manageLocalCache(),this.setNotificationIcon(),this.setErrorView(),"signed-in"===this.state?(this.setUserPreferencesModel(new r({client:new s(c,{config:e}),filter:w,cacheManager:E})),this.getUserPreferencesModel().fetch(x.bind(this.onUserPreferencesFetchFinished,this))):this.loadInitialTemplate()},manageLocalCache:function(){E.init(),"signed-out"==this.state?(E.clear(),this.userIdCache.clear()):"signed-in"==this.state&&(this.userHasChanged()&&E.clear(),this.userIdCache.put(this.idcta.getIdFromCookie()))},userHasChanged:function(){var t=this.userIdCache.get();return null!==t&&t!==this.idcta.getIdFromCookie()},onUserPreferencesFetchFinished:function(t,e){return t&&!E.hasCache()?(null===document.querySelector(_)&&this.prepareAndShowErrorView(),this.errorState=!0,y.log("Error reading user preferences and we have no cached value, so show the error message",arguments)):(this.getUserPreferencesModel().isPolling||this.getUserPreferencesModel().poll(x.bind(this.onUserPreferencesPollFinished,this)),void this.loadInitialTemplate())},prepareAndShowErrorView:function(){this.createPanel('<section class="%s"></section>'.replace("%s",_.slice(1))),b.showError({view:"main",isInner:!1,errorElID:"#hub-error-main"})},loadInitialTemplate:function(){this.loadTemplate(this.getTemplateNameByUserState(this.state),this.manageState)},onUserPreferencesPollFinished:function(t,e){return t?y.log("Error reading user preferences",arguments):void this.handleUserPreferencesResponse(e)},handleUserPreferencesResponse:function(t){"undefined"!=typeof m&&m.updateVariables(t)},setIdcta:function(t){this.idcta=t},checkCookies:function(){this.state=this.idcta.hasCookie()?"signed-in":"signed-out"},setNotificationIcon:function(){var t=function(){var t=document.createElement("span");return t.setAttribute("aria-live","polite"),t.className="notification-link__live notification-link__live--js",t};this.navNotificationElement=document.querySelector(".js-notification-link"),this.navNotificationElement.onkeydown=function(t){var e=t.which||t.charCode;13==e&&(this.lastEnterPress=Date.now())},this.navNotificationElement.appendChild(t()),o.add(this.navNotificationElement,"notifications-shown"),this.orb.refresh(),"signed-in"===this.state||"on-boarding"===this.state?o.add(this.navNotificationElement,"notifications-black-bell"):o.add(this.navNotificationElement,"notifications-grey-bell")},getNavNotificationEl:function(){return this.navNotificationElement},prepareAndLaunchNotificationApp:function(){this.loadTemplate("signed-in",function(t){this.updateDrawerContent(t.compile(this.getTemplateData(t.name))),this.launch(function(){"hidden"===this.getDrawerState()&&this.navNotificationElement.click()})})},loadTemplate:function(t,e){"undefined"==typeof C[t]?(C[t]=h.create(t),C[t].load(e,this)):e.call(this,C[t].compile(this.getTemplateData(C[t].name)))},getTemplateData:function(t){var e,i=this;return e={"signed-in":{baseAssetUrl:i.basePath},"signed-out":{idConfig:i.idConfig,ptrt:encodeURIComponent(window.location.href.replace(window.location.hash,""))},"on-boarding":{baseAssetUrl:i.basePath}},"undefined"!=typeof t&&t in e?e[t]:e},getTemplateNameByUserState:function(){return"signed-in"!==this.state||this.isUserOnBoarded()?this.state:"on-boarding"},isUserOnBoarded:function(){var t=this.getUserPreferencesModel(),e=t.get().preferences;return null!==e&&"undefined"!=typeof e[r.HAS_ON_BOARDED_PARAM_NAME]?e[r.HAS_ON_BOARDED_PARAM_NAME]:!1},manageState:function(t){this.createPanel(t.compile(this.getTemplateData(t.name))),"signed-in"===this.state?this.isUserOnBoarded()?this.launch():this.manageBlueDotDisplay(!0):this.setUpsellAnalyticsEvents()},launchOnBoarding:function(){var e=this;t(["mybbc/notifications/onboarding"],function(t){g=t,g.init(e.getOnboardingParams()),"function"==typeof cb&&cb(g)})},getOnboardingParams:function(){return{mainElSelector:".notifications-on-boarding--js",app:this,isIE:this.isIE(),errorView:b}},createPanel:function(t){this.orb.addDrawer(this.drawerName,this.getNavNotificationEl(),this.getPanelContentEl(t),this.getDrawerStateChangedCallback()),this.notificationPanelCreated=!0},getPanelContentEl:function(t){if("undefined"!=typeof this.drawerContentEl)return this.drawerContentEl;var e=document.createElement("div");return e.className="orb-panel",e.innerHTML=t,this.drawerContentEl=e,e},launch:function(e){var i=this;t(["mybbc/notifications/app"],function(t){m=t,m.init.call(i,{baseAssetUrl:i.basePath,readFilter:w,userPreferencesModel:v,errorView:b}),m.updateVariables(i.getUserPreferencesModel().get()),"function"==typeof e&&e.call(i,m)})},getMainContainerEl:function(){return document.querySelector(".notifications-main--js")},setUpsellAnalyticsEvents:function(){n.listenTo(this.getMainContainerEl(),"click",this.onWatchedAnalyticsElementClicked)},onWatchedAnalyticsElementClicked:function(t){var e=t.target,i=this,n={"sign-in":"notifications-sign-in__link--js",register:"notifications-register__link--js"};x.each(n,function(n,a){(o.hasClass(e,n)||e.parentNode&&o.hasClass(e.parentNode,n))&&(t.preventDefault?t.preventDefault():t.returnValue=!1,i.log(a,"notifications-upsell"),window.location.href="A"==e.tagName?e.href:e.parentNode.href)})},setUserPreferencesModel:function(t){v=t},setErrorView:function(t){var e=this;b=t||p({showErrorWithID:"#hub-error-main",mainApp:e,container:_,stateChanged:function(t){var e,i;if(!this.isInner){switch(this.currentErrorView){case"hub":e=document.querySelector(".notifications-main--js"),null!==e&&(e.style.display="shown"==t?"none":"block");break;case"onboarding":i=document.querySelector(".notifications-on-boarding--js"),null!==i&&(i.style.display="shown"==t?"none":"block")}this.mainApp.updateDrawerHeight()}}})},getErrorView:function(){return b},getUserPreferencesModel:function(){return v},getReadFilter:function(){return w},getCacheManager:function(){return E},updateDrawerContent:function(t){this.getPanelContentEl().innerHTML=t},updateDrawerHeight:function(){this.orb.updateDrawerHeight(this.drawerName)},getDrawerState:function(){return this.orb.getDrawerState(this.drawerName)},manageBlueDotDisplay:function(t){o[t?"add":"remove"](document.getElementById("not-num"),"new-notifications")},resetOnboarding:function(){g.resetOnboarding(),g.init(this.getOnboardingParams())},isIE:function(){if(document.documentMode)return document.documentMode;for(var t=7;t>0;t--){var e=document.createElement("div");if(e.innerHTML="<!--[if IE "+t+"]><span></span><![endif]-->",e.getElementsByTagName("span").length)return t}},removeCustomHeights:function(){g.removeCustomHeights()},getDrawerStateChangedCallback:function(){var t=this;return function(e){if("signed-in"===t.state){if("undefined"!=typeof m)return m.drawerStateChanged(e);t.isUserOnBoarded()||g||t.errorState||(t.manageBlueDotDisplay(!1),t.launchOnBoarding()),g&&("hidden"===e?k=!0:k&&(t.resetOnboarding(),k=!1))}else"hidden"===e?n.log("close-pane","notifications-icon"):n.log("upsell","notifications-icon")}}};return T}),define("NotificationsMain",["mybbc/notifications/vendor/modernizr-custom","mybbc/templates/signed-in","mybbc/templates/signed-out","mybbc/templates/on-boarding","mybbc/templates/error","mybbc/notifications/ErrorView"],function(){});