define(["jssignals-1","idcta/idCookie","id-config"],function(d,g,i){var w={signals:{signedIn:new d.Signal(),signinShown:new d.Signal()},ctas:{}};var k={width:608,height:614};var s=1;var o=0;var n;function l(y){this.id=y.id;this.element=document.getElementById(y.id);this.states=y.states;var x=this;if(y.publiclyCacheable===true){if(g.getInstance().hasCookie()){h(x)}else{x.element.getElementsByTagName("span")[0].innerHTML=x.states.unauthorised.signedout}}y.ocContainer=x;this.signinHandler=v(this.element.querySelectorAll(".id4-cta-signin")[0],y);if(!y.policyname){this.registerHandler=t(this.element.querySelectorAll(".id4-cta-register")[0],y)}w.ctas[this.id]=this;w.signals.signedIn.add(function(){h(x)})}function h(x){if(x.states.authorised){var z=g.getInstance().getNameFromCookie();var y=x.states.authorised.anonymous;if(z){y=x.states.authorised.name.replace("{name}",z)}x.element.getElementsByTagName("span")[0].innerHTML=y}else{if(x.element.parentNode){x.element.parentNode.removeChild(x.element)}}}function t(y,x){if(b(x)){var z=function(A){if(!j(x,"register")){if(A.preventDefault){A.preventDefault()}else{A.returnValue=false}}};if(typeof(y)!=="undefined"&&typeof(y.jquery)!=="undefined"){y=y.get(0)}if(document.addEventListener&&typeof(y)!=="undefined"&&y.addEventListener){y.addEventListener("click",z,false)}else{if(document.attachEvent&&typeof(y)!=="undefined"&&y.attachEvent){y.attachEvent("onclick",z)}}return z}}function v(z,x){if(b(x)){var y=function(A){if(!j(x,"signin")){if(A.preventDefault){A.preventDefault()}else{return false}}};if(!x.ocContainer){x.ocContainer=z}if(typeof(z)!=="undefined"&&typeof(z.jquery)!=="undefined"){z=z.get(0)}if(document.addEventListener&&typeof(z)!=="undefined"&&z.addEventListener){z.addEventListener("click",y,false)}else{if(document.attachEvent&&typeof(z)!=="undefined"&&z.attachEvent){z.attachEvent("onclick",y)}}return y}}function u(x){if(typeof(x.id)!=="undefined"&&typeof(w.ctas[x.id])!=="undefined"&&typeof(w.ctas[x.id].signinHandler)!=="undefined"){if(document.removeEventListener){x.removeEventListener("click",w.ctas[x.id].signinHandler)}else{if(document.detachEvent){x.detachEvent("onclick",w.ctas[x.id].signinHandler)}}}}function b(x){return(x.useOverlay===true&&m())}function m(){return !(navigator.appVersion.indexOf("MSIE 6.")!=-1||navigator.appVersion.indexOf("MSIE 7.")!=-1||navigator.appVersion.indexOf("MSIE 8.")!=-1)}function j(y,x){if(window.innerWidth<=k.width||window.innerHeight<=k.height){return true}else{require(["idcta/overlayManager"],function(z){z.useOverlayController(y,x,w.signals)})}return false}function p(){return s}function f(x){s=x}function a(x){if(typeof window.Promise=="undefined"){return{then:function(y,A){if(typeof x=="undefined"){var z=g.getInstance().getAccessToken();if(z){r(y,true)}else{r(A,false)}return}else{o=0;n=setInterval(function(){q(y,A,x)},300)}}}}return new Promise(function(A,z){if(typeof x=="undefined"){var y=g.getInstance().getAccessToken();if(y){r(A,true)}else{r(z,false)}return}else{o=0;n=setInterval(function(){q(A,z,x)},300)}})}function r(y,x){if(x||typeof n!="undefined"){s=0}else{s=1}if(typeof y=="function"){y(x)}}function c(y){clearInterval(n);n=null;if(typeof y!="undefined"){var x=document.getElementById(y.id);x.parentNode.removeChild(x)}}function q(x,C,z){o++;var y=g.getInstance().getAccessToken();var A=false;try{if(z.contentWindow.location.href==document.location.href){A=true}}catch(B){}if(y||A){c(z);r(x,true);return}if(o==10&&!y&&!A){c(z);r(C,false);return}}function e(y){if(s>0&&g.getInstance().hasCookie()&&g.getInstance().getIdFromCookie()&&g.getInstance().getAccessToken("https")==null&&i.idpurl!=false){var x=document.createElement("iframe");x.src=i.idpurl;x.id="upliftframe";x.scrolling="no";x.frameborder="0";x.width="1px";x.height="1px";x.border="0px";x.style.display="none";x.style.frameBorder="0px";x.style.borderStyle="none";if(typeof y!=="undefined"&&document.getElementById(y)){document.getElementById(y).appendChild(x)}else{document.body.appendChild(x)}s--;return w.createUpliftPromise(x)}return w.createUpliftPromise()}w.Cta=l;w.unbindSigninClickTo=u;w.bindSigninClickTo=v;w.bindRegisterClickTo=t;w.initiateUserUplift=e;w.createUpliftPromise=a;w.getIframeLimit=p;w.setIframeLimit=f;w.hasCookie=function(){return g.getInstance().hasCookie()};w.getCookieInstance=function(){return g.getInstance()};w.getIdFromCookie=function(){return g.getInstance().getIdFromCookie()};w.getNameFromCookie=function(){return g.getInstance().getNameFromCookie()};w.getAccessToken=function(x){return g.getInstance().getAccessToken(x)};return w});