/* $Id: mtr.js 152379 2015-09-14 20:37:46Z shawn.gao $ */
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){"function"==typeof define&&define.amd?define("ecomm/utils",["jquery/nyt","ecomm/logger"],function(t,n){return e(t,"NYT5",n)}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.Utils=e(NYTD.jQuery||window.jQuery,"NYT4",NYTD.Ecomm.Logger))}(function(e,t,n){var a={setToLocalStorage:function(e,t){if(this.hasLocalStorage())try{window.localStorage.setItem(e,t)}catch(n){}},hasLocalStorage:function(){if(/MSIE 8.0/.test(navigator.userAgent))return!1;try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},getFromLocalStorage:function(e){try{return this.hasLocalStorage()&&window.localStorage.getItem(e)}catch(t){return null}},filterObject:function(t,n){var a={};return e.each(t,function(t,o){e.inArray(t,n)>-1&&(a[t]=o)}),a},getLink:function(e){return e.is("a")?e:e.parents("a").eq(0)},isHrefValid:function(e){var t=this.getLink(e).attr("href"),n=/^javascript:|^#|^mailto:/gim,a=!0;return(!t||t.match(n))&&(a=!1),a},runWhenReady:function(e,t,n,a){var o=a||5;setTimeout(function i(){e()?t():--o&&setTimeout(i,n)},n)},pageType:function(){var t=e("meta[name='PT']")[0];return t=t&&t.content||"",t.replace(/ /g,"")}(),isNYT5Env:function(){var e=document.getElementsByName("sourceApp"),t={"nyt-v5":!0,blogs:!0};return"undefined"!=typeof e[0]&&e[0].getAttribute("content")in t},parseAds:function(t){var a="",o="";e.each(t.ads,function(e,t){t.campaign&&(a+=t.campaign),o+=t.creative});var i={adxCampaigns:a,creatives:o};return n.log(i),i},appendAds:function(t,n){var a=this.parseAds(t),o=n||e("body");return o.append(a.creatives),a.adxCampaigns},debounce:function(e,t){var n=null;return function(){var a=this,o=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(a,o)},t)}},getNytVersion:function(){return t},isSlideShowApp:function(){return e("html").hasClass("app-slideshow")}};return a.isSlideShowApp=function(){return e("html").hasClass("app-slideshow")},a});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e){"function"==typeof define&&define.amd?define("ecomm/logger",["ecomm/utils","ecomm/url","ecomm/cookies"],function(t,n,a){return e(t,n,a)}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.Logger=e(NYTD.Ecomm.Utils,NYTD.Ecomm.Url,NYTD.Ecomm.Cookies))}(function(e,t,n){var a=void 0,o=function(){function e(){_classCallCheck(this,e),this.debugCookie=n.get("mtr-debug"),this.debugQS=t.getParameter("debug")}return _createClass(e,[{key:"isDebugMode",value:function(){return this.debugCookie||void 0!==this.debugQS}},{key:"log",value:function(e){return this.isDebugMode()?(console.log(e),!0):!1}}]),e}();return a||(a=new o),a}),function(e){"function"==typeof define&&define.amd?define("ecomm/cookies",[],function(){return e()}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.Cookies=e(NYTD.Ecomm.Cookies))}(function(){return{get:function(e){return new RegExp(e+"=([^;]+)","i").test(unescape(document.cookie))?RegExp.$1:null},set:function(e,t,n){var a=new Date;a.setTime(a.getTime());var o=n;o&&(o=1e3*o*60*60*24);var i=new Date(a.getTime()+o),r=e+"="+t+";path=/"+(o?";expires="+i.toGMTString():"")+";domain=.nytimes.com";document.cookie=r},remove:function(e,t,n,a){document.cookie=e+"=xxx"+(t?";path="+t:";path=/")+(n?";domain="+n:";domain=.nytimes.com")+(a?";secure":"")+"; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}}}),function(e){"function"==typeof define&&define.amd?define("ecomm/url",["jquery/nyt"],function(t){return e(t)}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.Url=e(NYTD.Ecomm.Url))}(function(e){return{parseUri:function(e){for(var t={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=t.parser[t.strictMode?"strict":"loose"].exec(e),a={},o=14;o--;)a[t.key[o]]=n[o]||"";return a[t.q.name]={},a[t.key[12]].replace(t.q.parser,function(e,n,o){n&&(a[t.q.name][n]=o)}),a},parseCurrentUri:function(){return this.parseCurrentUri.ret||(this.parseCurrentUri.ret=this.parseUri(this.getLocationHref())),this.parseCurrentUri.ret},getLocationHref:function(){return location.href},getParameter:function(e){var t=this.parseCurrentUri();return t.queryKey[e]},appendParamsToUrl:function(t,n){var a=void 0,o=void 0,i=void 0,r={},c=t;return c.indexOf("#")>-1&&(a=c.split("#"),c=a[0]),c.indexOf("?")>-1?(o=c.split("?"),i=o[0],r=this.parseUri(c).queryKey):i=c,r=e.extend({},r,n),i+"?"+e.param(r)+(a?"#"+a[1]:"")},updateQueryStringParameter:function(e,t,n){var a=new RegExp("([?|&])"+t+"=.*?(&|$)","i"),o=void 0,i=-1!==e.indexOf("?")?"&":"?";return o=e.match(a)?e.replace(a,"$1"+t+"="+n+"$2"):e+i+t+"="+n},getDomain:function(e){var t=e||"",n=t.match(/^https?\:\/\/([^\/:?#]+)(?:[\/:?#]|$)/i);return n?n[1]:void 0},getAdxKeywords:function(){var e=[],t=this.getParameter("smid"),n=this.getParameter("mtrref"),a=this.getDomain(document.referrer);return t&&""!==t&&e.push(t),n&&""!==n&&-1===n.indexOf("nytimes")&&e.push("mtr_"+n),a&&-1===a.indexOf("nytimes")&&e.push("mtr_"+a),e.join(",")}}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e){"function"==typeof define&&define.amd?define("ecomm/overlay",["jquery/nyt","ecomm/utils"],function(t,n){return e(t,n)}):"object"==typeof NYTD&&(NYTD.Ecomm.Overlay=e(NYTD.jQuery||window.jQuery,NYTD.Ecomm.Utils))}(function(e,t){var n=function(){function n(){_classCallCheck(this,n),this.imageHost=window.location.host.indexOf(".stg.")>0?"http://static.stg.nytimes.com":"http://static01.nytimes.com"}return _createClass(n,[{key:"add",value:function(){var t=n.getCreative();n.display(t,function(){var t=void 0!==document.body.style.webkitTransition||void 0!==document.body.style.MozTransition||void 0!==document.body.style.OTransition||void 0!==document.body.style.msTransition,a=function(){e("#overlay").css("height",n.getGatewayHeight())};e(window).on("resize",function(){a()}),t||e("#overlay").css("background-image","url("+this.imageHost+"/images/global/backgrounds/transparentBG.gif)"),a(),n.blockContent()})}}],[{key:"getCreative",value:function(){var e=void 0,n=t.isSlideShowApp();return"NYT5"!==t.getNytVersion()||n?("NYT4"===t.getNytVersion()||n)&&(e="<div id=\"overlay\" style=\"\n                    z-index:1000;\n                    background: transparent;\n                    background:-moz-linear-gradient(center bottom , #000, transparent);\n                    background:-ms-linear-gradient(top, transparent, black);\n                    background: -webkit-gradient(linear, left bottom, left top, from(#000), to(transparent));\n                    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00000010', endColorstr='#000000');\n                    position:fixed; width:100%; height:0px; bottom:0; left:0; display: none\">\n                    </div>"):e='<div id="overlay" class="z-index-gateway-overlay" style="\n                    visibility: visible;\n                    background: transparent;\n                    background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIwLjQiLz4KICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgPC9saW5lYXJHcmFkaWVudD4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiBmaWxsPSJ1cmwoI2dyYWQtdWNnZy1nZW5lcmF0ZWQpIiAvPgo8L3N2Zz4=);\n                    background: -moz-linear-gradient(top, rgba(255,255,255,0.4) 0%, rgba(255,255,255,1) 100%); /* FF3.6+ */\n                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,255,255,0.4)), color-stop(100%,rgba(255,255,255,1))); /* Chrome,Safari4+ */\n                    background: -webkit-linear-gradient(top, rgba(255,255,255,0.4) 0%,rgba(255,255,255,1) 100%); /* Chrome10+,Safari5.1+ */\n                    background: -o-linear-gradient(top, rgba(255,255,255,0.4) 0%,rgba(255,255,255,1) 100%); /* Opera 11.10+ */\n                    background: -ms-linear-gradient(top, rgba(255,255,255,0.4) 0%,rgba(255,255,255,1) 100%); /* IE10+ */\n                    background: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%,rgba(255,255,255,1) 100%); /* W3C */\n                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#66ffffff\', endColorstr=\'#ffffff\',GradientType=0 ); /* IE6-8 */\n                    position:fixed; width:100%; height:0px; bottom:0; left:0; display: none">\n                    </div>',e}},{key:"getReferenceForClickableArea",value:function(){var t=e(".gateway-anchor").first(),n=e("#masthead"),a=e("#slideshow-header"),o=n.find(".container").first(),i=e(".navigation").first(),r=i.next(".subNavigation");return t.length>0?t:o.length>0?o:a.length>0?a:r.length>0?r:i.length>0?i:n.length>0?n:e(document.body)}},{key:"getGatewayHeight",value:function(){var t=n.getReferenceForClickableArea(),a=void 0;return a=null===t.offset()?"70%":e(window).height()-(t.offset().top+t.outerHeight(!0))}},{key:"display",value:function(t,a){return document.body&&document.body.firstChild?(e("body").append(t),void(a&&a())):void setTimeout(function(){n.display(t,a)},100)}},{key:"stopScrolling",value:function(){window.scroll(0,0),e("body").css({overflow:"hidden",margin:"0 0 85px 0","padding-right":"15px"}),e("html").css({overflow:"hidden"}),e(document).off("keypress keydown keyup touchmove"),e(document).on("keypress keydown keyup",function(e){return e.keyCode in{37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",36:"HOME",35:"END",33:"PAGEUP",34:"PAGEDOWN"}?(e.preventDefault(),!1):void 0}),e(document).on("touchmove",function(e){e.preventDefault()}),window.Event&&"function"==typeof Event.stopObserving&&(Event.stopObserving(document,"keydown"),Event.stopObserving(document,"keyup"),Event.stopObserving(document,"keypress"),Event.stopObserving(window,"keydown"),Event.stopObserving(window,"keyup"),Event.stopObserving(window,"keypress"))}},{key:"scrap",value:function(){e(["#article .articleInline","#article #readerscomment","#article .articleFooter","#article .authorIdentification","#article #articleExtras","#article .articleBottomExtra","#article .emailAlertModule","#article #pageLinks","#twitter-widget-0",".videoplayerContainer","iframe",".slideShowModule","#subscribeCallToAction","#story figure"].join(",")).not("figure.layout-horizontal-full-bleed").remove(),e(["#article .articleBody p","#content .entry-content p","#content .postContent p","#story .story-body-text"].join(",")).each(function(t,n){var a=1,o=e(n);if(0===t){var i=o.html();i.length&&i.length<400&&(a=2)}if(t===a){var r=e('<p id="subscribeCallToAction" style="text-align: center; margin-top: 28px; font-family: arial,helvetica,sans-serif; font-size: 1.2em; font-weight: bold;"><a  data-content-collection="GWtoDSLP" data-content-placement="1" class="applicationButtonLt" href="http://www.nytimes.com/articlegate" style="width: 250px; padding: 7px 25px !important; font-weight: bold; color: #004276; text-decoration: none"><span>To see the full article, subscribe here.</span></a></p>');r.insertAfter(o)}else t>a&&o.remove()})}},{key:"removeNYTClean",value:function(){e("script").each(function(){return e(this).attr("src")&&e(this).attr("src").toLowerCase().indexOf("euri.ca")>0?(window.location.reload(),!1):void 0})}},{key:"blockContent",value:function(){var e=function(){n.stopScrolling(),n.removeNYTClean(),n.scrap()};e(),setInterval(e,1e3)}}]),n}();return n});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e){"function"==typeof define&&define.amd?define("ecomm/etTracker",["jquery/nyt","ecomm/utils","ecomm/url","ecomm/cookies"],function(t,n,a,o){return e(t,n,a,o)}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.EtTracker=e(NYTD.jQuery||window.jQuery,NYTD.Ecomm.Utils,NYTD.Ecomm.Url,NYTD.Ecomm.Cookies))}(function(e,t,n,a){var o=function(){function o(n){var a=this;_classCallCheck(this,o),this.config=n,this.$container=n.$container,this.module=n.module,this.region=n.region,this.meterCount=n.meterCount||o.getMeterPageCount(),this.adxCampaignName=n.adxCampaignName||"",this.moduleInteractions=[{selector:".login-modal-trigger",tagxEvent:"login-click",action:"click",etParamKey:"modalLogin"},{selector:".registration-modal-trigger",tagxEvent:"regi-click",action:"click",etParamKey:"modalRegi"}],this.trackingParams={common:{version:"meter at "+this.meterCount,module:this.module,pgtype:t.pageType,region:this.region,contentId:this.adxCampaignName,mediaId:this.getMediaId(),referrer:document.referrer,priority:!0},load:{action:"Impression",eventName:"Impression"},close:{action:"click",eventName:"Dismiss"+this.module},modalRegi:{module:this.module+"-Regi",action:"click",eventName:"regi-click"},modalLogin:{module:this.module+"-Login",action:"click",eventName:"login-click"},links:{module:this.module+"-Links",action:"click",contentCollection:this.module.toLowerCase()+"-links-click"}},this.moduleInteractions=this.moduleInteractions.concat(n.moduleInteractions||[]),this.trackingParams=e.extend(!0,{},this.trackingParams,n.trackingParams),this.skipAnchorTracking=n.skipAnchorTracking||!1,this.record(this.module.toLowerCase()+"-load",e.extend({},this.trackingParams.common,this.trackingParams.load),"impression"),this.skipAnchorTracking||this.setAnchorTracking(),this.setupModuleInteractions(),e(document).on(this.module+".updateAnchorETParams",function(){a.addAnchorTracking(a.$container,a.trackingParams)})}return _createClass(o,[{key:"getMediaId",value:function(){function t(e){return e&&""!==e}var n=e.trim(this.$container.find(".adxInfo").text()),a="";return t(n)&&(a=n.replace(/.*creative: ([^,]*).*/,"$1"),t(a)&&(a=a.indexOf(" -- ")?e.trim(a.split(" -- ")[0]):a)),a}},{key:"setupModuleInteractions",value:function(){for(var e=this.moduleInteractions,t={},n=0;n<e.length;n++){var a=e[n];"click"===a.action?(t.mouseup=1,this.moduleInteractions[n].action="mouseup"):t[a.action]=1}for(var o in t)t.hasOwnProperty(o)&&this.listenTo(o)}},{key:"listenTo",value:function(e){var t=this;this.$container.on(e,function(e){t.handle(e)})}},{key:"isSelector",value:function(e,t){return e.is(t)||!!e.parents(t).length}},{key:"handle",value:function(t){for(var n=0;n<this.moduleInteractions.length;n++){var a=this.moduleInteractions[n],o=e(t.target);if(this.isSelector(o,a.selector)&&a.action===t.type){var i=3===t.which;i||(this.track(a.tagxEvent,a.etParamKey),a.callback&&"function"==typeof a.callback&&a.callback(t))}}}},{key:"setAnchorTracking",value:function(){var t=this;this.addAnchorTracking(this.$container,this.trackingParams),e(document).on(this.module+".updateAnchorETParams",function(){t.addAnchorTracking(t.$container,t.trackingParams)})}},{key:"addAnchorTracking",value:function(e,t){var n=this;e.find("a").each(function(e,a){n.processLinks(a,t)})}},{key:"processLinks",value:function(n,a){var i=e(n),r=a;if(t.isHrefValid(i)){var c=t.filterObject(i.data(),["contentCollection","contentPlacement"]),s=e.extend({},r.common,r.links,c);o.processUrlHref(i,s)}}},{key:"record",value:function(e,n,a){t.runWhenReady(function(){return"TAGX"in window},function(){TAGX.EventProxy.trigger(e,n,a)},1e3,10)}},{key:"track",value:function(t,n,a){var o=this.trackingParams,i=e.extend({},o.common,o[n],a||{});this.record(t,i,"interaction")}}],[{key:"processUrlHref",value:function(e,t){var a=e.attr("href");if(!(!a||a.match(/^javascript:/i)||a.match(/^mailto:/i)||a.match(/^tel:/i)||a.match("#"))){var o=a.match("[?|&]goto=([^;]+)"),i=o&&o[1]||null;i?(i=decodeURIComponent(i),i=encodeURIComponent(decodeURIComponent(n.appendParamsToUrl(i,t))),a=n.updateQueryStringParameter(a,"goto",i)):a=n.appendParamsToUrl(a,t),e.attr("href",a)}}},{key:"getMeterPageCount",value:function(){var e=a.get("nyt-m")||t.getFromLocalStorage("nyt-m")||window.name||"",n=e.match(/v=i.([0-9]+)/);return n&&n[1]?parseInt(n[1],10):null}}]),o}();return o}),function(e){"function"==typeof define&&define.amd?define("auth/gateway/creatives",["jquery/nyt"],function(t){return e(t)}):"object"==typeof NYTD&&(NYTD.GatewayCreatives=e(NYTD.jQuery||window.jQuery))}(function(e){return{defaultPayCreative:'<div style="color: #000 !important; text-align: left !important; padding: 10px 10px 10px 15px; border: 5px solid #8f8c89 ; width: 751px ; margin: 0 auto ; height: 375px ; background: #ffffff ; -moz-border-radius: .8em !important; -webkit-border-radius: .8em !important; border-radius: .8em !important;">\n               <div>\n                    <p style="font-family: georgia, verdana, serif !important; font-size: 27px !important; font-weight: bold !important; font-style: normal !important; margin: 10px 0 0 0; line-height: 130% !important;">\n                        Thank you for visiting NYTimes.com\n                    </p>\n              </div>\n              <div>\n                   <div style="width: 460px; margin-right: 5px; float: left;">\n						<p style="font-family: georgia, verdana, serif !important; font-style: normal !important; margin: 22px 0 0 0; font-size: 15px !important; line-height: 140% !important;">\n							If you are already a subscriber\n							<a class="sitewideLogInModal login-modal-trigger" style="color: #blue; text-decoration: underline; color: #002c5e; cursor:pointer;" id="NYTDGWY_login" href="https://myaccount.nytimes.com/auth/login">log in here</a>.\n						</p>\n						<p style="font-family: georgia, verdana, serif !important; font-style: normal !important; margin: 22px 0 0 0; font-size: 15px !important; line-height: 140% !important;">\n							To see subscription options\n							<a data-content-collection="GWtoDSLP"  data-content-placement="1" style="color: #blue; text-decoration: underline; color: #002c5e; cursor:pointer;" id="NYTDGWY_LP" href="http://www.nytimes.com/subscriptions/Multiproduct/lp87JHJ.html?campaignId=44U9H">click here</a>.\n						</p>\n                    </div>\n                    <div style="width: 280px; float: left; margin: 35px 0 0 0;">\n                        <img src="http://static01.nyt.com/subscriptions/gateway/gw1/img/devices-white.jpg" alt="" width="280" height="150" alt="The New York Times Digital Platforms"/>\n                    </div>\n                    <div style="clear: both; margin: 0; padding-top: 10px;">\n                        <div style="float: right; width: 220px; text-align: right;">\n                            <img src="http://static01.nyt.com/subscriptions/gateway/gw1/img/nyt-logo-white.gif" alt="The New York Times" width="195" height="31"/>\n                        </div>\n                    </div>\n					<div style="position: absolute;bottom: 20px;">\n						<p style="font-family: georgia, verdana, serif !important; font-style: normal !important; margin: 22px 0 0 0; font-size: 15px !important; line-height: 140% !important;">\n							For questions about your account, contact Customer Care at\n							<a style="color: #blue; text-decoration: underline; color: #002c5e; cursor:pointer;" href="tel:18005919233">1-800-591â€‘9233</a>.\n						</p>\n					</div>\n                </div>\n            </div>',render:function(){e("#gatewayUnit").html(this.defaultPayCreative)}}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e){"function"==typeof define&&define.amd?define("auth/gateway",["jquery/nyt","auth/gateway/creatives","ecomm/utils","ecomm/url","ecomm/overlay","ecomm/etTracker"],function(t,n,a,o,i,r){return e(t,n,a,o,i,r)}):"object"==typeof NYTD&&(NYTD.Gateway=e(NYTD.jQuery||window.jQuery,NYTD.GatewayCreatives,NYTD.Ecomm.Utils,NYTD.Ecomm.Url,NYTD.Ecomm.Overlay,NYTD.Ecomm.EtTracker))}(function(e,t,n,a,o,i){var r=function(){function r(e,t){_classCallCheck(this,r),this.wwwHost="http://www.nytimes.com",this.edition=unescape(document.cookie).match("NYT-Edition=([^;]+)"),this.wallType=e,this.assetType=t,this.addCreative()}return _createClass(r,[{key:"addCreative",value:function(){var o=this,i=5e3,r=void 0,c=!1,s=function(e,t){o.displayCreatives(e,t)},l=function(e){var t=void 0;if(clearTimeout(r),!c){if(!e||!e.ads||"object"!=typeof e.ads.Gateway)return void u();window.NYTD=window.NYTD||{},NYTD.Gateway=NYTD.Gateway||{},NYTD.Gateway.etAdxInfo={},t=n.parseAds(e),s(t.creatives,t.adxCampaigns)}},u=function(){return clearTimeout(r),c=!0,s(t.defaultPayCreative)};e.ajax({url:this.wwwHost+"/adx/bin/adxrun.html?jsonp=?",dataType:"jsonp",data:{v:3,page:this.getAdxSetupUrl(),positions:"Gateway,data_country,data1,data2,data3",keywords:a.getAdxKeywords()},success:function(e){l(e)}}),r=setTimeout(function(){u()},i)}},{key:"displayCreatives",value:function(t,a){var c=new o;c.add();var s="width:100%; position:fixed; bottom: 80px; display: none; left:0;";"NYT4"===n.getNytVersion()&&(s+=" z-index: 1000000040;");var l=['<div id="gatewayCreative" class="z-index-gateway-overlay" style="'+s+'">','<div id="gatewayUnit" style="position:relative">'].concat(t).concat(["</div>","</div>"]).join("");r.display(l,function(){setTimeout(function(){var t=e("#gatewayCreative"),n={$container:t,module:"Gateway",region:"FixedCenter",trackingParams:{common:{contentId:a}}};this.etTracker=new i(n),e("#overlay").fadeIn(),t.fadeIn()},200)})}},{key:"getAdxSetupUrl",value:function(){var e=void 0,t=this.edition;return e="pay"===this.wallType?t&&"edition|GLOBAL"===t[1]?this.assetType&&""!==this.assetType?"gateway-global_"+this.assetType+".nytimes.com":"gateway-global.nytimes.com":this.assetType&&""!==this.assetType?"gateway_"+this.assetType+".nytimes.com":"gateway.nytimes.com":t&&"edition|GLOBAL"===t[1]?"regiwall-global.nytimes.com":"regiwall.nytimes.com"}}],[{key:"display",value:function(t,n){return document.body&&document.body.firstChild?(e("body").append(t),void(n&&n())):void setTimeout(function(){r.display(t,n)},100)}}]),r}();return r});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e,t){"function"==typeof define&&define.amd?define("auth/gateway-d",["jquery/nyt","ecomm/utils","ecomm/etTracker"],function(e,n,a){return t(e,n,a)}):"object"==typeof e.NYTD&&(NYTD.DismissibleGW=t(NYTD.jQuery||window.jQuery,NYTD.Ecomm.Utils,NYTD.Ecomm.EtTracker))}(void 0,function(e,t,n){var a=function(){function a(e){_classCallCheck(this,a),this.meter=e,this.get()}return _createClass(a,[{key:"get",value:function(){var t=this;e.ajax({url:"http://www.nytimes.com/adx/bin/adxrun.html?v=3&jsonp=?",dataType:"jsonp",data:{page:"softwall.nytimes.com",positions:"Gateway"},success:function(e){t.gwyLoad(e)}})}},{key:"gwyLoad",value:function(e){e&&e.ads&&(window.NYTD=window.NYTD||{},NYTD.Gateway=NYTD.Gateway||{},NYTD.Gateway.etAdxInfo={},this.adData=t.parseAds(e),this.show())}},{key:"show",value:function(){var t=this;e(function(){t.addCreative(),t.setTracking()})}},{key:"addCreative",value:function(){var t=['<div id="gateway-d">',this.adData.creatives,"</div>"].join("");e("body").append(t),this.$container=e("#gateway-d")}},{key:"setTracking",value:function(){var e=this;this.etTracker=new n({$container:this.$container.find("#gw-wrapper"),module:"DismissibleGateway",adxCampaignName:this.adData.adxCampaignName,region:"FixedCenter",meterCount:this.meter.pageCount,anchorPrefix:"dgateway-",moduleInteractions:[{selector:".gw-modal-close",action:"click",tagxEvent:"gateway-dismiss",etParamKey:"close",callback:function(){e.$container.fadeOut(100)}}]})}}]),a}();return a});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e){if("function"==typeof define&&define.amd)define(["jquery/nyt","auth/gateway","auth/gateway-d","ecomm/utils","ecomm/url","ecomm/cookies"],function(t,n,a,o,i,r){return e(t,n,a,o,i,r)});else if("object"==typeof NYTD){var t=NYTD;t.Meter=e(t.jQuery||window.jQuery,t.Gateway,t.DismissibleGW,t.Ecomm.Utils,t.Ecomm.Url,t.Ecomm.Cookies)}}(function(e,t,n,a,o,i){var r={loaded:!1},c=[],s=void 0,l=function(){function s(){var t=this;_classCallCheck(this,s),this.meterCookieBackupPriorityList=[a.getFromLocalStorage("nyt-m"),window.name],this.meterSvc="//meter-svc.nytimes.com/meter.js?callback=?",e(document).on("popstate",function(){t.onUrlChange()}),this.currentCleanUrl=s.cleanUrl(window.location.href),window.NYT_meterBackupCallback=s.meterBackupCallback;var n=s.getUrlHash(),o=s.getCookieHash();return this.initialCheckMeterOptions={url:window.location.href,referrer:document.referrer},s.isErrorPage()?void e(document).off("keydown",s.onEscapeKey):void(s.getMeterCookie()?n?n&&!o||n!==o?s.removeGatewayHash():n&&o&&n===o&&(this.loadGateway(),this.updateUserState()):this.checkMeter(this.initialCheckMeterOptions):this.loadCookieFromBackupMeter())}return _createClass(s,[{key:"loadCookieFromBackupMeter",value:function(){var e=this;s.pingBackupMeter(),setTimeout(function(){e.checkMeter(e.initialCheckMeterOptions)},1500)}},{key:"onUrlChange",value:function(){var e=s.cleanUrl(window.location.href);this.currentCleanUrl!==e&&(this.checkMeter({url:window.location.href,referrer:this.currentCleanUrl}),this.currentCleanUrl=e)}},{key:"updateUserState",value:function(){a.isNYT5Env()||e.ajax({dataType:"jsonp",url:this.meterSvc,data:{url:window.location.href},success:function(t){t.loggedIn&&e("html").addClass("user-logged-in")}})}},{key:"loadGateway",value:function(){var n=/&assetType=([^&]+)/.test(unescape(window.location.search.substring(1)))?RegExp.$1:"",a=void 0;if(r["final"]=!0,e(document).trigger("NYTD:MeterFinal",r),s.pingBackupMeter(),t)a=new t(s.getGatewayType(),n);else{var o=window.location.host.indexOf(".stg.")>0,i=o?"http://static.stg.nytimes.com":"http://static01.nyt.com",c=i+"/js/gwy.js";e.ajax({url:c,dataType:"script",success:function(){return a=new NYTD.Gateway(s.getGatewayType(),n)}})}return a}},{key:"checkMeter",value:function(t){e(document).on("keydown",s.onEscapeKey),r.loaded=!1,this.get(t||{})}},{key:"get",value:function(t){var n=this,a=t.url||window.location.href,o=null===t.referrer||void 0===t.referrer?window.location.href:t.referrer;t.callback&&c.push(t.callback);var i=e("meta").filter('[name="channels"]').attr("content"),r="",s=void 0;"undefined"!=typeof i&&(r="&channels="+i),s=this.meterSvc+r,e.ajax({dataType:"jsonp",url:s,data:{url:a,referer:o},success:function(e){n.onMeterLoaded(e,t,a)}})}},{key:"onMeterLoaded",value:function(t,n,a){var o=void 0;if(t.isCookieValid===!1&&this.meterCookieBackupPriorityList.length>0){var r=this.meterCookieBackupPriorityList.pop();return s.isNullCookie(r)||i.set("nyt-m",r,730),void this.get(n)}return t.assetType&&(o=t.assetType),s.pingBackupMeter(),e("head").append('<meta name="WT.z_cad" content="'+(t.counted?"1":"0")+'" /> '),t.hitSoftPaywall?(this.serialize(t,a,o),void s.renderDismissibleGW()):(parseInt(t.v,10)>parseInt(t.t,10)&&s.setAbInfo(t.ab),t.hitPaywall||t.hitRegiwall?void s.addGatewayHash(t.hash,t.hitPaywall,t.hitRegiwall,o):void this.serialize(t,a,o))}},{key:"serialize",value:function(t,n,a){var o=e(document),i=s.getMeterPageCount();r.loaded=!0,r["final"]=!0,r.meterOn=t.meter,r.gatewayOn=t.gateway,r.hitPaypall=t.hitPaypall,r.hitRegiwall=t.hitRegiwall,r.cookieValid=t.isCookieValid,r.isLoggedIn=t.loggedIn,r.pageCount=i,r.url=n,r.assetType=a,r.counted=t.counted,t.loggedIn&&e("html").addClass("user-logged-in"),e.each(c,function(e,t){t(r)}),c=[],o.trigger("NYTD:MeterLoaded",r),o.trigger("NYTD:MeterFinal",r),o.off("keydown",s.onEscapeKey)}}],[{key:"pingBackupMeter",value:function(){var t="//meter-svc.nytimes.com/meter-echo.js?callback=?";e.ajax({dataType:"jsonp",url:t,jsonpCallback:"NYT_meterBackupCallback"})}},{key:"meterBackupCallback",value:function(e){e&&(i.get("nyt-m")||e&&e["nyt-m"]&&!s.isNullCookie(e["nyt-m"])&&i.set("nyt-m",e["nyt-m"],730))}},{key:"removeGatewayHash",value:function(){window.location.replace(window.location.href.replace(/(\?|&)gwh=([^&]+)/g,"").replace(/(\?|&)gwt=([^&]+)/g,""))}},{key:"addGatewayHash",value:function(e,t,n,a){var i=t?"pay":"regi",r=unescape(window.location.href).split("#");r=r.length>1?"#"+r[1]:null;var c=a?"&assetType="+a:"",s="mtrref="+o.getDomain(document.referrer)+"&gwh="+e+"&gwt="+i+c,l=window.location.search?window.location.href+"&"+s:window.location.href+"?"+s;l=r?l.replace(r,"")+r:l,window.location.replace(l)}},{key:"setAbInfo",value:function(e){e&&null!==e.variation&&null!==e.name?i.set("mtrab",e.name+e.variation):i.remove("mtrab")}},{key:"isErrorPage",value:function(){var e=document.getElementsByName("PST")[0],t=document.getElementsByTagName("title")[0],n=!1;return t&&t.innerHTML&&(n=new RegExp("Page Not Found|Page unavailable","i").test(t.innerHTML)),e&&e.content&&e.content.match(/error/i)||n}},{key:"getUrlHash",value:function(){return/gwh=([^&]+)/.test(unescape(window.location.search.substring(1)))?RegExp.$1:""}},{key:"getMeterPageCount",value:function(){var e=s.getMeterCookie().match(/v=i.([0-9]+)/);return e&&e[1]?parseInt(e[1],10):null}},{key:"cleanUrl",value:function(){return window.location.href.replace(/\b\?.+/g,"").replace(/\b\#.+/g,"")}},{key:"onEscapeKey",value:function(e){return 27===e.keyCode?(e.preventDefault(),!1):void 0}},{key:"getMeterCookie",value:function(){var e=i.get("nyt-m")||a.getFromLocalStorage("nyt-m")||window.name||"";return s.isNullCookie(e)||(i.set("nyt-m",e,730),s.backupMeterCookie(e)),e}},{key:"backupMeterCookie",value:function(e){s.isNullCookie(e)||(a.setToLocalStorage("nyt-m",e),window.name=e)}},{key:"getCookieHash",value:function(){return s.getMeterCookie().substr(0,32)}},{key:"getGatewayType",value:function(){var e=/gwt=([^&]+)/.test(unescape(window.location.search.substring(1)))?RegExp.$1:"";return"regi"===e?"regi":"pay"}},{key:"isNullCookie",value:function(e){return""===e||"null"===e||null===e}},{key:"renderDismissibleGW",value:function(){
return new n(r)}}]),s}();return s||(s=new l),r.check=s.checkMeter,r});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e){"function"==typeof define&&define.amd?(define("ecomm/growl",["foundation/hosts","jquery/nyt","auth/mtr","foundation/views/page-manager","ecomm/utils","ecomm/logger","ecomm/url","ecomm/etTracker"],function(t,n,a,o,i,r,c,s){return e(t,n,a,o,i,r,c,s)}),setTimeout(function(){require(["ecomm/growl"])},0)):"object"==typeof NYTD&&(NYTD.AuthGrowl=e(NYTD.Hosts,NYTD.jQuery,NYTD.Meter,void 0,NYTD.Ecomm.Utils,NYTD.Ecomm.Url,NYTD.Ecomm.Logger,NYTD.Ecomm.EtTracker))}(function(e,t,n,a,o,i,r,c){var s=void 0,l=e.www||e.wwwHost,u=function(){function e(){var a=this;_classCallCheck(this,e),t(document).on("NYTD:MeterLoaded",function(e,t){a.init(t)}),n&&n.loaded&&this.init(n)}return _createClass(e,[{key:"init",value:function(e){this.mtrData=e,this.addGrowl()}},{key:"addGrowl",value:function(){var e=this,n=this.mtrData,a=n.assetType,o="www.nytimes.com/growl",c=a&&""!==a?o+"_"+a:o;this.close(),(i.isDebugMode()||n.gatewayOn!==!1&&n.meterOn!==!1&&n.counted!==!1)&&t.ajax({url:l+"/adx/bin/adxrun.html?jsonp=?",dataType:"jsonp",data:{v:3,page:c,positions:"Left9,data_country,data1,data2,data3",keywords:r.getAdxKeywords(),type:"fastscript"},success:function(t){e.onGrowlLoaded(t)}})}},{key:"setGrowlPosition",value:function(){var e=t("#masthead"),n=e.length?e.offset().left:0,a=this.$container.find("#growl-container");n>0?a.css({left:n}):a.removeAttr("style")}},{key:"attachNYT5Handlers",value:function(){var e=this;a&&(this.setGrowlPosition(),a.listenTo(a,"nyt:page-resize",function(){e.setGrowlPosition()}),a.listenTo(a,"nyt:page-ready",function(){e.setGrowlPosition()}))}},{key:"onGrowlLoaded",value:function(n){var a=this,i=this.mtrData.pageCount;if(n&&n.ads&&i===parseInt(e.getMeterCookieCount(),10)){var r=t("body");if(n.ads.Left9&&r){var c=t("meta[name='PT']").attr("content");c=c?c.replace(/\s/g,""):"Article",this.$container&&this.$container.off("click").remove(),this.$container=t("<div class='mtr-growl-container'></div>");var s=o.appendAds(n,this.$container);r.append(this.$container);var l=this.$container;this.attachNYT5Handlers(),e.setupTracking({adxCampaigns:s,pageType:c,$growlContainer:l,meterCount:i,callback:function(e){a.close(e)}}),t(document).trigger("NYTD:AuthGrowlLoaded",{count:i})}}}},{key:"close",value:function(e){var t=this;this.$container&&(this.$container.fadeOut("slow",function(){t.$container&&(t.$container.unbind("click"),t.$container.remove())}),e.preventDefault())}}],[{key:"getMeterCookieCount",value:function(){var e=document.cookie.match(/v=i.([0-9]+)/);return e?e[1]:void 0}},{key:"isGrowlAdxCampaign",value:function(e){var t=e.match(/growl/i);return t&&t.length>0}},{key:"isInterstitialAdxCampaign",value:function(e){var t=e.match(/interstitial/i);return t&&t.length>0}},{key:"setupTracking",value:function(t){var n=void 0;e.isGrowlAdxCampaign(t.adxCampaigns)?(n=new c({$container:t.$growlContainer,module:"Growl",region:"FixedBottom",adxCampaignName:t.adxCampaigns,meterCount:t.meterCount,trackingParams:{expand:{eventName:"adExpansion",action:"hover"}},moduleInteractions:[{selector:".nytdGrowlNotifyCross",action:"click",tagxEvent:"growl-close",etParamKey:"close",callback:t.callback}]}),t.$growlContainer.on("growl.expandable",function(){t.$growlContainer.on("mouseenter",o.debounce(function(){n.track("growl-expand","expand")},300)).off("growl.expandable")})):e.isInterstitialAdxCampaign(t.adxCampaigns)&&(n=new c({$container:t.$growlContainer,module:"Interstitial",region:"FixedCenter",pgtype:t.pageType,adxCampaignName:t.adxCampaigns,meterCount:t.meterCount,moduleInteractions:[{selector:".nytdGrowlNotifyCross",action:"click",tagxEvent:"interstitial-close",etParamKey:"close",callback:t.callback}]})),this.etTracker=n}}]),e}();return s||(s=new u),s});